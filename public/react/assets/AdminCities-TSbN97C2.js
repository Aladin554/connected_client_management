import{r as d,j as r,l as be,d as g,y as c}from"./index-Cq981t_5.js";import{P as V}from"./plus-Dx-HZjgM.js";import{S as ge}from"./square-pen-ZkuNUzfm.js";import{T as ue}from"./trash-2-BU-kU2Zt.js";import{X as pe}from"./x-DmJMZP-g.js";import"./createLucideIcon-DDMrqLFZ.js";const he=[{id:0,label:"Admission",chipClass:"bg-emerald-100 text-emerald-800 border-emerald-300 dark:bg-emerald-950/40 dark:text-emerald-300 dark:border-emerald-700"},{id:1,label:"Visa",chipClass:"bg-blue-100 text-blue-800 border-blue-300 dark:bg-blue-950/40 dark:text-blue-300 dark:border-blue-700"},{id:2,label:"Dependant Visa",chipClass:"bg-amber-100 text-amber-800 border-amber-300 dark:bg-amber-950/40 dark:text-amber-300 dark:border-amber-700"}],ye=n=>[0,1,2].includes(Number(n.category))?Number(n.category):0;function Ce(){const[n,G]=d.useState([]),[h,X]=d.useState([]),[Y,H]=d.useState([]),[J,_]=d.useState(!0),[y,K]=d.useState(""),[Q,z]=d.useState([]),[x,B]=d.useState(""),[u,k]=d.useState([]),[f,N]=d.useState([]),[v,p]=d.useState([]),[W,w]=d.useState(!1),[C,M]=d.useState(null),[S,D]=d.useState(""),[A,j]=d.useState([""]),[Z,E]=d.useState(!1),[R,F]=d.useState(null);d.useEffect(()=>{(async()=>{_(!0),await Promise.all([$(),L(),ee()]),_(!1)})()},[]);const $=async()=>{try{const e=await g.get("/cities");G(e.data||[])}catch{c.error("Failed to load cities")}},L=async()=>{try{const s=(await g.get("/users")).data.map(t=>({...t,board_lists:t.board_lists||[]}));X(s)}catch{c.error("Failed to load users")}},ee=async()=>{try{const e=await g.get("/roles");H(e.data||[])}catch{c.error("Failed to load roles")}};d.useEffect(()=>{if(!y){z([]),B(""),P();return}const e=h.filter(s=>{var t;return((t=s.role)==null?void 0:t.id)===y});z(e),B(""),P()},[y,h]),d.useEffect(()=>{var s,t,a;if(!x){P();return}const e=h.find(i=>i.id===x);e&&(k(((s=e.cities)==null?void 0:s.map(i=>i.id))||[]),N(((t=e.boards)==null?void 0:t.map(i=>i.id))||[]),p(((a=e.board_lists)==null?void 0:a.map(i=>i.id))||[]))},[x,h]);const P=()=>{k([]),N([]),p([])};h.find(e=>e.id===x);const O=n.filter(e=>u.includes(e.id)),T=n.flatMap(e=>e.boards).filter(e=>f.includes(e.id)),re=e=>{k(s=>{if(s.includes(e)){const t=n.find(o=>o.id===e);if(!t)return s;const a=t.boards.map(o=>o.id),i=t.boards.flatMap(o=>{var m;return((m=o.lists)==null?void 0:m.map(l=>l.id))||[]});return N(o=>o.filter(m=>!a.includes(m))),p(o=>o.filter(m=>!i.includes(m))),s.filter(o=>o!==e)}return[...s,e]})},se=e=>{N(s=>{var o,m;if(s.includes(e)){const l=n.flatMap(b=>b.boards).find(b=>b.id===e),U=((o=l==null?void 0:l.lists)==null?void 0:o.map(b=>b.id))||[];return p(b=>b.filter(me=>!U.includes(me))),s.filter(b=>b!==e)}const t=n.flatMap(l=>l.boards).find(l=>l.id===e),a=((m=t==null?void 0:t.lists)==null?void 0:m.map(l=>l.id))||[];a.length>0&&p(l=>[...new Set([...l,...a])]);const i=n.find(l=>l.boards.some(U=>U.id===e));return i&&!u.includes(i.id)&&k(l=>[...l,i.id]),[...s,e]})},te=e=>{p(s=>s.includes(e)?s.filter(t=>t!==e):[...s,e])},ae=async()=>{if(x)try{await Promise.all([g.patch(`/users/${x}/cities`,{cities:u}),g.patch(`/users/${x}/boards`,{boards:f}),g.patch(`/users/${x}/lists`,{lists:v})]),c.success("Permissions updated"),L()}catch{c.error("Failed to save permissions")}},de=()=>{M(null),D(""),j([""]),w(!0)},I=e=>{M(e),D(e.name),j(e.boards.map(s=>s.name)),w(!0)},le=async()=>{var s,t;if(!S.trim()){c.error("City name is required");return}const e=A.filter(a=>a.trim()!=="");try{C?(await g.put(`/cities/${C.id}`,{name:S.trim(),boards:e}),c.success("City updated")):(await g.post("/cities",{name:S.trim(),boards:e}),c.success("City created")),w(!1),$()}catch(a){c.error(((t=(s=a.response)==null?void 0:s.data)==null?void 0:t.message)||"Failed to save city")}},ie=e=>{F(e),E(!0)},ne=async()=>{if(R)try{await g.delete(`/cities/${R}`),c.success("City deleted"),$()}catch{c.error("Failed to delete city")}finally{E(!1),F(null)}},oe=()=>{j(e=>[...e,""])},ce=e=>{j(s=>s.filter((t,a)=>a!==e))},xe=(e,s)=>{j(t=>t.map((a,i)=>i===e?s:a))},q=e=>e?new Date(e).toLocaleDateString():"-";return J?r.jsx("div",{className:"p-10 text-center text-gray-500",children:"Loading cities & users..."}):r.jsxs("div",{className:"p-5 lg:p-6 bg-white dark:bg-gray-900 rounded-2xl border border-gray-200 dark:border-gray-700 max-w-[1260px] mx-auto",children:[r.jsx(be,{position:"top-right",autoClose:3e3,theme:"colored"}),r.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-6",children:[r.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:"Cities & Access Control"}),r.jsxs("button",{onClick:de,className:"flex items-center gap-2 px-5 py-2.5 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition",children:[r.jsx(V,{size:18})," New City"]})]}),r.jsxs("div",{className:"mb-10 p-6 border rounded-2xl bg-gradient-to-b from-gray-50 to-white dark:from-gray-800/70 dark:to-gray-900 dark:border-gray-700 shadow-sm",children:[r.jsx("h2",{className:"text-lg font-semibold mb-5 text-gray-800 dark:text-gray-200",children:"Assign Permissions"}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-5 mb-6",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block mb-1.5 font-medium text-gray-700 dark:text-gray-300",children:"Role"}),r.jsxs("select",{value:y,onChange:e=>K(Number(e.target.value)||""),className:"w-full px-4 py-2.5 border rounded-lg dark:bg-gray-800 dark:border-gray-700 dark:text-gray-200 focus:ring-2 focus:ring-blue-500",children:[r.jsx("option",{value:"",children:"- Select Role -"}),Y.map(e=>r.jsx("option",{value:e.id,children:e.name},e.id))]})]}),y&&r.jsxs("div",{children:[r.jsx("label",{className:"block mb-1.5 font-medium text-gray-700 dark:text-gray-300",children:"User"}),r.jsxs("select",{value:x,onChange:e=>B(Number(e.target.value)||""),className:"w-full px-4 py-2.5 border rounded-lg dark:bg-gray-800 dark:border-gray-700 dark:text-gray-200 focus:ring-2 focus:ring-blue-500",children:[r.jsx("option",{value:"",children:"- Select User -"}),Q.map(e=>r.jsxs("option",{value:e.id,children:[e.first_name," ",e.last_name," - ",e.email]},e.id))]})]})]}),x&&r.jsxs("div",{className:"space-y-6",children:[r.jsxs("section",{className:"rounded-xl border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-900 p-5",children:[r.jsxs("div",{className:"flex items-center justify-between mb-4",children:[r.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:"Cities"}),r.jsxs("span",{className:"text-xs px-2 py-1 rounded bg-blue-100 text-blue-800 dark:bg-blue-950/40 dark:text-blue-300",children:[u.length," selected"]})]}),r.jsx("div",{className:"flex flex-wrap gap-2 max-h-60 overflow-y-auto",children:n.map(e=>r.jsxs("label",{className:`inline-flex items-center gap-2 rounded-full border px-4 py-2 text-sm cursor-pointer transition ${u.includes(e.id)?"border-blue-400 bg-blue-50 text-blue-800 dark:border-blue-600 dark:bg-blue-950/40 dark:text-blue-200":"border-gray-200 bg-white text-gray-700 hover:bg-gray-50 dark:border-gray-700 dark:bg-gray-900 dark:text-gray-200"}`,children:[e.name,r.jsx("input",{type:"checkbox",checked:u.includes(e.id),onChange:()=>re(e.id),className:"h-4 w-4 rounded text-blue-600"})]},e.id))})]}),O.length>0&&r.jsxs("section",{className:"rounded-xl border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-900 p-5",children:[r.jsxs("div",{className:"flex items-center justify-between mb-4",children:[r.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:"Boards"}),r.jsxs("span",{className:"text-xs px-2 py-1 rounded bg-indigo-100 text-indigo-800 dark:bg-indigo-950/40 dark:text-indigo-300",children:[f.length," selected"]})]}),r.jsx("div",{className:"space-y-5",children:O.map(e=>r.jsxs("div",{children:[r.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-gray-500 dark:text-gray-400 mb-2",children:e.name}),r.jsx("div",{className:"flex flex-wrap gap-2",children:e.boards.map(s=>r.jsxs("label",{className:`inline-flex items-center gap-2 rounded-full border px-4 py-2 text-sm cursor-pointer transition ${f.includes(s.id)?"border-indigo-400 bg-indigo-50 text-indigo-800 dark:border-indigo-600 dark:bg-indigo-950/40 dark:text-indigo-200":"border-gray-200 bg-white text-gray-700 hover:bg-gray-50 dark:border-gray-700 dark:bg-gray-900 dark:text-gray-200"}`,children:[s.name,r.jsx("input",{type:"checkbox",checked:f.includes(s.id),onChange:()=>se(s.id),className:"h-4 w-4 rounded text-indigo-600"})]},s.id))})]},e.id))})]}),T.length>0&&r.jsx("div",{className:"space-y-5",children:T.map(e=>r.jsxs("section",{className:"rounded-xl border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-900 p-5",children:[r.jsxs("div",{className:"flex items-center justify-between mb-4",children:[r.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:e.name}),r.jsxs("span",{className:"text-xs px-2 py-1 rounded bg-purple-100 text-purple-800 dark:bg-purple-950/40 dark:text-purple-300",children:[(e.lists||[]).filter(s=>v.includes(s.id)).length," ","selected"]})]}),r.jsx("div",{className:"space-y-4",children:he.map(s=>{const t=(e.lists||[]).filter(a=>ye(a)===s.id);return t.length?r.jsxs("div",{children:[r.jsx("span",{className:`inline-flex items-center px-2.5 py-1 rounded-md border text-[11px] font-semibold mb-2 ${s.chipClass}`,children:s.label}),r.jsx("div",{className:"flex flex-wrap gap-2",children:t.map(a=>r.jsxs("label",{className:`inline-flex items-center gap-2 rounded-full border px-4 py-2 text-sm cursor-pointer transition ${v.includes(a.id)?"border-purple-400 bg-purple-50 text-purple-800 dark:border-purple-600 dark:bg-purple-950/40 dark:text-purple-200":"border-gray-200 bg-white text-gray-700 hover:bg-gray-50 dark:border-gray-700 dark:bg-gray-900 dark:text-gray-200"}`,children:[a.title,r.jsx("input",{type:"checkbox",checked:v.includes(a.id),onChange:()=>te(a.id),className:"h-4 w-4 rounded text-purple-600"})]},a.id))})]},s.id):null})})]},e.id))}),r.jsx("div",{className:"flex justify-end pt-2",children:r.jsx("button",{onClick:ae,className:"px-7 py-2.5 bg-green-600 hover:bg-green-700 text-white rounded-lg font-medium shadow-sm transition",children:"Save Permissions"})})]})]}),r.jsx("div",{className:"overflow-x-auto rounded-xl border border-gray-200 dark:border-gray-700",children:r.jsxs("table",{className:"min-w-full bg-white dark:bg-gray-900",children:[r.jsx("thead",{className:"bg-gray-50 dark:bg-gray-800 border-b",children:r.jsxs("tr",{children:[r.jsx("th",{className:"px-6 py-4 text-left border-r",children:"City Name"}),r.jsx("th",{className:"px-6 py-4 text-left border-r",children:"Boards"}),r.jsx("th",{className:"px-6 py-4 text-left border-r",children:"Created"}),r.jsx("th",{className:"px-6 py-4 text-left border-r",children:"Updated"}),r.jsx("th",{className:"px-6 py-4 text-left",children:"Action"})]})}),r.jsx("tbody",{children:n.length===0?r.jsx("tr",{children:r.jsx("td",{colSpan:5,className:"px-6 py-10 text-center text-gray-500 dark:text-gray-400",children:"No cities found"})}):n.map(e=>r.jsxs("tr",{className:"border-t",children:[r.jsx("td",{className:"px-6 py-4 border-r",children:e.name}),r.jsx("td",{className:"px-6 py-4 border-r",children:e.boards.map(s=>s.name).join(", ")||"â€”"}),r.jsx("td",{className:"px-6 py-4 border-r",children:q(e.created_at)}),r.jsx("td",{className:"px-6 py-4 border-r",children:q(e.updated_at)}),r.jsxs("td",{className:"px-6 py-4 flex gap-2",children:[r.jsx("button",{onClick:()=>I(e),className:"p-2 bg-yellow-100 hover:bg-yellow-200 rounded dark:bg-yellow-900/40 dark:hover:bg-yellow-800/60",title:"Edit",children:r.jsx(ge,{size:16,className:"text-yellow-700 dark:text-yellow-400"})}),r.jsx("button",{onClick:()=>ie(e.id),className:"p-2 bg-red-100 hover:bg-red-200 rounded dark:bg-red-900/40 dark:hover:bg-red-800/60",title:"Delete",children:r.jsx(ue,{size:16,className:"text-red-700 dark:text-red-400"})})]})]},e.id))})]})}),W&&r.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:r.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-6 w-[420px]",children:[r.jsx("h3",{className:"text-xl font-bold mb-4",children:C?"Edit City":"Add City"}),!C&&r.jsxs("select",{value:"new",onChange:e=>{if(e.target.value!=="new"){const s=n.find(t=>t.id===Number(e.target.value));s&&I(s)}},className:"w-full mb-4 px-4 py-2 border rounded dark:bg-gray-800 dark:border-gray-700 dark:text-gray-200",children:[r.jsx("option",{value:"new",children:"Create New City"}),n.map(e=>r.jsx("option",{value:e.id,children:e.name},e.id))]}),r.jsx("input",{value:S,onChange:e=>D(e.target.value),className:"w-full mb-4 px-4 py-2 border rounded dark:bg-gray-800 dark:border-gray-700 dark:text-gray-200",placeholder:"City name"}),r.jsxs("div",{className:"mb-4",children:[r.jsx("p",{className:"font-medium mb-2",children:"Boards"}),A.map((e,s)=>r.jsxs("div",{className:"flex gap-2 mb-2",children:[r.jsx("input",{value:e,onChange:t=>xe(s,t.target.value),className:"flex-1 px-3 py-2 border rounded dark:bg-gray-800 dark:border-gray-700 dark:text-gray-200",placeholder:`Board ${s+1}`}),A.length>1&&r.jsx("button",{onClick:()=>ce(s),className:"p-2 bg-red-100 hover:bg-red-200 rounded dark:bg-red-900/40 dark:hover:bg-red-800/50",children:r.jsx(pe,{size:14})})]},s)),r.jsxs("button",{onClick:oe,className:"text-sm text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300 mt-2 flex items-center gap-1",children:[r.jsx(V,{size:14})," Add Board"]})]}),r.jsxs("div",{className:"flex gap-3",children:[r.jsx("button",{onClick:()=>w(!1),className:"flex-1 border py-2 rounded hover:bg-gray-100 dark:hover:bg-gray-700 dark:border-gray-600",children:"Cancel"}),r.jsx("button",{onClick:le,className:"flex-1 bg-blue-600 hover:bg-blue-700 text-white py-2 rounded font-medium",children:"Save"})]})]})}),Z&&r.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-50 p-4",children:r.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-6 w-full max-w-sm",children:[r.jsx("h3",{className:"text-lg font-bold mb-4",children:"Confirm Delete"}),r.jsxs("p",{className:"mb-6 text-gray-700 dark:text-gray-300",children:["Delete this city?",r.jsx("br",{}),r.jsx("span",{className:"text-red-600 font-medium",children:"All boards and lists will be permanently removed."})]}),r.jsxs("div",{className:"flex gap-3",children:[r.jsx("button",{onClick:()=>E(!1),className:"flex-1 py-2.5 border rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700",children:"Cancel"}),r.jsx("button",{onClick:ne,className:"flex-1 bg-red-600 hover:bg-red-700 text-white py-2.5 rounded-lg font-medium",children:"Delete"})]})]})})]})}export{Ce as default};
