import{m as k,u as w,r as n,i as N,d as x,j as a}from"./index-DNhL7Y25.js";import{A as I}from"./arrow-left-UM9kgupA.js";import"./createLucideIcon-YXB1pq23.js";function F(){const{id:u}=k(),d=w(),m=!!u,[l,p]=n.useState(null),[s,c]=n.useState({first_name:"",last_name:"",email:"",roleId:m?"":"3",password:"",max_cards:"10"}),[t,h]=n.useState({first_name:"",last_name:"",email:"",roleId:"",password:"",max_cards:""}),[f,b]=n.useState(!1),[y,_]=n.useState([]);n.useEffect(()=>{N().then(e=>{p(e)}).catch(()=>{d("/dashboard/admin-users",{state:{message:"Failed to get current user",type:"error"}})})},[d]),n.useEffect(()=>{if(!l)return;const e=l.role_id,r=l.can_create_users===1;e!==1&&(e===2&&r||d("/dashboard/admin-users",{state:{message:"You do not have access to this page.",type:"error"}}))},[l,d]),n.useEffect(()=>{x.get("/roles").then(e=>_(Array.isArray(e.data)?e.data:[])).catch(()=>d("/dashboard/admin-users",{state:{message:"Failed to fetch roles",type:"error"}}))},[d]),n.useEffect(()=>{m&&u&&x.get(`/users/${u}`).then(e=>{var r,o,i,g;c({first_name:e.data.first_name||"",last_name:e.data.last_name||"",email:e.data.email||"",roleId:((r=e.data.role_id)==null?void 0:r.toString())||((i=(o=e.data.role)==null?void 0:o.id)==null?void 0:i.toString())||"",password:"",max_cards:((g=e.data.max_cards)==null?void 0:g.toString())||"10"})}).catch(()=>d("/dashboard/admin-users",{state:{message:"Failed to load user",type:"error"}}))},[u,m,d]);const v=()=>{const e={first_name:"",last_name:"",email:"",roleId:"",password:"",max_cards:""};let r=!0;if(s.first_name.trim()||(e.first_name="First name is required.",r=!1),s.last_name.trim()||(e.last_name="Last name is required.",r=!1),s.email.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(s.email)||(e.email="Invalid email address.",r=!1):(e.email="Email is required.",r=!1),s.roleId||(e.roleId="Role is required.",r=!1),!m&&!s.password.trim()&&(e.password="Password is required.",r=!1),(l==null?void 0:l.role_id)===1){const o=parseInt(s.max_cards);(isNaN(o)||o<1||o>1e3)&&(e.max_cards="Max cards must be between 1 and 1000",r=!1)}return h(e),r},j=async e=>{var r,o;if(e.preventDefault(),!!v()){b(!0);try{const i={first_name:s.first_name,last_name:s.last_name,email:s.email,role_id:Number(s.roleId)};s.password&&(i.password=s.password),(l==null?void 0:l.role_id)===1&&(i.max_cards=Number(s.max_cards)),m?(await x.put(`/users/${u}`,i),d("/dashboard/admin-users",{state:{message:"User updated successfully!",type:"success"}})):(await x.post("/users",i),d("/dashboard/admin-users",{state:{message:"User added successfully!",type:"success"}}))}catch(i){const g=((o=(r=i.response)==null?void 0:r.data)==null?void 0:o.message)||"Error saving user";d("/dashboard/admin-users",{state:{message:g,type:"error"}})}finally{b(!1)}}};return a.jsxs("div",{className:"p-16 border border-gray-200 rounded-2xl dark:border-gray-700 dark:bg-gray-900 shadow-sm max-w-5xl mx-auto w-full",children:[a.jsxs("button",{type:"button",onClick:()=>d(-1),className:"inline-flex items-center gap-2 px-3 py-2 mb-6 rounded-xl border border-gray-300 dark:border-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800 hover:border-gray-400 dark:hover:border-gray-600 transition-all duration-200 shadow-sm",children:[a.jsx(I,{className:"w-5 h-5"}),a.jsx("span",{className:"font-medium",children:"Back"})]}),a.jsx("h1",{className:"text-2xl font-semibold mb-6 dark:text-gray-200",children:m?"Edit User":"Add New User"}),a.jsxs("form",{onSubmit:j,className:"space-y-6 w-full",children:[a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block mb-1 text-sm font-medium dark:text-gray-300",children:"First Name"}),a.jsx("input",{type:"text",value:s.first_name,onChange:e=>c({...s,first_name:e.target.value}),className:`w-full border px-3 py-2 rounded-lg text-lg dark:bg-gray-700 dark:text-gray-200 focus:outline-none focus:ring-2 ${t.first_name?"border-red-500 focus:ring-red-500":"focus:ring-blue-500"}`}),t.first_name&&a.jsx("p",{className:"text-red-500 text-sm mt-1",children:t.first_name})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block mb-1 text-sm font-medium dark:text-gray-300",children:"Last Name"}),a.jsx("input",{type:"text",value:s.last_name,onChange:e=>c({...s,last_name:e.target.value}),className:`w-full border px-3 py-2 rounded-lg text-lg dark:bg-gray-700 dark:text-gray-200 focus:outline-none focus:ring-2 ${t.last_name?"border-red-500 focus:ring-red-500":"focus:ring-blue-500"}`}),t.last_name&&a.jsx("p",{className:"text-red-500 text-sm mt-1",children:t.last_name})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block mb-1 text-sm font-medium dark:text-gray-300",children:"Email"}),a.jsx("input",{type:"email",value:s.email,onChange:e=>c({...s,email:e.target.value}),className:`w-full border px-3 py-2 rounded-lg text-lg dark:bg-gray-700 dark:text-gray-200 focus:outline-none focus:ring-2 ${t.email?"border-red-500 focus:ring-red-500":"focus:ring-blue-500"}`}),t.email&&a.jsx("p",{className:"text-red-500 text-sm mt-1",children:t.email})]}),a.jsxs("div",{children:[a.jsxs("label",{className:"block mb-1 text-sm font-medium dark:text-gray-300",children:["Password ",m&&"(leave blank to keep unchanged)"]}),a.jsx("input",{type:"password",value:s.password,onChange:e=>c({...s,password:e.target.value}),className:`w-full border px-3 py-2 rounded-lg text-lg dark:bg-gray-700 dark:text-gray-200 focus:outline-none focus:ring-2 ${t.password?"border-red-500 focus:ring-red-500":"focus:ring-blue-500"}`}),t.password&&a.jsx("p",{className:"text-red-500 text-sm mt-1",children:t.password})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block mb-1 text-sm font-medium dark:text-gray-300",children:"Role"}),a.jsxs("select",{value:s.roleId,onChange:e=>c({...s,roleId:e.target.value}),className:`w-full border px-3 py-2 rounded-lg text-lg dark:bg-gray-700 dark:text-gray-200 focus:outline-none focus:ring-2 ${t.roleId?"border-red-500 focus:ring-red-500":"focus:ring-blue-500"}`,children:[a.jsx("option",{value:"",children:"Select role"}),y.map(e=>a.jsx("option",{value:e.id,children:e.name},e.id))]}),t.roleId&&a.jsx("p",{className:"text-red-500 text-sm mt-1",children:t.roleId})]})]}),a.jsxs("div",{className:"flex justify-end gap-3 mt-8",children:[a.jsx("button",{type:"button",onClick:()=>d("/dashboard/admin-users"),className:"px-5 py-2 rounded-lg border dark:border-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800",children:"Cancel"}),a.jsx("button",{type:"submit",disabled:f,className:"px-6 py-3 rounded-lg bg-blue-600 text-white hover:bg-blue-700 text-lg disabled:opacity-50",children:f?"Saving...":"Save User"})]})]})]})}export{F as default};
