const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index.es-C11ycVPm.js","assets/index-dlF-v8Wy.js","assets/index-CA_6W7wU.css","assets/index-u0egmo51.js"])))=>i.map(i=>d[i]);
import{r as a,R as oe,d as V,j as t,_ as Hi,m as qi,u as Gi,i as Ji}from"./index-dlF-v8Wy.js";import{r as Tn}from"./index-u0egmo51.js";import{L as Qi}from"./Loader-COzHcs_H.js";import{c as pt}from"./createLucideIcon-Ck__ep5g.js";import{X as Tt}from"./x-B3DdBO1j.js";import{P as ss}from"./plus-CdWAnueV.js";import{S as Er}from"./square-pen-DnY1KpRk.js";import{S as Zi}from"./search-CZwwpIrA.js";import{C as on}from"./chevron-down-C9vurgye.js";import{L as ea}from"./layout-grid-DtS7kVX1.js";/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ta=[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]],dr=pt("activity",ta);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const na=[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8",key:"1s80jp"}],["path",{d:"M10 12h4",key:"a56b0p"}]],Mr=pt("archive",na);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sa=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 18h.01",key:"lrp35t"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M16 18h.01",key:"kzsmim"}]],ra=pt("calendar-days",sa);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ia=[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]],aa=pt("chart-column",ia);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oa=[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]],cr=pt("credit-card",oa);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const la=[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]],Rr=pt("ellipsis",la);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const da=[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]],ca=pt("funnel",da);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ua=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]],fa=pt("globe",ua);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ma=[["path",{d:"M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z",key:"18887p"}]],$r=pt("message-square",ma);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ha=[["path",{d:"m16 6-8.414 8.586a2 2 0 0 0 2.829 2.829l8.414-8.586a4 4 0 1 0-5.657-5.657l-8.379 8.551a6 6 0 1 0 8.485 8.485l8.379-8.551",key:"1miecu"}]],ur=pt("paperclip",ha);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ga=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]],xa=pt("rotate-ccw",ga);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pa=[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]],Ir=pt("tag",pa);function ba(){for(var e=arguments.length,n=new Array(e),s=0;s<e;s++)n[s]=arguments[s];return a.useMemo(()=>i=>{n.forEach(o=>o(i))},n)}const cs=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function bn(e){const n=Object.prototype.toString.call(e);return n==="[object Window]"||n==="[object global]"}function Ks(e){return"nodeType"in e}function Ye(e){var n,s;return e?bn(e)?e:Ks(e)&&(n=(s=e.ownerDocument)==null?void 0:s.defaultView)!=null?n:window:window}function Vs(e){const{Document:n}=Ye(e);return e instanceof n}function Wn(e){return bn(e)?!1:e instanceof Ye(e).HTMLElement}function Tr(e){return e instanceof Ye(e).SVGElement}function yn(e){return e?bn(e)?e.document:Ks(e)?Vs(e)?e:Wn(e)||Tr(e)?e.ownerDocument:document:document:document}const wt=cs?a.useLayoutEffect:a.useEffect;function us(e){const n=a.useRef(e);return wt(()=>{n.current=e}),a.useCallback(function(){for(var s=arguments.length,i=new Array(s),o=0;o<s;o++)i[o]=arguments[o];return n.current==null?void 0:n.current(...i)},[])}function ya(){const e=a.useRef(null),n=a.useCallback((i,o)=>{e.current=setInterval(i,o)},[]),s=a.useCallback(()=>{e.current!==null&&(clearInterval(e.current),e.current=null)},[]);return[n,s]}function Bn(e,n){n===void 0&&(n=[e]);const s=a.useRef(e);return wt(()=>{s.current!==e&&(s.current=e)},n),s}function Un(e,n){const s=a.useRef();return a.useMemo(()=>{const i=e(s.current);return s.current=i,i},[...n])}function rs(e){const n=us(e),s=a.useRef(null),i=a.useCallback(o=>{o!==s.current&&(n==null||n(o,s.current)),s.current=o},[]);return[s,i]}function is(e){const n=a.useRef();return a.useEffect(()=>{n.current=e},[e]),n.current}let Es={};function Xn(e,n){return a.useMemo(()=>{if(n)return n;const s=Es[e]==null?0:Es[e]+1;return Es[e]=s,e+"-"+s},[e,n])}function Or(e){return function(n){for(var s=arguments.length,i=new Array(s>1?s-1:0),o=1;o<s;o++)i[o-1]=arguments[o];return i.reduce((d,u)=>{const f=Object.entries(u);for(const[g,p]of f){const v=d[g];v!=null&&(d[g]=v+e*p)}return d},{...n})}}const pn=Or(1),as=Or(-1);function va(e){return"clientX"in e&&"clientY"in e}function fs(e){if(!e)return!1;const{KeyboardEvent:n}=Ye(e.target);return n&&e instanceof n}function wa(e){if(!e)return!1;const{TouchEvent:n}=Ye(e.target);return n&&e instanceof n}function os(e){if(wa(e)){if(e.touches&&e.touches.length){const{clientX:n,clientY:s}=e.touches[0];return{x:n,y:s}}else if(e.changedTouches&&e.changedTouches.length){const{clientX:n,clientY:s}=e.changedTouches[0];return{x:n,y:s}}}return va(e)?{x:e.clientX,y:e.clientY}:null}const Ot=Object.freeze({Translate:{toString(e){if(!e)return;const{x:n,y:s}=e;return"translate3d("+(n?Math.round(n):0)+"px, "+(s?Math.round(s):0)+"px, 0)"}},Scale:{toString(e){if(!e)return;const{scaleX:n,scaleY:s}=e;return"scaleX("+n+") scaleY("+s+")"}},Transform:{toString(e){if(e)return[Ot.Translate.toString(e),Ot.Scale.toString(e)].join(" ")}},Transition:{toString(e){let{property:n,duration:s,easing:i}=e;return n+" "+s+"ms "+i}}}),fr="a,frame,iframe,input:not([type=hidden]):not(:disabled),select:not(:disabled),textarea:not(:disabled),button:not(:disabled),*[tabindex]";function Na(e){return e.matches(fr)?e:e.querySelector(fr)}const ja={display:"none"};function Ca(e){let{id:n,value:s}=e;return oe.createElement("div",{id:n,style:ja},s)}function Sa(e){let{id:n,announcement:s,ariaLiveType:i="assertive"}=e;const o={position:"fixed",top:0,left:0,width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0 0 0 0)",clipPath:"inset(100%)",whiteSpace:"nowrap"};return oe.createElement("div",{id:n,style:o,role:"status","aria-live":i,"aria-atomic":!0},s)}function ka(){const[e,n]=a.useState("");return{announce:a.useCallback(i=>{i!=null&&n(i)},[]),announcement:e}}const Fr=a.createContext(null);function Da(e){const n=a.useContext(Fr);a.useEffect(()=>{if(!n)throw new Error("useDndMonitor must be used within a children of <DndContext>");return n(e)},[e,n])}function _a(){const[e]=a.useState(()=>new Set),n=a.useCallback(i=>(e.add(i),()=>e.delete(i)),[e]);return[a.useCallback(i=>{let{type:o,event:d}=i;e.forEach(u=>{var f;return(f=u[o])==null?void 0:f.call(u,d)})},[e]),n]}const Aa={draggable:`
    To pick up a draggable item, press the space bar.
    While dragging, use the arrow keys to move the item.
    Press space again to drop the item in its new position, or press escape to cancel.
  `},La={onDragStart(e){let{active:n}=e;return"Picked up draggable item "+n.id+"."},onDragOver(e){let{active:n,over:s}=e;return s?"Draggable item "+n.id+" was moved over droppable area "+s.id+".":"Draggable item "+n.id+" is no longer over a droppable area."},onDragEnd(e){let{active:n,over:s}=e;return s?"Draggable item "+n.id+" was dropped over droppable area "+s.id:"Draggable item "+n.id+" was dropped."},onDragCancel(e){let{active:n}=e;return"Dragging was cancelled. Draggable item "+n.id+" was dropped."}};function Ea(e){let{announcements:n=La,container:s,hiddenTextDescribedById:i,screenReaderInstructions:o=Aa}=e;const{announce:d,announcement:u}=ka(),f=Xn("DndLiveRegion"),[g,p]=a.useState(!1);if(a.useEffect(()=>{p(!0)},[]),Da(a.useMemo(()=>({onDragStart(w){let{active:k}=w;d(n.onDragStart({active:k}))},onDragMove(w){let{active:k,over:S}=w;n.onDragMove&&d(n.onDragMove({active:k,over:S}))},onDragOver(w){let{active:k,over:S}=w;d(n.onDragOver({active:k,over:S}))},onDragEnd(w){let{active:k,over:S}=w;d(n.onDragEnd({active:k,over:S}))},onDragCancel(w){let{active:k,over:S}=w;d(n.onDragCancel({active:k,over:S}))}}),[d,n])),!g)return null;const v=oe.createElement(oe.Fragment,null,oe.createElement(Ca,{id:i,value:o.draggable}),oe.createElement(Sa,{id:f,announcement:u}));return s?Tn.createPortal(v,s):v}var De;(function(e){e.DragStart="dragStart",e.DragMove="dragMove",e.DragEnd="dragEnd",e.DragCancel="dragCancel",e.DragOver="dragOver",e.RegisterDroppable="registerDroppable",e.SetDroppableDisabled="setDroppableDisabled",e.UnregisterDroppable="unregisterDroppable"})(De||(De={}));function ls(){}function Ma(e,n){return a.useMemo(()=>({sensor:e,options:n??{}}),[e,n])}function Ra(){for(var e=arguments.length,n=new Array(e),s=0;s<e;s++)n[s]=arguments[s];return a.useMemo(()=>[...n].filter(i=>i!=null),[...n])}const Nt=Object.freeze({x:0,y:0});function Ys(e,n){return Math.sqrt(Math.pow(e.x-n.x,2)+Math.pow(e.y-n.y,2))}function $a(e,n){const s=os(e);if(!s)return"0 0";const i={x:(s.x-n.left)/n.width*100,y:(s.y-n.top)/n.height*100};return i.x+"% "+i.y+"%"}function Hs(e,n){let{data:{value:s}}=e,{data:{value:i}}=n;return s-i}function Ia(e,n){let{data:{value:s}}=e,{data:{value:i}}=n;return i-s}function zs(e){let{left:n,top:s,height:i,width:o}=e;return[{x:n,y:s},{x:n+o,y:s},{x:n,y:s+i},{x:n+o,y:s+i}]}function Ta(e,n){if(!e||e.length===0)return null;const[s]=e;return s[n]}function mr(e,n,s){return n===void 0&&(n=e.left),s===void 0&&(s=e.top),{x:n+e.width*.5,y:s+e.height*.5}}const Oa=e=>{let{collisionRect:n,droppableRects:s,droppableContainers:i}=e;const o=mr(n,n.left,n.top),d=[];for(const u of i){const{id:f}=u,g=s.get(f);if(g){const p=Ys(mr(g),o);d.push({id:f,data:{droppableContainer:u,value:p}})}}return d.sort(Hs)},Fa=e=>{let{collisionRect:n,droppableRects:s,droppableContainers:i}=e;const o=zs(n),d=[];for(const u of i){const{id:f}=u,g=s.get(f);if(g){const p=zs(g),v=o.reduce((k,S,F)=>k+Ys(p[F],S),0),w=Number((v/4).toFixed(4));d.push({id:f,data:{droppableContainer:u,value:w}})}}return d.sort(Hs)};function za(e,n){const s=Math.max(n.top,e.top),i=Math.max(n.left,e.left),o=Math.min(n.left+n.width,e.left+e.width),d=Math.min(n.top+n.height,e.top+e.height),u=o-i,f=d-s;if(i<o&&s<d){const g=n.width*n.height,p=e.width*e.height,v=u*f,w=v/(g+p-v);return Number(w.toFixed(4))}return 0}const Ba=e=>{let{collisionRect:n,droppableRects:s,droppableContainers:i}=e;const o=[];for(const d of i){const{id:u}=d,f=s.get(u);if(f){const g=za(f,n);g>0&&o.push({id:u,data:{droppableContainer:d,value:g}})}}return o.sort(Ia)};function Pa(e,n){const{top:s,left:i,bottom:o,right:d}=n;return s<=e.y&&e.y<=o&&i<=e.x&&e.x<=d}const Wa=e=>{let{droppableContainers:n,droppableRects:s,pointerCoordinates:i}=e;if(!i)return[];const o=[];for(const d of n){const{id:u}=d,f=s.get(u);if(f&&Pa(i,f)){const p=zs(f).reduce((w,k)=>w+Ys(i,k),0),v=Number((p/4).toFixed(4));o.push({id:u,data:{droppableContainer:d,value:v}})}}return o.sort(Hs)};function Ua(e,n,s){return{...e,scaleX:n&&s?n.width/s.width:1,scaleY:n&&s?n.height/s.height:1}}function zr(e,n){return e&&n?{x:e.left-n.left,y:e.top-n.top}:Nt}function Xa(e){return function(s){for(var i=arguments.length,o=new Array(i>1?i-1:0),d=1;d<i;d++)o[d-1]=arguments[d];return o.reduce((u,f)=>({...u,top:u.top+e*f.y,bottom:u.bottom+e*f.y,left:u.left+e*f.x,right:u.right+e*f.x}),{...s})}}const Ka=Xa(1);function Br(e){if(e.startsWith("matrix3d(")){const n=e.slice(9,-1).split(/, /);return{x:+n[12],y:+n[13],scaleX:+n[0],scaleY:+n[5]}}else if(e.startsWith("matrix(")){const n=e.slice(7,-1).split(/, /);return{x:+n[4],y:+n[5],scaleX:+n[0],scaleY:+n[3]}}return null}function Va(e,n,s){const i=Br(n);if(!i)return e;const{scaleX:o,scaleY:d,x:u,y:f}=i,g=e.left-u-(1-o)*parseFloat(s),p=e.top-f-(1-d)*parseFloat(s.slice(s.indexOf(" ")+1)),v=o?e.width/o:e.width,w=d?e.height/d:e.height;return{width:v,height:w,top:p,right:g+v,bottom:p+w,left:g}}const Ya={ignoreTransform:!1};function vn(e,n){n===void 0&&(n=Ya);let s=e.getBoundingClientRect();if(n.ignoreTransform){const{transform:p,transformOrigin:v}=Ye(e).getComputedStyle(e);p&&(s=Va(s,p,v))}const{top:i,left:o,width:d,height:u,bottom:f,right:g}=s;return{top:i,left:o,width:d,height:u,bottom:f,right:g}}function hr(e){return vn(e,{ignoreTransform:!0})}function Ha(e){const n=e.innerWidth,s=e.innerHeight;return{top:0,left:0,right:n,bottom:s,width:n,height:s}}function qa(e,n){return n===void 0&&(n=Ye(e).getComputedStyle(e)),n.position==="fixed"}function Ga(e,n){n===void 0&&(n=Ye(e).getComputedStyle(e));const s=/(auto|scroll|overlay)/;return["overflow","overflowX","overflowY"].some(o=>{const d=n[o];return typeof d=="string"?s.test(d):!1})}function qs(e,n){const s=[];function i(o){if(n!=null&&s.length>=n||!o)return s;if(Vs(o)&&o.scrollingElement!=null&&!s.includes(o.scrollingElement))return s.push(o.scrollingElement),s;if(!Wn(o)||Tr(o)||s.includes(o))return s;const d=Ye(e).getComputedStyle(o);return o!==e&&Ga(o,d)&&s.push(o),qa(o,d)?s:i(o.parentNode)}return e?i(e):s}function Pr(e){const[n]=qs(e,1);return n??null}function Ms(e){return!cs||!e?null:bn(e)?e:Ks(e)?Vs(e)||e===yn(e).scrollingElement?window:Wn(e)?e:null:null}function Wr(e){return bn(e)?e.scrollX:e.scrollLeft}function Ur(e){return bn(e)?e.scrollY:e.scrollTop}function Bs(e){return{x:Wr(e),y:Ur(e)}}var Ee;(function(e){e[e.Forward=1]="Forward",e[e.Backward=-1]="Backward"})(Ee||(Ee={}));function Xr(e){return!cs||!e?!1:e===document.scrollingElement}function Kr(e){const n={x:0,y:0},s=Xr(e)?{height:window.innerHeight,width:window.innerWidth}:{height:e.clientHeight,width:e.clientWidth},i={x:e.scrollWidth-s.width,y:e.scrollHeight-s.height},o=e.scrollTop<=n.y,d=e.scrollLeft<=n.x,u=e.scrollTop>=i.y,f=e.scrollLeft>=i.x;return{isTop:o,isLeft:d,isBottom:u,isRight:f,maxScroll:i,minScroll:n}}const Ja={x:.2,y:.2};function Qa(e,n,s,i,o){let{top:d,left:u,right:f,bottom:g}=s;i===void 0&&(i=10),o===void 0&&(o=Ja);const{isTop:p,isBottom:v,isLeft:w,isRight:k}=Kr(e),S={x:0,y:0},F={x:0,y:0},_={height:n.height*o.y,width:n.width*o.x};return!p&&d<=n.top+_.height?(S.y=Ee.Backward,F.y=i*Math.abs((n.top+_.height-d)/_.height)):!v&&g>=n.bottom-_.height&&(S.y=Ee.Forward,F.y=i*Math.abs((n.bottom-_.height-g)/_.height)),!k&&f>=n.right-_.width?(S.x=Ee.Forward,F.x=i*Math.abs((n.right-_.width-f)/_.width)):!w&&u<=n.left+_.width&&(S.x=Ee.Backward,F.x=i*Math.abs((n.left+_.width-u)/_.width)),{direction:S,speed:F}}function Za(e){if(e===document.scrollingElement){const{innerWidth:d,innerHeight:u}=window;return{top:0,left:0,right:d,bottom:u,width:d,height:u}}const{top:n,left:s,right:i,bottom:o}=e.getBoundingClientRect();return{top:n,left:s,right:i,bottom:o,width:e.clientWidth,height:e.clientHeight}}function Vr(e){return e.reduce((n,s)=>pn(n,Bs(s)),Nt)}function eo(e){return e.reduce((n,s)=>n+Wr(s),0)}function to(e){return e.reduce((n,s)=>n+Ur(s),0)}function Yr(e,n){if(n===void 0&&(n=vn),!e)return;const{top:s,left:i,bottom:o,right:d}=n(e);Pr(e)&&(o<=0||d<=0||s>=window.innerHeight||i>=window.innerWidth)&&e.scrollIntoView({block:"center",inline:"center"})}const no=[["x",["left","right"],eo],["y",["top","bottom"],to]];class Gs{constructor(n,s){this.rect=void 0,this.width=void 0,this.height=void 0,this.top=void 0,this.bottom=void 0,this.right=void 0,this.left=void 0;const i=qs(s),o=Vr(i);this.rect={...n},this.width=n.width,this.height=n.height;for(const[d,u,f]of no)for(const g of u)Object.defineProperty(this,g,{get:()=>{const p=f(i),v=o[d]-p;return this.rect[g]+v},enumerable:!0});Object.defineProperty(this,"rect",{enumerable:!1})}}class On{constructor(n){this.target=void 0,this.listeners=[],this.removeAll=()=>{this.listeners.forEach(s=>{var i;return(i=this.target)==null?void 0:i.removeEventListener(...s)})},this.target=n}add(n,s,i){var o;(o=this.target)==null||o.addEventListener(n,s,i),this.listeners.push([n,s,i])}}function so(e){const{EventTarget:n}=Ye(e);return e instanceof n?e:yn(e)}function Rs(e,n){const s=Math.abs(e.x),i=Math.abs(e.y);return typeof n=="number"?Math.sqrt(s**2+i**2)>n:"x"in n&&"y"in n?s>n.x&&i>n.y:"x"in n?s>n.x:"y"in n?i>n.y:!1}var xt;(function(e){e.Click="click",e.DragStart="dragstart",e.Keydown="keydown",e.ContextMenu="contextmenu",e.Resize="resize",e.SelectionChange="selectionchange",e.VisibilityChange="visibilitychange"})(xt||(xt={}));function gr(e){e.preventDefault()}function ro(e){e.stopPropagation()}var Z;(function(e){e.Space="Space",e.Down="ArrowDown",e.Right="ArrowRight",e.Left="ArrowLeft",e.Up="ArrowUp",e.Esc="Escape",e.Enter="Enter",e.Tab="Tab"})(Z||(Z={}));const Hr={start:[Z.Space,Z.Enter],cancel:[Z.Esc],end:[Z.Space,Z.Enter,Z.Tab]},io=(e,n)=>{let{currentCoordinates:s}=n;switch(e.code){case Z.Right:return{...s,x:s.x+25};case Z.Left:return{...s,x:s.x-25};case Z.Down:return{...s,y:s.y+25};case Z.Up:return{...s,y:s.y-25}}};class qr{constructor(n){this.props=void 0,this.autoScrollEnabled=!1,this.referenceCoordinates=void 0,this.listeners=void 0,this.windowListeners=void 0,this.props=n;const{event:{target:s}}=n;this.props=n,this.listeners=new On(yn(s)),this.windowListeners=new On(Ye(s)),this.handleKeyDown=this.handleKeyDown.bind(this),this.handleCancel=this.handleCancel.bind(this),this.attach()}attach(){this.handleStart(),this.windowListeners.add(xt.Resize,this.handleCancel),this.windowListeners.add(xt.VisibilityChange,this.handleCancel),setTimeout(()=>this.listeners.add(xt.Keydown,this.handleKeyDown))}handleStart(){const{activeNode:n,onStart:s}=this.props,i=n.node.current;i&&Yr(i),s(Nt)}handleKeyDown(n){if(fs(n)){const{active:s,context:i,options:o}=this.props,{keyboardCodes:d=Hr,coordinateGetter:u=io,scrollBehavior:f="smooth"}=o,{code:g}=n;if(d.end.includes(g)){this.handleEnd(n);return}if(d.cancel.includes(g)){this.handleCancel(n);return}const{collisionRect:p}=i.current,v=p?{x:p.left,y:p.top}:Nt;this.referenceCoordinates||(this.referenceCoordinates=v);const w=u(n,{active:s,context:i.current,currentCoordinates:v});if(w){const k=as(w,v),S={x:0,y:0},{scrollableAncestors:F}=i.current;for(const _ of F){const A=n.code,{isTop:O,isRight:D,isLeft:R,isBottom:W,maxScroll:U,minScroll:K}=Kr(_),T=Za(_),z={x:Math.min(A===Z.Right?T.right-T.width/2:T.right,Math.max(A===Z.Right?T.left:T.left+T.width/2,w.x)),y:Math.min(A===Z.Down?T.bottom-T.height/2:T.bottom,Math.max(A===Z.Down?T.top:T.top+T.height/2,w.y))},q=A===Z.Right&&!D||A===Z.Left&&!R,ie=A===Z.Down&&!W||A===Z.Up&&!O;if(q&&z.x!==w.x){const Y=_.scrollLeft+k.x,ve=A===Z.Right&&Y<=U.x||A===Z.Left&&Y>=K.x;if(ve&&!k.y){_.scrollTo({left:Y,behavior:f});return}ve?S.x=_.scrollLeft-Y:S.x=A===Z.Right?_.scrollLeft-U.x:_.scrollLeft-K.x,S.x&&_.scrollBy({left:-S.x,behavior:f});break}else if(ie&&z.y!==w.y){const Y=_.scrollTop+k.y,ve=A===Z.Down&&Y<=U.y||A===Z.Up&&Y>=K.y;if(ve&&!k.x){_.scrollTo({top:Y,behavior:f});return}ve?S.y=_.scrollTop-Y:S.y=A===Z.Down?_.scrollTop-U.y:_.scrollTop-K.y,S.y&&_.scrollBy({top:-S.y,behavior:f});break}}this.handleMove(n,pn(as(w,this.referenceCoordinates),S))}}}handleMove(n,s){const{onMove:i}=this.props;n.preventDefault(),i(s)}handleEnd(n){const{onEnd:s}=this.props;n.preventDefault(),this.detach(),s()}handleCancel(n){const{onCancel:s}=this.props;n.preventDefault(),this.detach(),s()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll()}}qr.activators=[{eventName:"onKeyDown",handler:(e,n,s)=>{let{keyboardCodes:i=Hr,onActivation:o}=n,{active:d}=s;const{code:u}=e.nativeEvent;if(i.start.includes(u)){const f=d.activatorNode.current;return f&&e.target!==f?!1:(e.preventDefault(),o==null||o({event:e.nativeEvent}),!0)}return!1}}];function xr(e){return!!(e&&"distance"in e)}function pr(e){return!!(e&&"delay"in e)}class Js{constructor(n,s,i){var o;i===void 0&&(i=so(n.event.target)),this.props=void 0,this.events=void 0,this.autoScrollEnabled=!0,this.document=void 0,this.activated=!1,this.initialCoordinates=void 0,this.timeoutId=null,this.listeners=void 0,this.documentListeners=void 0,this.windowListeners=void 0,this.props=n,this.events=s;const{event:d}=n,{target:u}=d;this.props=n,this.events=s,this.document=yn(u),this.documentListeners=new On(this.document),this.listeners=new On(i),this.windowListeners=new On(Ye(u)),this.initialCoordinates=(o=os(d))!=null?o:Nt,this.handleStart=this.handleStart.bind(this),this.handleMove=this.handleMove.bind(this),this.handleEnd=this.handleEnd.bind(this),this.handleCancel=this.handleCancel.bind(this),this.handleKeydown=this.handleKeydown.bind(this),this.removeTextSelection=this.removeTextSelection.bind(this),this.attach()}attach(){const{events:n,props:{options:{activationConstraint:s,bypassActivationConstraint:i}}}=this;if(this.listeners.add(n.move.name,this.handleMove,{passive:!1}),this.listeners.add(n.end.name,this.handleEnd),n.cancel&&this.listeners.add(n.cancel.name,this.handleCancel),this.windowListeners.add(xt.Resize,this.handleCancel),this.windowListeners.add(xt.DragStart,gr),this.windowListeners.add(xt.VisibilityChange,this.handleCancel),this.windowListeners.add(xt.ContextMenu,gr),this.documentListeners.add(xt.Keydown,this.handleKeydown),s){if(i!=null&&i({event:this.props.event,activeNode:this.props.activeNode,options:this.props.options}))return this.handleStart();if(pr(s)){this.timeoutId=setTimeout(this.handleStart,s.delay),this.handlePending(s);return}if(xr(s)){this.handlePending(s);return}}this.handleStart()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll(),setTimeout(this.documentListeners.removeAll,50),this.timeoutId!==null&&(clearTimeout(this.timeoutId),this.timeoutId=null)}handlePending(n,s){const{active:i,onPending:o}=this.props;o(i,n,this.initialCoordinates,s)}handleStart(){const{initialCoordinates:n}=this,{onStart:s}=this.props;n&&(this.activated=!0,this.documentListeners.add(xt.Click,ro,{capture:!0}),this.removeTextSelection(),this.documentListeners.add(xt.SelectionChange,this.removeTextSelection),s(n))}handleMove(n){var s;const{activated:i,initialCoordinates:o,props:d}=this,{onMove:u,options:{activationConstraint:f}}=d;if(!o)return;const g=(s=os(n))!=null?s:Nt,p=as(o,g);if(!i&&f){if(xr(f)){if(f.tolerance!=null&&Rs(p,f.tolerance))return this.handleCancel();if(Rs(p,f.distance))return this.handleStart()}if(pr(f)&&Rs(p,f.tolerance))return this.handleCancel();this.handlePending(f,p);return}n.cancelable&&n.preventDefault(),u(g)}handleEnd(){const{onAbort:n,onEnd:s}=this.props;this.detach(),this.activated||n(this.props.active),s()}handleCancel(){const{onAbort:n,onCancel:s}=this.props;this.detach(),this.activated||n(this.props.active),s()}handleKeydown(n){n.code===Z.Esc&&this.handleCancel()}removeTextSelection(){var n;(n=this.document.getSelection())==null||n.removeAllRanges()}}const ao={cancel:{name:"pointercancel"},move:{name:"pointermove"},end:{name:"pointerup"}};class Qs extends Js{constructor(n){const{event:s}=n,i=yn(s.target);super(n,ao,i)}}Qs.activators=[{eventName:"onPointerDown",handler:(e,n)=>{let{nativeEvent:s}=e,{onActivation:i}=n;return!s.isPrimary||s.button!==0?!1:(i==null||i({event:s}),!0)}}];const oo={move:{name:"mousemove"},end:{name:"mouseup"}};var Ps;(function(e){e[e.RightClick=2]="RightClick"})(Ps||(Ps={}));class lo extends Js{constructor(n){super(n,oo,yn(n.event.target))}}lo.activators=[{eventName:"onMouseDown",handler:(e,n)=>{let{nativeEvent:s}=e,{onActivation:i}=n;return s.button===Ps.RightClick?!1:(i==null||i({event:s}),!0)}}];const $s={cancel:{name:"touchcancel"},move:{name:"touchmove"},end:{name:"touchend"}};class co extends Js{constructor(n){super(n,$s)}static setup(){return window.addEventListener($s.move.name,n,{capture:!1,passive:!1}),function(){window.removeEventListener($s.move.name,n)};function n(){}}}co.activators=[{eventName:"onTouchStart",handler:(e,n)=>{let{nativeEvent:s}=e,{onActivation:i}=n;const{touches:o}=s;return o.length>1?!1:(i==null||i({event:s}),!0)}}];var Fn;(function(e){e[e.Pointer=0]="Pointer",e[e.DraggableRect=1]="DraggableRect"})(Fn||(Fn={}));var ds;(function(e){e[e.TreeOrder=0]="TreeOrder",e[e.ReversedTreeOrder=1]="ReversedTreeOrder"})(ds||(ds={}));function uo(e){let{acceleration:n,activator:s=Fn.Pointer,canScroll:i,draggingRect:o,enabled:d,interval:u=5,order:f=ds.TreeOrder,pointerCoordinates:g,scrollableAncestors:p,scrollableAncestorRects:v,delta:w,threshold:k}=e;const S=mo({delta:w,disabled:!d}),[F,_]=ya(),A=a.useRef({x:0,y:0}),O=a.useRef({x:0,y:0}),D=a.useMemo(()=>{switch(s){case Fn.Pointer:return g?{top:g.y,bottom:g.y,left:g.x,right:g.x}:null;case Fn.DraggableRect:return o}},[s,o,g]),R=a.useRef(null),W=a.useCallback(()=>{const K=R.current;if(!K)return;const T=A.current.x*O.current.x,z=A.current.y*O.current.y;K.scrollBy(T,z)},[]),U=a.useMemo(()=>f===ds.TreeOrder?[...p].reverse():p,[f,p]);a.useEffect(()=>{if(!d||!p.length||!D){_();return}for(const K of U){if((i==null?void 0:i(K))===!1)continue;const T=p.indexOf(K),z=v[T];if(!z)continue;const{direction:q,speed:ie}=Qa(K,z,D,n,k);for(const Y of["x","y"])S[Y][q[Y]]||(ie[Y]=0,q[Y]=0);if(ie.x>0||ie.y>0){_(),R.current=K,F(W,u),A.current=ie,O.current=q;return}}A.current={x:0,y:0},O.current={x:0,y:0},_()},[n,W,i,_,d,u,JSON.stringify(D),JSON.stringify(S),F,p,U,v,JSON.stringify(k)])}const fo={x:{[Ee.Backward]:!1,[Ee.Forward]:!1},y:{[Ee.Backward]:!1,[Ee.Forward]:!1}};function mo(e){let{delta:n,disabled:s}=e;const i=is(n);return Un(o=>{if(s||!i||!o)return fo;const d={x:Math.sign(n.x-i.x),y:Math.sign(n.y-i.y)};return{x:{[Ee.Backward]:o.x[Ee.Backward]||d.x===-1,[Ee.Forward]:o.x[Ee.Forward]||d.x===1},y:{[Ee.Backward]:o.y[Ee.Backward]||d.y===-1,[Ee.Forward]:o.y[Ee.Forward]||d.y===1}}},[s,n,i])}function ho(e,n){const s=n!=null?e.get(n):void 0,i=s?s.node.current:null;return Un(o=>{var d;return n==null?null:(d=i??o)!=null?d:null},[i,n])}function go(e,n){return a.useMemo(()=>e.reduce((s,i)=>{const{sensor:o}=i,d=o.activators.map(u=>({eventName:u.eventName,handler:n(u.handler,i)}));return[...s,...d]},[]),[e,n])}var Pn;(function(e){e[e.Always=0]="Always",e[e.BeforeDragging=1]="BeforeDragging",e[e.WhileDragging=2]="WhileDragging"})(Pn||(Pn={}));var Ws;(function(e){e.Optimized="optimized"})(Ws||(Ws={}));const br=new Map;function xo(e,n){let{dragging:s,dependencies:i,config:o}=n;const[d,u]=a.useState(null),{frequency:f,measure:g,strategy:p}=o,v=a.useRef(e),w=A(),k=Bn(w),S=a.useCallback(function(O){O===void 0&&(O=[]),!k.current&&u(D=>D===null?O:D.concat(O.filter(R=>!D.includes(R))))},[k]),F=a.useRef(null),_=Un(O=>{if(w&&!s)return br;if(!O||O===br||v.current!==e||d!=null){const D=new Map;for(let R of e){if(!R)continue;if(d&&d.length>0&&!d.includes(R.id)&&R.rect.current){D.set(R.id,R.rect.current);continue}const W=R.node.current,U=W?new Gs(g(W),W):null;R.rect.current=U,U&&D.set(R.id,U)}return D}return O},[e,d,s,w,g]);return a.useEffect(()=>{v.current=e},[e]),a.useEffect(()=>{w||S()},[s,w]),a.useEffect(()=>{d&&d.length>0&&u(null)},[JSON.stringify(d)]),a.useEffect(()=>{w||typeof f!="number"||F.current!==null||(F.current=setTimeout(()=>{S(),F.current=null},f))},[f,w,S,...i]),{droppableRects:_,measureDroppableContainers:S,measuringScheduled:d!=null};function A(){switch(p){case Pn.Always:return!1;case Pn.BeforeDragging:return s;default:return!s}}}function Zs(e,n){return Un(s=>e?s||(typeof n=="function"?n(e):e):null,[n,e])}function po(e,n){return Zs(e,n)}function bo(e){let{callback:n,disabled:s}=e;const i=us(n),o=a.useMemo(()=>{if(s||typeof window>"u"||typeof window.MutationObserver>"u")return;const{MutationObserver:d}=window;return new d(i)},[i,s]);return a.useEffect(()=>()=>o==null?void 0:o.disconnect(),[o]),o}function ms(e){let{callback:n,disabled:s}=e;const i=us(n),o=a.useMemo(()=>{if(s||typeof window>"u"||typeof window.ResizeObserver>"u")return;const{ResizeObserver:d}=window;return new d(i)},[s]);return a.useEffect(()=>()=>o==null?void 0:o.disconnect(),[o]),o}function yo(e){return new Gs(vn(e),e)}function yr(e,n,s){n===void 0&&(n=yo);const[i,o]=a.useState(null);function d(){o(g=>{if(!e)return null;if(e.isConnected===!1){var p;return(p=g??s)!=null?p:null}const v=n(e);return JSON.stringify(g)===JSON.stringify(v)?g:v})}const u=bo({callback(g){if(e)for(const p of g){const{type:v,target:w}=p;if(v==="childList"&&w instanceof HTMLElement&&w.contains(e)){d();break}}}}),f=ms({callback:d});return wt(()=>{d(),e?(f==null||f.observe(e),u==null||u.observe(document.body,{childList:!0,subtree:!0})):(f==null||f.disconnect(),u==null||u.disconnect())},[e]),i}function vo(e){const n=Zs(e);return zr(e,n)}const vr=[];function wo(e){const n=a.useRef(e),s=Un(i=>e?i&&i!==vr&&e&&n.current&&e.parentNode===n.current.parentNode?i:qs(e):vr,[e]);return a.useEffect(()=>{n.current=e},[e]),s}function No(e){const[n,s]=a.useState(null),i=a.useRef(e),o=a.useCallback(d=>{const u=Ms(d.target);u&&s(f=>f?(f.set(u,Bs(u)),new Map(f)):null)},[]);return a.useEffect(()=>{const d=i.current;if(e!==d){u(d);const f=e.map(g=>{const p=Ms(g);return p?(p.addEventListener("scroll",o,{passive:!0}),[p,Bs(p)]):null}).filter(g=>g!=null);s(f.length?new Map(f):null),i.current=e}return()=>{u(e),u(d)};function u(f){f.forEach(g=>{const p=Ms(g);p==null||p.removeEventListener("scroll",o)})}},[o,e]),a.useMemo(()=>e.length?n?Array.from(n.values()).reduce((d,u)=>pn(d,u),Nt):Vr(e):Nt,[e,n])}function wr(e,n){n===void 0&&(n=[]);const s=a.useRef(null);return a.useEffect(()=>{s.current=null},n),a.useEffect(()=>{const i=e!==Nt;i&&!s.current&&(s.current=e),!i&&s.current&&(s.current=null)},[e]),s.current?as(e,s.current):Nt}function jo(e){a.useEffect(()=>{if(!cs)return;const n=e.map(s=>{let{sensor:i}=s;return i.setup==null?void 0:i.setup()});return()=>{for(const s of n)s==null||s()}},e.map(n=>{let{sensor:s}=n;return s}))}function Co(e,n){return a.useMemo(()=>e.reduce((s,i)=>{let{eventName:o,handler:d}=i;return s[o]=u=>{d(u,n)},s},{}),[e,n])}function Gr(e){return a.useMemo(()=>e?Ha(e):null,[e])}const Nr=[];function So(e,n){n===void 0&&(n=vn);const[s]=e,i=Gr(s?Ye(s):null),[o,d]=a.useState(Nr);function u(){d(()=>e.length?e.map(g=>Xr(g)?i:new Gs(n(g),g)):Nr)}const f=ms({callback:u});return wt(()=>{f==null||f.disconnect(),u(),e.forEach(g=>f==null?void 0:f.observe(g))},[e]),o}function Jr(e){if(!e)return null;if(e.children.length>1)return e;const n=e.children[0];return Wn(n)?n:e}function ko(e){let{measure:n}=e;const[s,i]=a.useState(null),o=a.useCallback(p=>{for(const{target:v}of p)if(Wn(v)){i(w=>{const k=n(v);return w?{...w,width:k.width,height:k.height}:k});break}},[n]),d=ms({callback:o}),u=a.useCallback(p=>{const v=Jr(p);d==null||d.disconnect(),v&&(d==null||d.observe(v)),i(v?n(v):null)},[n,d]),[f,g]=rs(u);return a.useMemo(()=>({nodeRef:f,rect:s,setRef:g}),[s,f,g])}const Do=[{sensor:Qs,options:{}},{sensor:qr,options:{}}],_o={current:{}},ns={draggable:{measure:hr},droppable:{measure:hr,strategy:Pn.WhileDragging,frequency:Ws.Optimized},dragOverlay:{measure:vn}};class zn extends Map{get(n){var s;return n!=null&&(s=super.get(n))!=null?s:void 0}toArray(){return Array.from(this.values())}getEnabled(){return this.toArray().filter(n=>{let{disabled:s}=n;return!s})}getNodeFor(n){var s,i;return(s=(i=this.get(n))==null?void 0:i.node.current)!=null?s:void 0}}const Ao={activatorEvent:null,active:null,activeNode:null,activeNodeRect:null,collisions:null,containerNodeRect:null,draggableNodes:new Map,droppableRects:new Map,droppableContainers:new zn,over:null,dragOverlay:{nodeRef:{current:null},rect:null,setRef:ls},scrollableAncestors:[],scrollableAncestorRects:[],measuringConfiguration:ns,measureDroppableContainers:ls,windowRect:null,measuringScheduled:!1},Qr={activatorEvent:null,activators:[],active:null,activeNodeRect:null,ariaDescribedById:{draggable:""},dispatch:ls,draggableNodes:new Map,over:null,measureDroppableContainers:ls},Kn=a.createContext(Qr),Zr=a.createContext(Ao);function Lo(){return{draggable:{active:null,initialCoordinates:{x:0,y:0},nodes:new Map,translate:{x:0,y:0}},droppable:{containers:new zn}}}function Eo(e,n){switch(n.type){case De.DragStart:return{...e,draggable:{...e.draggable,initialCoordinates:n.initialCoordinates,active:n.active}};case De.DragMove:return e.draggable.active==null?e:{...e,draggable:{...e.draggable,translate:{x:n.coordinates.x-e.draggable.initialCoordinates.x,y:n.coordinates.y-e.draggable.initialCoordinates.y}}};case De.DragEnd:case De.DragCancel:return{...e,draggable:{...e.draggable,active:null,initialCoordinates:{x:0,y:0},translate:{x:0,y:0}}};case De.RegisterDroppable:{const{element:s}=n,{id:i}=s,o=new zn(e.droppable.containers);return o.set(i,s),{...e,droppable:{...e.droppable,containers:o}}}case De.SetDroppableDisabled:{const{id:s,key:i,disabled:o}=n,d=e.droppable.containers.get(s);if(!d||i!==d.key)return e;const u=new zn(e.droppable.containers);return u.set(s,{...d,disabled:o}),{...e,droppable:{...e.droppable,containers:u}}}case De.UnregisterDroppable:{const{id:s,key:i}=n,o=e.droppable.containers.get(s);if(!o||i!==o.key)return e;const d=new zn(e.droppable.containers);return d.delete(s),{...e,droppable:{...e.droppable,containers:d}}}default:return e}}function Mo(e){let{disabled:n}=e;const{active:s,activatorEvent:i,draggableNodes:o}=a.useContext(Kn),d=is(i),u=is(s==null?void 0:s.id);return a.useEffect(()=>{if(!n&&!i&&d&&u!=null){if(!fs(d)||document.activeElement===d.target)return;const f=o.get(u);if(!f)return;const{activatorNode:g,node:p}=f;if(!g.current&&!p.current)return;requestAnimationFrame(()=>{for(const v of[g.current,p.current]){if(!v)continue;const w=Na(v);if(w){w.focus();break}}})}},[i,n,o,u,d]),null}function ei(e,n){let{transform:s,...i}=n;return e!=null&&e.length?e.reduce((o,d)=>d({transform:o,...i}),s):s}function Ro(e){return a.useMemo(()=>({draggable:{...ns.draggable,...e==null?void 0:e.draggable},droppable:{...ns.droppable,...e==null?void 0:e.droppable},dragOverlay:{...ns.dragOverlay,...e==null?void 0:e.dragOverlay}}),[e==null?void 0:e.draggable,e==null?void 0:e.droppable,e==null?void 0:e.dragOverlay])}function $o(e){let{activeNode:n,measure:s,initialRect:i,config:o=!0}=e;const d=a.useRef(!1),{x:u,y:f}=typeof o=="boolean"?{x:o,y:o}:o;wt(()=>{if(!u&&!f||!n){d.current=!1;return}if(d.current||!i)return;const p=n==null?void 0:n.node.current;if(!p||p.isConnected===!1)return;const v=s(p),w=zr(v,i);if(u||(w.x=0),f||(w.y=0),d.current=!0,Math.abs(w.x)>0||Math.abs(w.y)>0){const k=Pr(p);k&&k.scrollBy({top:w.y,left:w.x})}},[n,u,f,i,s])}const hs=a.createContext({...Nt,scaleX:1,scaleY:1});var Kt;(function(e){e[e.Uninitialized=0]="Uninitialized",e[e.Initializing=1]="Initializing",e[e.Initialized=2]="Initialized"})(Kt||(Kt={}));const Io=a.memo(function(n){var s,i,o,d;let{id:u,accessibility:f,autoScroll:g=!0,children:p,sensors:v=Do,collisionDetection:w=Ba,measuring:k,modifiers:S,...F}=n;const _=a.useReducer(Eo,void 0,Lo),[A,O]=_,[D,R]=_a(),[W,U]=a.useState(Kt.Uninitialized),K=W===Kt.Initialized,{draggable:{active:T,nodes:z,translate:q},droppable:{containers:ie}}=A,Y=T!=null?z.get(T):null,ve=a.useRef({initial:null,translated:null}),ge=a.useMemo(()=>{var te;return T!=null?{id:T,data:(te=Y==null?void 0:Y.data)!=null?te:_o,rect:ve}:null},[T,Y]),Me=a.useRef(null),[He,ut]=a.useState(null),[me,qe]=a.useState(null),_e=Bn(F,Object.values(F)),ze=Xn("DndDescribedBy",u),Ge=a.useMemo(()=>ie.getEnabled(),[ie]),ae=Ro(k),{droppableRects:Be,measureDroppableContainers:ee,measuringScheduled:rt}=xo(Ge,{dragging:K,dependencies:[q.x,q.y],config:ae.droppable}),xe=ho(z,T),jt=a.useMemo(()=>me?os(me):null,[me]),Ie=Bt(),Te=po(xe,ae.draggable.measure);$o({activeNode:T!=null?z.get(T):null,config:Ie.layoutShiftCompensation,initialRect:Te,measure:ae.draggable.measure});const H=yr(xe,ae.draggable.measure,Te),ft=yr(xe?xe.parentElement:null),Oe=a.useRef({activatorEvent:null,active:null,activeNode:xe,collisionRect:null,collisions:null,droppableRects:Be,draggableNodes:z,draggingNode:null,draggingNodeRect:null,droppableContainers:ie,over:null,scrollableAncestors:[],scrollAdjustedTranslate:null}),it=ie.getNodeFor((s=Oe.current.over)==null?void 0:s.id),Re=ko({measure:ae.dragOverlay.measure}),Ae=(i=Re.nodeRef.current)!=null?i:xe,mt=K?(o=Re.rect)!=null?o:H:null,at=!!(Re.nodeRef.current&&Re.rect),ot=vo(at?null:H),Je=Gr(Ae?Ye(Ae):null),ke=wo(K?it??xe:null),Pe=So(ke),Qe=ei(S,{transform:{x:q.x-ot.x,y:q.y-ot.y,scaleX:1,scaleY:1},activatorEvent:me,active:ge,activeNodeRect:H,containerNodeRect:ft,draggingNodeRect:mt,over:Oe.current.over,overlayNodeRect:Re.rect,scrollableAncestors:ke,scrollableAncestorRects:Pe,windowRect:Je}),Ft=jt?pn(jt,q):null,Ze=No(ke),At=wr(Ze),Fe=wr(Ze,[H]),et=pn(Qe,At),we=mt?Ka(mt,Qe):null,ht=ge&&we?w({active:ge,collisionRect:we,droppableRects:Be,droppableContainers:Ge,pointerCoordinates:Ft}):null,Le=Ta(ht,"id"),[We,Yt]=a.useState(null),ln=at?Qe:pn(Qe,Fe),Ht=Ua(ln,(d=We==null?void 0:We.rect)!=null?d:null,H),Lt=a.useRef(null),Et=a.useCallback((te,Ne)=>{let{sensor:le,options:Ue}=Ne;if(Me.current==null)return;const he=z.get(Me.current);if(!he)return;const je=te.nativeEvent,de=new le({active:Me.current,activeNode:he,event:je,options:Ue,context:Oe,onAbort(re){if(!z.get(re))return;const{onDragAbort:Ce}=_e.current,pe={id:re};Ce==null||Ce(pe),D({type:"onDragAbort",event:pe})},onPending(re,Ke,Ce,pe){if(!z.get(re))return;const{onDragPending:lt}=_e.current,ue={id:re,constraint:Ke,initialCoordinates:Ce,offset:pe};lt==null||lt(ue),D({type:"onDragPending",event:ue})},onStart(re){const Ke=Me.current;if(Ke==null)return;const Ce=z.get(Ke);if(!Ce)return;const{onDragStart:pe}=_e.current,tt={activatorEvent:je,active:{id:Ke,data:Ce.data,rect:ve}};Tn.unstable_batchedUpdates(()=>{pe==null||pe(tt),U(Kt.Initializing),O({type:De.DragStart,initialCoordinates:re,active:Ke}),D({type:"onDragStart",event:tt}),ut(Lt.current),qe(je)})},onMove(re){O({type:De.DragMove,coordinates:re})},onEnd:Xe(De.DragEnd),onCancel:Xe(De.DragCancel)});Lt.current=de;function Xe(re){return async function(){const{active:Ce,collisions:pe,over:tt,scrollAdjustedTranslate:lt}=Oe.current;let ue=null;if(Ce&&lt){const{cancelDrop:kt}=_e.current;ue={activatorEvent:je,active:Ce,collisions:pe,delta:lt,over:tt},re===De.DragEnd&&typeof kt=="function"&&await Promise.resolve(kt(ue))&&(re=De.DragCancel)}Me.current=null,Tn.unstable_batchedUpdates(()=>{O({type:re}),U(Kt.Uninitialized),Yt(null),ut(null),qe(null),Lt.current=null;const kt=re===De.DragEnd?"onDragEnd":"onDragCancel";if(ue){const dt=_e.current[kt];dt==null||dt(ue),D({type:kt,event:ue})}})}}},[z]),qt=a.useCallback((te,Ne)=>(le,Ue)=>{const he=le.nativeEvent,je=z.get(Ue);if(Me.current!==null||!je||he.dndKit||he.defaultPrevented)return;const de={active:je};te(le,Ne.options,de)===!0&&(he.dndKit={capturedBy:Ne.sensor},Me.current=Ue,Et(le,Ne))},[z,Et]),zt=go(v,qt);jo(v),wt(()=>{H&&W===Kt.Initializing&&U(Kt.Initialized)},[H,W]),a.useEffect(()=>{const{onDragMove:te}=_e.current,{active:Ne,activatorEvent:le,collisions:Ue,over:he}=Oe.current;if(!Ne||!le)return;const je={active:Ne,activatorEvent:le,collisions:Ue,delta:{x:et.x,y:et.y},over:he};Tn.unstable_batchedUpdates(()=>{te==null||te(je),D({type:"onDragMove",event:je})})},[et.x,et.y]),a.useEffect(()=>{const{active:te,activatorEvent:Ne,collisions:le,droppableContainers:Ue,scrollAdjustedTranslate:he}=Oe.current;if(!te||Me.current==null||!Ne||!he)return;const{onDragOver:je}=_e.current,de=Ue.get(Le),Xe=de&&de.rect.current?{id:de.id,rect:de.rect.current,data:de.data,disabled:de.disabled}:null,re={active:te,activatorEvent:Ne,collisions:le,delta:{x:he.x,y:he.y},over:Xe};Tn.unstable_batchedUpdates(()=>{Yt(Xe),je==null||je(re),D({type:"onDragOver",event:re})})},[Le]),wt(()=>{Oe.current={activatorEvent:me,active:ge,activeNode:xe,collisionRect:we,collisions:ht,droppableRects:Be,draggableNodes:z,draggingNode:Ae,draggingNodeRect:mt,droppableContainers:ie,over:We,scrollableAncestors:ke,scrollAdjustedTranslate:et},ve.current={initial:mt,translated:we}},[ge,xe,ht,we,z,Ae,mt,Be,ie,We,ke,et]),uo({...Ie,delta:q,draggingRect:we,pointerCoordinates:Ft,scrollableAncestors:ke,scrollableAncestorRects:Pe});const Ct=a.useMemo(()=>({active:ge,activeNode:xe,activeNodeRect:H,activatorEvent:me,collisions:ht,containerNodeRect:ft,dragOverlay:Re,draggableNodes:z,droppableContainers:ie,droppableRects:Be,over:We,measureDroppableContainers:ee,scrollableAncestors:ke,scrollableAncestorRects:Pe,measuringConfiguration:ae,measuringScheduled:rt,windowRect:Je}),[ge,xe,H,me,ht,ft,Re,z,ie,Be,We,ee,ke,Pe,ae,rt,Je]),St=a.useMemo(()=>({activatorEvent:me,activators:zt,active:ge,activeNodeRect:H,ariaDescribedById:{draggable:ze},dispatch:O,draggableNodes:z,over:We,measureDroppableContainers:ee}),[me,zt,ge,H,O,ze,z,We,ee]);return oe.createElement(Fr.Provider,{value:R},oe.createElement(Kn.Provider,{value:St},oe.createElement(Zr.Provider,{value:Ct},oe.createElement(hs.Provider,{value:Ht},p)),oe.createElement(Mo,{disabled:(f==null?void 0:f.restoreFocus)===!1})),oe.createElement(Ea,{...f,hiddenTextDescribedById:ze}));function Bt(){const te=(He==null?void 0:He.autoScrollEnabled)===!1,Ne=typeof g=="object"?g.enabled===!1:g===!1,le=K&&!te&&!Ne;return typeof g=="object"?{...g,enabled:le}:{enabled:le}}}),To=a.createContext(null),jr="button",Oo="Draggable";function Fo(e){let{id:n,data:s,disabled:i=!1,attributes:o}=e;const d=Xn(Oo),{activators:u,activatorEvent:f,active:g,activeNodeRect:p,ariaDescribedById:v,draggableNodes:w,over:k}=a.useContext(Kn),{role:S=jr,roleDescription:F="draggable",tabIndex:_=0}=o??{},A=(g==null?void 0:g.id)===n,O=a.useContext(A?hs:To),[D,R]=rs(),[W,U]=rs(),K=Co(u,n),T=Bn(s);wt(()=>(w.set(n,{id:n,key:d,node:D,activatorNode:W,data:T}),()=>{const q=w.get(n);q&&q.key===d&&w.delete(n)}),[w,n]);const z=a.useMemo(()=>({role:S,tabIndex:_,"aria-disabled":i,"aria-pressed":A&&S===jr?!0:void 0,"aria-roledescription":F,"aria-describedby":v.draggable}),[i,S,_,A,F,v.draggable]);return{active:g,activatorEvent:f,activeNodeRect:p,attributes:z,isDragging:A,listeners:i?void 0:K,node:D,over:k,setNodeRef:R,setActivatorNodeRef:U,transform:O}}function ti(){return a.useContext(Zr)}const zo="Droppable",Bo={timeout:25};function Po(e){let{data:n,disabled:s=!1,id:i,resizeObserverConfig:o}=e;const d=Xn(zo),{active:u,dispatch:f,over:g,measureDroppableContainers:p}=a.useContext(Kn),v=a.useRef({disabled:s}),w=a.useRef(!1),k=a.useRef(null),S=a.useRef(null),{disabled:F,updateMeasurementsFor:_,timeout:A}={...Bo,...o},O=Bn(_??i),D=a.useCallback(()=>{if(!w.current){w.current=!0;return}S.current!=null&&clearTimeout(S.current),S.current=setTimeout(()=>{p(Array.isArray(O.current)?O.current:[O.current]),S.current=null},A)},[A]),R=ms({callback:D,disabled:F||!u}),W=a.useCallback((z,q)=>{R&&(q&&(R.unobserve(q),w.current=!1),z&&R.observe(z))},[R]),[U,K]=rs(W),T=Bn(n);return a.useEffect(()=>{!R||!U.current||(R.disconnect(),w.current=!1,R.observe(U.current))},[U,R]),a.useEffect(()=>(f({type:De.RegisterDroppable,element:{id:i,key:d,disabled:s,node:U,rect:k,data:T}}),()=>f({type:De.UnregisterDroppable,key:d,id:i})),[i]),a.useEffect(()=>{s!==v.current.disabled&&(f({type:De.SetDroppableDisabled,id:i,key:d,disabled:s}),v.current.disabled=s)},[i,d,s,f]),{active:u,rect:k,isOver:(g==null?void 0:g.id)===i,node:U,over:g,setNodeRef:K}}function Wo(e){let{animation:n,children:s}=e;const[i,o]=a.useState(null),[d,u]=a.useState(null),f=is(s);return!s&&!i&&f&&o(f),wt(()=>{if(!d)return;const g=i==null?void 0:i.key,p=i==null?void 0:i.props.id;if(g==null||p==null){o(null);return}Promise.resolve(n(p,d)).then(()=>{o(null)})},[n,i,d]),oe.createElement(oe.Fragment,null,s,i?a.cloneElement(i,{ref:u}):null)}const Uo={x:0,y:0,scaleX:1,scaleY:1};function Xo(e){let{children:n}=e;return oe.createElement(Kn.Provider,{value:Qr},oe.createElement(hs.Provider,{value:Uo},n))}const Ko={position:"fixed",touchAction:"none"},Vo=e=>fs(e)?"transform 250ms ease":void 0,Yo=a.forwardRef((e,n)=>{let{as:s,activatorEvent:i,adjustScale:o,children:d,className:u,rect:f,style:g,transform:p,transition:v=Vo}=e;if(!f)return null;const w=o?p:{...p,scaleX:1,scaleY:1},k={...Ko,width:f.width,height:f.height,top:f.top,left:f.left,transform:Ot.Transform.toString(w),transformOrigin:o&&i?$a(i,f):void 0,transition:typeof v=="function"?v(i):v,...g};return oe.createElement(s,{className:u,style:k,ref:n},d)}),Ho=e=>n=>{let{active:s,dragOverlay:i}=n;const o={},{styles:d,className:u}=e;if(d!=null&&d.active)for(const[f,g]of Object.entries(d.active))g!==void 0&&(o[f]=s.node.style.getPropertyValue(f),s.node.style.setProperty(f,g));if(d!=null&&d.dragOverlay)for(const[f,g]of Object.entries(d.dragOverlay))g!==void 0&&i.node.style.setProperty(f,g);return u!=null&&u.active&&s.node.classList.add(u.active),u!=null&&u.dragOverlay&&i.node.classList.add(u.dragOverlay),function(){for(const[g,p]of Object.entries(o))s.node.style.setProperty(g,p);u!=null&&u.active&&s.node.classList.remove(u.active)}},qo=e=>{let{transform:{initial:n,final:s}}=e;return[{transform:Ot.Transform.toString(n)},{transform:Ot.Transform.toString(s)}]},Go={duration:250,easing:"ease",keyframes:qo,sideEffects:Ho({styles:{active:{opacity:"0"}}})};function Jo(e){let{config:n,draggableNodes:s,droppableContainers:i,measuringConfiguration:o}=e;return us((d,u)=>{if(n===null)return;const f=s.get(d);if(!f)return;const g=f.node.current;if(!g)return;const p=Jr(u);if(!p)return;const{transform:v}=Ye(u).getComputedStyle(u),w=Br(v);if(!w)return;const k=typeof n=="function"?n:Qo(n);return Yr(g,o.draggable.measure),k({active:{id:d,data:f.data,node:g,rect:o.draggable.measure(g)},draggableNodes:s,dragOverlay:{node:u,rect:o.dragOverlay.measure(p)},droppableContainers:i,measuringConfiguration:o,transform:w})})}function Qo(e){const{duration:n,easing:s,sideEffects:i,keyframes:o}={...Go,...e};return d=>{let{active:u,dragOverlay:f,transform:g,...p}=d;if(!n)return;const v={x:f.rect.left-u.rect.left,y:f.rect.top-u.rect.top},w={scaleX:g.scaleX!==1?u.rect.width*g.scaleX/f.rect.width:1,scaleY:g.scaleY!==1?u.rect.height*g.scaleY/f.rect.height:1},k={x:g.x-v.x,y:g.y-v.y,...w},S=o({...p,active:u,dragOverlay:f,transform:{initial:g,final:k}}),[F]=S,_=S[S.length-1];if(JSON.stringify(F)===JSON.stringify(_))return;const A=i==null?void 0:i({active:u,dragOverlay:f,...p}),O=f.node.animate(S,{duration:n,easing:s,fill:"forwards"});return new Promise(D=>{O.onfinish=()=>{A==null||A(),D()}})}}let Cr=0;function Zo(e){return a.useMemo(()=>{if(e!=null)return Cr++,Cr},[e])}const el=oe.memo(e=>{let{adjustScale:n=!1,children:s,dropAnimation:i,style:o,transition:d,modifiers:u,wrapperElement:f="div",className:g,zIndex:p=999}=e;const{activatorEvent:v,active:w,activeNodeRect:k,containerNodeRect:S,draggableNodes:F,droppableContainers:_,dragOverlay:A,over:O,measuringConfiguration:D,scrollableAncestors:R,scrollableAncestorRects:W,windowRect:U}=ti(),K=a.useContext(hs),T=Zo(w==null?void 0:w.id),z=ei(u,{activatorEvent:v,active:w,activeNodeRect:k,containerNodeRect:S,draggingNodeRect:A.rect,over:O,overlayNodeRect:A.rect,scrollableAncestors:R,scrollableAncestorRects:W,transform:K,windowRect:U}),q=Zs(k),ie=Jo({config:i,draggableNodes:F,droppableContainers:_,measuringConfiguration:D}),Y=q?A.setRef:void 0;return oe.createElement(Xo,null,oe.createElement(Wo,{animation:ie},w&&T?oe.createElement(Yo,{key:T,id:w.id,ref:Y,as:f,activatorEvent:v,adjustScale:n,className:g,transition:d,rect:q,style:{zIndex:p,...o},transform:z},s):null))});function er(e,n,s){const i=e.slice();return i.splice(s<0?i.length+s:s,0,i.splice(n,1)[0]),i}function tl(e,n){return e.reduce((s,i,o)=>{const d=n.get(i);return d&&(s[o]=d),s},Array(e.length))}function Zn(e){return e!==null&&e>=0}function nl(e,n){if(e===n)return!0;if(e.length!==n.length)return!1;for(let s=0;s<e.length;s++)if(e[s]!==n[s])return!1;return!0}function sl(e){return typeof e=="boolean"?{draggable:e,droppable:e}:e}const es={scaleX:1,scaleY:1},$n=e=>{var n;let{rects:s,activeNodeRect:i,activeIndex:o,overIndex:d,index:u}=e;const f=(n=s[o])!=null?n:i;if(!f)return null;const g=rl(s,u,o);if(u===o){const p=s[d];return p?{x:o<d?p.left+p.width-(f.left+f.width):p.left-f.left,y:0,...es}:null}return u>o&&u<=d?{x:-f.width-g,y:0,...es}:u<o&&u>=d?{x:f.width+g,y:0,...es}:{x:0,y:0,...es}};function rl(e,n,s){const i=e[n],o=e[n-1],d=e[n+1];return!i||!o&&!d?0:s<n?o?i.left-(o.left+o.width):d.left-(i.left+i.width):d?d.left-(i.left+i.width):i.left-(o.left+o.width)}const ni=e=>{let{rects:n,activeIndex:s,overIndex:i,index:o}=e;const d=er(n,i,s),u=n[o],f=d[o];return!f||!u?null:{x:f.left-u.left,y:f.top-u.top,scaleX:f.width/u.width,scaleY:f.height/u.height}},ts={scaleX:1,scaleY:1},il=e=>{var n;let{activeIndex:s,activeNodeRect:i,index:o,rects:d,overIndex:u}=e;const f=(n=d[s])!=null?n:i;if(!f)return null;if(o===s){const p=d[u];return p?{x:0,y:s<u?p.top+p.height-(f.top+f.height):p.top-f.top,...ts}:null}const g=al(d,o,s);return o>s&&o<=u?{x:0,y:-f.height-g,...ts}:o<s&&o>=u?{x:0,y:f.height+g,...ts}:{x:0,y:0,...ts}};function al(e,n,s){const i=e[n],o=e[n-1],d=e[n+1];return i?s<n?o?i.top-(o.top+o.height):d?d.top-(i.top+i.height):0:d?d.top-(i.top+i.height):o?i.top-(o.top+o.height):0:0}const si="Sortable",ri=oe.createContext({activeIndex:-1,containerId:si,disableTransforms:!1,items:[],overIndex:-1,useDragOverlay:!1,sortedRects:[],strategy:ni,disabled:{draggable:!1,droppable:!1}});function xn(e){let{children:n,id:s,items:i,strategy:o=ni,disabled:d=!1}=e;const{active:u,dragOverlay:f,droppableRects:g,over:p,measureDroppableContainers:v}=ti(),w=Xn(si,s),k=f.rect!==null,S=a.useMemo(()=>i.map(K=>typeof K=="object"&&"id"in K?K.id:K),[i]),F=u!=null,_=u?S.indexOf(u.id):-1,A=p?S.indexOf(p.id):-1,O=a.useRef(S),D=!nl(S,O.current),R=A!==-1&&_===-1||D,W=sl(d);wt(()=>{D&&F&&v(S)},[D,S,F,v]),a.useEffect(()=>{O.current=S},[S]);const U=a.useMemo(()=>({activeIndex:_,containerId:w,disabled:W,disableTransforms:R,items:S,overIndex:A,useDragOverlay:k,sortedRects:tl(S,g),strategy:o}),[_,w,W.draggable,W.droppable,R,S,A,g,k,o]);return oe.createElement(ri.Provider,{value:U},n)}const ol=e=>{let{id:n,items:s,activeIndex:i,overIndex:o}=e;return er(s,i,o).indexOf(n)},ll=e=>{let{containerId:n,isSorting:s,wasDragging:i,index:o,items:d,newIndex:u,previousItems:f,previousContainerId:g,transition:p}=e;return!p||!i||f!==d&&o===u?!1:s?!0:u!==o&&n===g},dl={duration:200,easing:"ease"},ii="transform",cl=Ot.Transition.toString({property:ii,duration:0,easing:"linear"}),ul={roleDescription:"sortable"};function fl(e){let{disabled:n,index:s,node:i,rect:o}=e;const[d,u]=a.useState(null),f=a.useRef(s);return wt(()=>{if(!n&&s!==f.current&&i.current){const g=o.current;if(g){const p=vn(i.current,{ignoreTransform:!0}),v={x:g.left-p.left,y:g.top-p.top,scaleX:g.width/p.width,scaleY:g.height/p.height};(v.x||v.y)&&u(v)}}s!==f.current&&(f.current=s)},[n,s,i,o]),a.useEffect(()=>{d&&u(null)},[d]),d}function ai(e){let{animateLayoutChanges:n=ll,attributes:s,disabled:i,data:o,getNewIndex:d=ol,id:u,strategy:f,resizeObserverConfig:g,transition:p=dl}=e;const{items:v,containerId:w,activeIndex:k,disabled:S,disableTransforms:F,sortedRects:_,overIndex:A,useDragOverlay:O,strategy:D}=a.useContext(ri),R=ml(i,S),W=v.indexOf(u),U=a.useMemo(()=>({sortable:{containerId:w,index:W,items:v},...o}),[w,o,W,v]),K=a.useMemo(()=>v.slice(v.indexOf(u)),[v,u]),{rect:T,node:z,isOver:q,setNodeRef:ie}=Po({id:u,data:U,disabled:R.droppable,resizeObserverConfig:{updateMeasurementsFor:K,...g}}),{active:Y,activatorEvent:ve,activeNodeRect:ge,attributes:Me,setNodeRef:He,listeners:ut,isDragging:me,over:qe,setActivatorNodeRef:_e,transform:ze}=Fo({id:u,data:U,attributes:{...ul,...s},disabled:R.draggable}),Ge=ba(ie,He),ae=!!Y,Be=ae&&!F&&Zn(k)&&Zn(A),ee=!O&&me,rt=ee&&Be?ze:null,jt=Be?rt??(f??D)({rects:_,activeNodeRect:ge,activeIndex:k,overIndex:A,index:W}):null,Ie=Zn(k)&&Zn(A)?d({id:u,items:v,activeIndex:k,overIndex:A}):W,Te=Y==null?void 0:Y.id,H=a.useRef({activeId:Te,items:v,newIndex:Ie,containerId:w}),ft=v!==H.current.items,Oe=n({active:Y,containerId:w,isDragging:me,isSorting:ae,id:u,index:W,items:v,newIndex:H.current.newIndex,previousItems:H.current.items,previousContainerId:H.current.containerId,transition:p,wasDragging:H.current.activeId!=null}),it=fl({disabled:!Oe,index:W,node:z,rect:T});return a.useEffect(()=>{ae&&H.current.newIndex!==Ie&&(H.current.newIndex=Ie),w!==H.current.containerId&&(H.current.containerId=w),v!==H.current.items&&(H.current.items=v)},[ae,Ie,w,v]),a.useEffect(()=>{if(Te===H.current.activeId)return;if(Te!=null&&H.current.activeId==null){H.current.activeId=Te;return}const Ae=setTimeout(()=>{H.current.activeId=Te},50);return()=>clearTimeout(Ae)},[Te]),{active:Y,activeIndex:k,attributes:Me,data:U,rect:T,index:W,newIndex:Ie,items:v,isOver:q,isSorting:ae,isDragging:me,listeners:ut,node:z,overIndex:A,over:qe,setNodeRef:Ge,setActivatorNodeRef:_e,setDroppableNodeRef:ie,setDraggableNodeRef:He,transform:it??jt,transition:Re()};function Re(){if(it||ft&&H.current.newIndex===W)return cl;if(!(ee&&!fs(ve)||!p)&&(ae||Oe))return Ot.Transition.toString({...p,property:ii})}}function ml(e,n){var s,i;return typeof e=="boolean"?{draggable:e,droppable:!1}:{draggable:(s=e==null?void 0:e.draggable)!=null?s:n.draggable,droppable:(i=e==null?void 0:e.droppable)!=null?i:n.droppable}}Z.Down,Z.Right,Z.Up,Z.Left;const Sr=["bg-sky-600","bg-emerald-600","bg-violet-600","bg-rose-600","bg-amber-600"];function Vt(e){if(!e)return"No date set";const n=new Date(e);if(isNaN(n.getTime()))return"Invalid date";const s=n.getDate(),i=n.toLocaleString("en-US",{month:"long"}),o=n.getFullYear();let d="th";return s===1||s===21||s===31?d="st":s===2||s===22?d="nd":(s===3||s===23)&&(d="rd"),`${s}${d} ${i} ${o}`}function Is(e){return e?typeof e=="string"?/^\d{4}-\d{2}-\d{2}$/.test(e)?e:e.includes("T")?e.split("T")[0]:"":e instanceof Date&&!isNaN(e.getTime())?e.toISOString().split("T")[0]:"":""}function Us(e){return new Date(e).toLocaleString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"numeric",minute:"2-digit",hour12:!0})}function Xs(e){return!e||e<=0?"":e<1024?`${e} B`:e<1024*1024?`${(e/1024).toFixed(1)} KB`:`${(e/(1024*1024)).toFixed(1)} MB`}function kr(e){if(!e)return null;const s=e.trim().slice(0,10).match(/^(\d{4})-(\d{2})-(\d{2})$/);if(!s)return null;const i=Number(s[1]),o=Number(s[2])-1,d=Number(s[3]);return new Date(i,o,d)}function hl(e){const n=(e.first_name||"").trim().charAt(0),s=(e.last_name||"").trim().charAt(0),i=(e.email||"").trim().charAt(0);return(`${n}${s}`.trim()||i||"U").toUpperCase()}const In=["Student's Phone Number:","Student's Email:","Emergency Phone Number:","Date of Birth:","","Education Background (Grades & Stream):","Gap explanation if applicable:","English Proficiency:","","Intended Level of Study:","Interested Program Of Study:","Institution/City Preference:","Maximum Budget:","","Funding Details:","Sponsor:","Source of Income:","Funds Breakdown:"].join(`
`),gl=a.lazy(()=>Hi(()=>import("./index.es-C11ycVPm.js"),__vite__mapDeps([0,1,2,3])));function xl({card:e,listTitle:n,profile:s,onClose:i,setSelectedCard:o,fetchBoard:d}){var be;const[u,f]=a.useState(!1),[g,p]=a.useState([]),[v,w]=a.useState(null),[k,S]=a.useState([]),[F,_]=a.useState("country"),[A,O]=a.useState([]),[D,R]=a.useState([]),[W,U]=a.useState([]),[K,T]=a.useState(!1),[z,q]=a.useState(!1),[ie,Y]=a.useState((be=e.description)!=null&&be.trim()?e.description:In),[ve,ge]=a.useState(!1),Me=a.useRef(null),[He,ut]=a.useState(!1),[me,qe]=a.useState(Is(e.due_date)),[_e,ze]=a.useState(!1),[Ge,ae]=a.useState(!1),[Be,ee]=a.useState(e.invoice||""),[rt,xe]=a.useState(e.first_name||""),[jt,Ie]=a.useState(e.last_name||""),[Te,H]=a.useState(!1),[ft,Oe]=a.useState(!!e.payment_done),[it,Re]=a.useState(!!e.dependant_payment_done),[Ae,mt]=a.useState(!1),[at,ot]=a.useState(!1),[Je,ke]=a.useState(!1),[Pe,Qe]=a.useState(!1),[Ft,Ze]=a.useState(!1),At=a.useRef(null),[Fe,et]=a.useState([]),[we,ht]=a.useState(""),[Le,We]=a.useState(null),[Yt,ln]=a.useState(0),[Ht,Lt]=a.useState(!1),[Et,qt]=a.useState(null),[zt,Ct]=a.useState(!1),[St,Bt]=a.useState(!1),[te,Ne]=a.useState(!1),[le,Ue]=a.useState([]),[he,je]=a.useState([]),[de,Xe]=a.useState([]),[re,Ke]=a.useState(""),[Ce,pe]=a.useState(null),tt=Number(s==null?void 0:s.role_id)===1||Number(s==null?void 0:s.role_id)===2,lt=[1,2,3].includes(Number(s==null?void 0:s.role_id));a.useEffect(()=>{var N;const l=Array.isArray(e.country_label_ids)?e.country_label_ids:e.country_label_id!=null?[e.country_label_id]:[];p(l),w(e.intake_label_id??null);const y=Array.isArray(e.service_area_ids)?e.service_area_ids:e.service_area_id!=null?[e.service_area_id]:[];S(y),_("country"),Y((N=e.description)!=null&&N.trim()?e.description:In),qe(Is(e.due_date)),ae(!1),ee(e.invoice||""),xe(e.first_name||""),Ie(e.last_name||""),Oe(!!e.payment_done),Re(!!e.dependant_payment_done),Qe(!1),Ze(!1),Ct(!1),Ue([]),je([]),Xe([]),Ke(""),pe(null),ue(),dn()},[e]),a.useEffect(()=>{if(!z||!Me.current)return;const l=Me.current;l.style.height="0px",l.style.height=`${l.scrollHeight}px`},[z,ie]),a.useEffect(()=>{Promise.all([Dt(),Nn(),Gt()])},[e.id]),a.useEffect(()=>{const l=y=>{if(y.key==="Escape"){if(Pe){Qe(!1);return}if(Ge){ae(!1),ee(e.invoice||""),xe(e.first_name||""),Ie(e.last_name||"");return}y.preventDefault(),i()}};return window.addEventListener("keydown",l),()=>window.removeEventListener("keydown",l)},[i,Pe,Ge,e.invoice,e.first_name,e.last_name]),a.useEffect(()=>{if(!Pe)return;const l=y=>{At.current&&(At.current.contains(y.target)||Qe(!1))};return document.addEventListener("mousedown",l),()=>document.removeEventListener("mousedown",l)},[Pe]);const ue=async()=>{try{const l=await V.get(`/cards/${e.id}/activities`);et(l.data||[])}catch(l){console.error("Failed to fetch activities:",l)}},kt=async()=>{if(!(!we.trim()&&!Le)){Lt(!0);try{const l=new FormData;we.trim()&&l.append("details",we.trim()),Le&&l.append("attachment",Le),await V.post(`/cards/${e.id}/activities`,l),ht(""),We(null),ln(y=>y+1),await ue()}catch(l){console.error("Failed to post comment:",l),alert("Could not post comment / attachment.")}finally{Lt(!1)}}},dt=async l=>{try{qt(l.id);const y=await V.get(`/activities/${l.id}/attachment`,{responseType:"blob"}),N=new Blob([y.data],{type:l.attachment_mime||y.headers["content-type"]||"application/octet-stream"}),j=URL.createObjectURL(N);if(!window.open(j,"_blank","noopener,noreferrer")){const J=document.createElement("a");J.href=j,J.download=l.attachment_name||"attachment",document.body.appendChild(J),J.click(),document.body.removeChild(J)}window.setTimeout(()=>URL.revokeObjectURL(j),6e4)}catch(y){console.error("Failed to open attachment:",y),alert("Could not open attachment.")}finally{qt(null)}},wn=l=>`${l.first_name||""} ${l.last_name||""}`.trim()||l.email||`User #${l.id}`,Mt=l=>{const y=(l.first_name||"").trim().charAt(0),N=(l.last_name||"").trim().charAt(0),j=(l.email||"").trim().charAt(0);return(`${y}${N}`.trim()||j||"U").toUpperCase()},dn=async()=>{var l,y;Bt(!0),pe(null);try{const N=await V.get(`/cards/${e.id}/members`),j=((l=N.data)==null?void 0:l.members)||[],ne=Array.isArray((y=N.data)==null?void 0:y.options)?N.data.options:[],J=ne.length>0?ne:j;je(j),Xe(j.map(ye=>ye.id)),Ue(J)}catch(N){console.error("Failed to fetch card members:",N),pe("Could not load members.")}finally{Bt(!1)}},Rt=async()=>{Ct(!0),await dn()},Vn=l=>{!tt||te||Xe(y=>y.includes(l)?y.filter(N=>N!==l):[...y,l])},ct=async()=>{var l,y;if(tt){Ne(!0),pe(null);try{await V.put(`/cards/${e.id}/members`,{user_ids:de}),await dn(),await ue(),await d(),Ct(!1)}catch(N){console.error("Failed to save members:",N),pe(((y=(l=N==null?void 0:N.response)==null?void 0:l.data)==null?void 0:y.message)||"Could not save members.")}finally{Ne(!1)}}},cn=a.useMemo(()=>{const l=re.trim().toLowerCase();return l?le.filter(y=>`${y.first_name||""} ${y.last_name||""} ${y.email||""}`.toLowerCase().includes(l)):le},[le,re]),gt=a.useMemo(()=>{var y;const l={total:Fe.length,comments:0,attachments:0,labelUpdates:0,paymentUpdates:0,latestAt:((y=Fe[0])==null?void 0:y.created_at)||null};for(const N of Fe)N.action==="commented"&&(l.comments+=1),(N.attachment_path||N.attachment_url)&&(l.attachments+=1),N.action.includes("label")&&(l.labelUpdates+=1),N.action.includes("payment")&&(l.paymentUpdates+=1);return l},[Fe]),un=l=>Array.isArray(l==null?void 0:l.data)?l.data:Array.isArray(l)?l:[],Dt=async()=>{T(!0);try{const l=await V.get("/country-labels");O(un(l.data))}catch(l){console.error("Failed to load country labels",l),alert("Could not load country labels.")}finally{T(!1)}},Nn=async()=>{T(!0);try{const l=await V.get("/intake-labels");R(un(l.data))}catch(l){console.error("Failed to load intake labels",l),alert("Could not load intake labels.")}finally{T(!1)}},Gt=async()=>{T(!0);try{const l=await V.get("/service-areas");U(un(l.data))}catch(l){console.error("Failed to load service areas",l),alert("Could not load service areas.")}finally{T(!1)}},bt=async l=>{_(l),f(!0),l==="country"?await Dt():l==="intake"?await Nn():await Gt()},$t=(l,y)=>{y(N=>N.includes(l)?N.filter(j=>j!==l):[...N,l])},gs=async()=>{try{const l=[...new Set(g)],y=[...new Set(k)],N={country_label_id:l[0]??null,country_label_ids:l,intake_label_id:v??null,service_area_id:y[0]??null,service_area_ids:y};await V.put(`/cards/${e.id}/labels`,N),o(j=>j&&j.id===e.id?{...j,...N}:j),await d(),await ue(),f(!1)}catch(l){console.error("Failed to save labels:",l),alert("Could not save labels. Please try again.")}},Pt=async()=>{const l=ie.trim();if(l===(e.description||"")){q(!1);return}ge(!0);try{await V.put(`/cards/${e.id}/description`,{description:l||null}),o(y=>y&&y.id===e.id?{...y,description:l||void 0}:y),await d(),await ue(),q(!1)}catch(y){console.error("Failed to save description:",y),alert("Could not save description.")}finally{ge(!1)}},Yn=()=>{var l;Y((l=e.description)!=null&&l.trim()?e.description:In),q(!0)},Jt=()=>{lt&&(ee(e.invoice||""),xe(e.first_name||""),Ie(e.last_name||""),ae(!0))},xs=async()=>{var ye,It;if(!lt)return;const l=Be.trim(),y=rt.trim(),N=jt.trim();if(!l){alert("Invoice is required.");return}const j=(e.invoice||"")===l,ne=(e.first_name||"")===y,J=(e.last_name||"")===N;if(j&&ne&&J){ae(!1);return}H(!0);try{await V.put(`/board-lists/${e.board_list_id}/cards/${e.id}`,{invoice:l,first_name:y||null,last_name:N||null}),o(ce=>ce&&ce.id===e.id?{...ce,invoice:l,first_name:y||void 0,last_name:N||void 0}:ce),await d(),await ue(),ae(!1)}catch(ce){console.error("Failed to update card identity:",ce),alert(((It=(ye=ce==null?void 0:ce.response)==null?void 0:ye.data)==null?void 0:It.message)||"Could not update card details.")}finally{H(!1)}},Qt=async()=>{ze(!0);try{const l=me.trim()||null;await V.put(`/cards/${e.id}/due-date`,{due_date:l}),o(y=>y&&y.id===e.id?{...y,due_date:l??void 0}:y),await d(),await ue(),ut(!1)}catch(l){console.error("Failed to save due date:",l),alert("Could not save due date."),await d()}finally{ze(!1)}},ps=()=>{ut(!0)},Zt=async()=>{var y,N;if(Ae)return;mt(!0);const l=!ft;try{await V.put(`/cards/${e.id}/payment`,{payment_done:l}),Oe(l),o(j=>j&&j.id===e.id?{...j,payment_done:l}:j),await d(),await ue()}catch(j){console.error("Failed to update payment status:",j),alert(((N=(y=j==null?void 0:j.response)==null?void 0:y.data)==null?void 0:N.message)||"Could not update payment status."),await d()}finally{mt(!1)}},bs=async()=>{var y,N;if(at)return;ot(!0);const l=!it;try{await V.put(`/cards/${e.id}/dependant-payment`,{dependant_payment_done:l}),Re(l),o(j=>j&&j.id===e.id?{...j,dependant_payment_done:l}:j),await d(),await ue()}catch(j){console.error("Failed to update dependant payment status:",j),alert(((N=(y=j==null?void 0:j.response)==null?void 0:y.data)==null?void 0:N.message)||"Could not update dependant payment status."),await d()}finally{ot(!1)}},en=async()=>{var y,N;if(Je)return;ke(!0);const l=!e.is_archived;try{if(await V.put(`/cards/${e.id}/archive`,{is_archived:l}),o(j=>j&&j.id===e.id?{...j,is_archived:l}:j),await d(),l){i();return}await ue()}catch(j){console.error("Failed to update archive status:",j),alert(((N=(y=j==null?void 0:j.response)==null?void 0:y.data)==null?void 0:N.message)||"Could not update archive status.")}finally{ke(!1)}},ys=()=>{if(g.length===0)return"Country";const l=g.map(y=>{var N;return(N=A.find(j=>j.id===y))==null?void 0:N.name}).filter(y=>!!y);return l.length>0?l.join(", "):"Country"},tn=()=>{var l;return((l=D.find(y=>y.id===v))==null?void 0:l.name)||"Intake"},fn=()=>{if(k.length===0)return"Extra Service";const l=k.map(y=>{var N;return(N=W.find(j=>j.id===y))==null?void 0:N.name}).filter(y=>!!y);return l.length>0?l.join(", "):"Service"},jn=/((?:https?:\/\/|www\.)[^\s]+)/gi,Cn=l=>/^(?:https?:\/\/|www\.)[^\s]+$/i.test(l),Sn=l=>/^https?:\/\//i.test(l)?l:`https://${l}`,Wt=l=>{if(!l)return null;const y=l.split(/\r?\n/);return y.map((N,j)=>t.jsxs(oe.Fragment,{children:[N.split(jn).map((ne,J)=>{if(!ne)return null;if(!Cn(ne))return t.jsx(oe.Fragment,{children:ne},`text-${j}-${J}`);const ye=ne.match(/^(.*?)([.,!?)]*)$/),It=(ye==null?void 0:ye[1])||ne,ce=(ye==null?void 0:ye[2])||"";return t.jsxs(oe.Fragment,{children:[t.jsx("a",{href:Sn(It),target:"_blank",rel:"noopener noreferrer",className:"text-indigo-600 hover:text-indigo-700 underline break-all",children:It}),ce]},`link-${j}-${J}`)}),j<y.length-1?t.jsx("br",{}):null]},`line-${j}`))},nn=l=>{const y=l.trim().toLowerCase();return y.startsWith("country:")?{label:"Country",badgeClass:"inline-flex items-center rounded-full border border-[#8f53c6] bg-[#8f53c6] px-2 py-0.5 text-xs font-semibold text-white",valueClass:"text-[#5f3a8c]"}:y.startsWith("intake:")?{label:"Intake",badgeClass:"inline-flex items-center rounded-full border border-[#f2b205] bg-[#f2b205] px-2 py-0.5 text-xs font-semibold text-[#4a2b00]",valueClass:"text-[#7a4a00]"}:y.startsWith("service area:")?{label:"Service Area",badgeClass:"inline-flex items-center rounded-full border border-[#d63a3a] bg-[#d63a3a] px-2 py-0.5 text-xs font-semibold text-white",valueClass:"text-[#8f2a2a]"}:null},kn=(l,y)=>(l||"").toLowerCase().includes("label")?!0:y?y.split(/\r?\n/).some(N=>!!nn(N)):!1,Hn=l=>{if(!l)return null;const y=l.split(/\r?\n/).map(N=>N.trim()).filter(N=>N.length>0);return y.length===0?null:t.jsx("div",{className:"space-y-1.5",children:y.map((N,j)=>{const ne=nn(N);if(!ne)return t.jsx("div",{className:"text-sm text-gray-700",children:Wt(N)},`label-change-plain-${j}`);const J=N.indexOf(":"),ye=J>=0?N.slice(J+1).trim():N;return t.jsxs("div",{className:"flex flex-wrap items-start gap-2",children:[t.jsx("span",{className:ne.badgeClass,children:ne.label}),t.jsx("span",{className:`min-w-0 text-sm ${ne.valueClass}`,children:Wt(ye||"None")})]},`label-change-row-${j}`)})})},Dn=l=>{if(!l)return null;const N=l.split(/\r?\n/).find(ce=>ce.trim().toLowerCase().startsWith("description:"));if(!N)return null;const j=N.trim().slice(12).trim(),ne='" -> "';if(!j.startsWith('"')||!j.endsWith('"')||!j.includes(ne))return null;const J=j.indexOf(ne);if(J<=0)return null;const ye=j.slice(1,J),It=j.slice(J+ne.length,j.length-1);return{before:ye.trim()||"[empty]",after:It.trim()||"[empty]"}},Ut=(l,y)=>{let N=0;const j=Math.min(l.length,y.length);for(;N<j&&l[N]===y[N];)N+=1;let ne=l.length-1,J=y.length-1;for(;ne>=N&&J>=N&&l[ne]===y[J];)ne-=1,J-=1;return{prefix:l.slice(0,N),beforeChanged:l.slice(N,ne+1),afterChanged:y.slice(N,J+1),suffix:l.slice(ne+1)}},$e=(l,y,N,j)=>t.jsxs(t.Fragment,{children:[l,y?t.jsx("mark",{className:`rounded px-0.5 ${j}`,children:y}):null,N]}),vs=l=>{const y=Dn(l);if(!y)return null;const N=Ut(y.before,y.after);return t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"rounded-md border border-rose-200 bg-rose-50 p-2.5",children:[t.jsx("p",{className:"text-[11px] font-semibold uppercase tracking-wide text-rose-700",children:"Before"}),t.jsx("p",{className:"mt-1 whitespace-pre-wrap break-words text-sm text-rose-900",children:$e(N.prefix,N.beforeChanged,N.suffix,"bg-rose-200/80 text-rose-900")})]}),t.jsxs("div",{className:"rounded-md border border-emerald-200 bg-emerald-50 p-2.5",children:[t.jsx("p",{className:"text-[11px] font-semibold uppercase tracking-wide text-emerald-700",children:"After"}),t.jsx("p",{className:"mt-1 whitespace-pre-wrap break-words text-sm text-emerald-900",children:$e(N.prefix,N.afterChanged,N.suffix,"bg-emerald-200/90 text-emerald-900")})]})]})};return t.jsxs("div",{className:"fixed inset-0 bg-black/65 backdrop-blur-sm z-50 flex items-center justify-center p-4 sm:p-6",children:[t.jsxs("div",{className:"bg-white w-full max-w-6xl rounded-2xl shadow-2xl overflow-hidden max-h-[92vh] flex flex-col border border-gray-200/50",children:[t.jsxs("div",{className:"px-6 py-4 border-b bg-gradient-to-r from-indigo-50/60 to-white flex items-start justify-between gap-6",children:[t.jsx("div",{className:"flex-1 min-w-0 space-y-1",children:t.jsx("div",{className:"inline-flex items-center gap-2 px-4 py-1.5 bg-indigo-100/80 text-indigo-800 rounded-lg text-sm font-bold border border-indigo-200 shadow-sm",children:n})}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs("div",{className:"relative",ref:At,children:[t.jsx("button",{type:"button",onClick:()=>Qe(l=>!l),className:"h-9 w-9 flex items-center justify-center rounded-lg border border-gray-200 bg-white hover:bg-gray-50",children:t.jsx(Rr,{size:17,className:"text-gray-600"})}),Pe&&t.jsxs("div",{className:"absolute right-0 mt-2 w-60 rounded-lg border border-gray-200 bg-white shadow-lg p-1.5 z-20",children:[t.jsxs("button",{type:"button",onClick:()=>{Qe(!1),Zt()},disabled:Ae,className:`w-full flex items-center gap-2 rounded-md px-3 py-2 text-sm text-left transition ${Ae?"text-gray-400 cursor-not-allowed":ft?"text-emerald-700 hover:bg-emerald-50":"text-rose-700 hover:bg-rose-50"}`,children:[t.jsx(cr,{size:15}),Ae?"Saving...":ft?"Visa Payment Done":"Mark Visa Payment Done"]}),t.jsxs("button",{type:"button",onClick:()=>{Qe(!1),bs()},disabled:at,className:`w-full flex items-center gap-2 rounded-md px-3 py-2 text-sm text-left transition ${at?"text-gray-400 cursor-not-allowed":it?"text-emerald-700 hover:bg-emerald-50":"text-amber-700 hover:bg-amber-50"}`,children:[t.jsx(cr,{size:15}),at?"Saving...":it?"Dependant Payment Done":"Mark Dependant Payment Done"]}),t.jsx("div",{className:"my-1 border-t border-gray-100"}),t.jsxs("button",{type:"button",onClick:()=>{Qe(!1),en()},disabled:Je,className:`w-full flex items-center gap-2 rounded-md px-3 py-2 text-sm text-left transition ${Je?"text-gray-400 cursor-not-allowed":"text-amber-700 hover:bg-amber-50"}`,children:[t.jsx(Mr,{size:15}),Je?"Saving...":e.is_archived?"Restore Card":"Archive Card"]})]})]}),t.jsx("button",{onClick:i,className:"h-9 w-9 flex items-center justify-center rounded-lg border border-red-200 bg-red-50 text-red-600 hover:bg-red-100",children:t.jsx(Tt,{size:18})})]})]}),t.jsxs("div",{className:"flex flex-1 overflow-hidden",children:[t.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-7 bg-white",children:[t.jsx("div",{className:"flex items-start gap-3.5 pb-1",children:Ge?t.jsxs("div",{className:"w-full rounded-xl border border-indigo-200 bg-indigo-50/40 p-3 space-y-3",children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-2",children:[t.jsx("input",{value:Be,onChange:l=>ee(l.target.value),placeholder:"Invoice",className:"h-10 rounded-md border border-indigo-200 bg-white px-3 text-sm font-semibold text-gray-900 focus:outline-none focus:ring-2 focus:ring-indigo-400"}),t.jsx("input",{value:rt,onChange:l=>xe(l.target.value),placeholder:"First name",className:"h-10 rounded-md border border-indigo-200 bg-white px-3 text-sm text-gray-900 focus:outline-none focus:ring-2 focus:ring-indigo-400"}),t.jsx("input",{value:jt,onChange:l=>Ie(l.target.value),placeholder:"Last name",className:"h-10 rounded-md border border-indigo-200 bg-white px-3 text-sm text-gray-900 focus:outline-none focus:ring-2 focus:ring-indigo-400"})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("button",{type:"button",onClick:()=>void xs(),disabled:Te,className:"px-4 py-1.5 rounded-md bg-indigo-600 text-white text-sm font-semibold hover:bg-indigo-700 disabled:cursor-not-allowed disabled:opacity-60",children:Te?"Saving...":"Save"}),t.jsx("button",{type:"button",onClick:()=>{ae(!1),ee(e.invoice||""),xe(e.first_name||""),Ie(e.last_name||"")},disabled:Te,className:"px-4 py-1.5 rounded-md border border-gray-300 bg-white text-gray-700 text-sm font-semibold hover:bg-gray-50 disabled:cursor-not-allowed disabled:opacity-60",children:"Cancel"}),t.jsxs("span",{className:"text-xs text-gray-500",children:["Created on ",Vt(e.created_at)]})]})]}):t.jsxs("h2",{className:`text-2xl font-extrabold text-gray-900 truncate leading-tight ${lt?"cursor-text hover:text-indigo-700":""}`,onClick:Jt,title:lt?"Click to edit invoice and name":void 0,children:[e.invoice||`ID-${e.id}`," ",e.first_name," ",e.last_name," "," ",Vt(e.created_at)]})}),t.jsxs("div",{className:"flex flex-wrap gap-1.5",children:[t.jsxs("button",{type:"button",onClick:()=>void bt("country"),className:"h-10 min-w-[100px] px-3 rounded-md bg-[#8f53c6] text-white text-sm font-bold border border-[#8f53c6] hover:brightness-95 transition flex items-center justify-center gap-1.5",children:[t.jsx(fa,{size:15,strokeWidth:2.2,className:"text-white/90"}),ys()]}),t.jsxs("button",{type:"button",onClick:()=>void bt("intake"),className:"h-10 min-w-[100px] px-3 rounded-md bg-[#f2b205] text-[#4a2b00] text-sm font-bold border border-[#f2b205] hover:brightness-95 transition flex items-center justify-center gap-1.5",children:[t.jsx(Ir,{size:15,strokeWidth:2.2,className:"text-[#4a2b00]/90"}),tn()]}),t.jsxs("button",{type:"button",onClick:()=>void bt("serviceArea"),className:"h-10 px-3 rounded-md bg-[#d63a3a] text-white text-sm font-bold border border-[#d63a3a] hover:brightness-95 transition flex items-center gap-1.5",children:[t.jsx(ss,{size:14,className:"text-white/90"}),fn()]}),t.jsxs("button",{type:"button",onClick:ps,className:"h-10 px-3 rounded-md bg-[#4f46e5] text-white text-sm font-bold border border-[#4f46e5] hover:brightness-95 transition flex items-center gap-1.5",children:[t.jsx(ra,{size:15,strokeWidth:2.2,className:"text-white/90"}),e.due_date?Vt(e.due_date):"Due Dates"]})]}),t.jsx("div",{className:"space-y-6",children:t.jsxs("div",{children:[t.jsx("p",{className:"text-sm font-bold text-gray-700 mb-2.5",children:"Members"}),t.jsxs("div",{className:"flex items-center gap-2",children:[he.slice(0,3).map(l=>t.jsx("button",{type:"button",onClick:Rt,title:wn(l),className:"h-10 w-10 rounded-full bg-sky-600 text-white text-sm font-bold flex items-center justify-center hover:brightness-110 transition",children:Mt(l)},l.id)),t.jsx("button",{type:"button",onClick:Rt,className:"h-10 w-10 rounded-full bg-gray-200 text-gray-700 text-xl flex items-center justify-center hover:bg-gray-300 transition",title:"Manage members",children:t.jsx(ss,{size:18})})]})]})}),t.jsxs("div",{className:"bg-gray-50/70 border border-gray-200 rounded-xl overflow-hidden",children:[t.jsxs("div",{className:"flex items-center justify-between px-5 py-3.5 border-b bg-white/60",children:[t.jsxs("div",{className:"flex items-center gap-2.5",children:[t.jsx($r,{size:18,className:"text-indigo-600"}),t.jsx("h3",{className:"font-bold text-gray-800",children:"Description"})]}),z?t.jsxs("div",{className:"flex gap-3",children:[t.jsx("button",{onClick:()=>{var l;q(!1),Y((l=e.description)!=null&&l.trim()?e.description:In)},className:"px-4 py-1.5 text-sm text-gray-600 hover:text-gray-800 hover:bg-gray-100 rounded",disabled:ve,children:"Cancel"}),t.jsx("button",{onClick:Pt,className:`px-5 py-1.5 text-sm font-bold rounded text-white ${ve?"bg-indigo-400 cursor-not-allowed":"bg-indigo-600 hover:bg-indigo-700"}`,disabled:ve,children:ve?"Saving...":"Save"})]}):t.jsxs("button",{onClick:Yn,className:"flex items-center gap-1.5 text-sm text-indigo-600 hover:text-indigo-800 font-bold transition",children:[t.jsx(Er,{size:14}),"Edit"]})]}),z?t.jsx("div",{className:"p-5",children:t.jsx("textarea",{ref:Me,value:ie,onChange:l=>Y(l.target.value),className:"w-full border border-gray-300 rounded-lg px-4 py-3 text-sm resize-none overflow-hidden min-h-[180px] focus:outline-none focus:ring-2 focus:ring-indigo-400 transition",placeholder:"Fill student profile details...",autoFocus:!0})}):t.jsx("div",{onClick:Yn,className:"px-5 py-5 text-sm text-gray-800 space-y-2 leading-relaxed cursor-pointer hover:bg-white/40 transition",title:"Click to edit description",children:e.description&&e.description.trim()?e.description.split(`
`).map((l,y)=>t.jsx("p",{children:l},y)):In.split(`
`).map((l,y)=>t.jsx("p",{className:"text-gray-500",children:l||""},y))})]})]}),t.jsxs("div",{className:"w-full sm:w-[360px] bg-gray-50 border-l border-gray-200 flex flex-col overflow-hidden",children:[t.jsxs("div",{className:"px-5 py-4 border-b bg-white/80 flex items-center justify-between",children:[t.jsx("h3",{className:"font-bold text-gray-800",children:"Comments & Activity"}),t.jsxs("button",{type:"button",onClick:()=>Ze(!0),className:"inline-flex items-center gap-1.5 text-sm px-3 py-1.5 bg-white border border-gray-200 rounded-lg hover:bg-gray-50 transition",children:[t.jsx(aa,{size:14}),"Summary"]})]}),t.jsxs("div",{className:"flex-1 p-5 space-y-6 overflow-y-auto overflow-x-hidden",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsx("textarea",{value:we,onChange:l=>ht(l.target.value),placeholder:"Write a comment...",className:"w-full border border-gray-300 rounded-lg px-4 py-3 text-sm resize-none h-28 focus:outline-none focus:ring-2 focus:ring-indigo-400 focus:border-indigo-400 transition"}),t.jsxs("div",{className:"flex items-center justify-between gap-3",children:[t.jsxs("label",{className:"inline-flex items-center gap-2 px-3 py-2 text-sm border border-gray-300 rounded-lg bg-white hover:bg-gray-50 cursor-pointer",children:[t.jsx(ur,{size:14,className:"text-gray-600"}),t.jsx("span",{children:"Attach file"}),t.jsx("input",{type:"file",className:"hidden",onChange:l=>{var N;const y=((N=l.target.files)==null?void 0:N[0])||null;We(y)}},Yt)]}),Le&&t.jsx("button",{type:"button",onClick:()=>{We(null),ln(l=>l+1)},className:"text-xs text-red-600 hover:underline",children:"Remove file"})]}),Le&&t.jsxs("div",{className:"text-xs text-gray-600 bg-white border border-gray-200 rounded-lg px-3 py-2",children:[t.jsx("span",{className:"font-bold",children:Le.name}),t.jsx("span",{className:"ml-2 text-gray-500",children:Xs(Le.size)})]}),t.jsx("button",{onClick:kt,disabled:Ht||!we.trim()&&!Le,className:`w-full py-2 text-sm font-bold rounded-lg text-white ${Ht?"bg-indigo-400 cursor-not-allowed":"bg-indigo-600 hover:bg-indigo-700"}`,children:Ht?"Posting...":"Post Update"})]}),t.jsx("div",{className:"space-y-6",children:Fe.length===0?t.jsx("p",{className:"text-center text-gray-500",children:"No activities yet"}):Fe.map(l=>{const y=kn(l.action,l.details),N=!!Dn(l.details);return t.jsxs("div",{className:"flex gap-3",children:[t.jsx("div",{className:"w-9 h-9 bg-teal-600 text-white rounded-full flex items-center justify-center font-bold text-sm shrink-0",children:(l.user_name||"U").charAt(0).toUpperCase()}),t.jsxs("div",{className:"flex-1 space-y-1.5",children:[t.jsxs("p",{className:"text-sm leading-relaxed",children:[t.jsx("strong",{className:"text-gray-900",children:l.user_name||"User"})," ",l.action]}),l.details&&l.action!=="commented"?t.jsx("div",{className:`mt-1 text-sm leading-relaxed ${y?"rounded-lg border border-indigo-100 bg-indigo-50/40 p-3 text-gray-700":N?"rounded-lg border border-emerald-100 bg-emerald-50/30 p-3 text-gray-700":"text-gray-700"}`,children:y?Hn(l.details):N?vs(l.details):Wt(l.details)}):null,t.jsx("p",{className:"text-xs text-gray-500",children:Us(l.created_at)}),l.action==="commented"&&l.details&&t.jsx("div",{className:"mt-2 bg-white border border-gray-200 rounded-lg p-3 text-sm text-gray-700 whitespace-pre-wrap break-words",children:Wt(l.details)}),(l.attachment_path||l.attachment_url)&&t.jsxs("button",{type:"button",onClick:()=>void dt(l),disabled:Et===l.id,className:"mt-2 inline-flex items-center gap-2 bg-white border border-gray-200 rounded-lg px-3 py-2 text-sm text-indigo-700 hover:bg-indigo-50 disabled:opacity-60",children:[t.jsx(ur,{size:14}),t.jsx("span",{children:Et===l.id?"Opening...":l.attachment_name||"Attachment"}),l.attachment_size?t.jsxs("span",{className:"text-xs text-gray-500",children:["(",Xs(l.attachment_size),")"]}):null]}),t.jsx("button",{className:"text-xs text-gray-500 hover:text-gray-700 underline mt-1 transition",children:"Reply"})]})]},l.id)})})]})]})]})]}),Ft&&t.jsx("div",{className:"fixed inset-0 bg-black/45 z-[65] flex items-center justify-center p-4",children:t.jsxs("div",{className:"w-full max-w-md rounded-2xl border border-gray-200 bg-white shadow-2xl overflow-hidden",children:[t.jsxs("div",{className:"px-5 py-4 border-b bg-gray-50 flex items-center justify-between",children:[t.jsx("h4",{className:"text-base font-bold text-gray-900",children:"Activity Summary"}),t.jsx("button",{type:"button",onClick:()=>Ze(!1),className:"h-8 w-8 rounded-md border border-gray-200 bg-white text-gray-600 hover:bg-gray-100 flex items-center justify-center",children:t.jsx(Tt,{size:16})})]}),t.jsxs("div",{className:"p-5 space-y-3 text-sm text-gray-700",children:[t.jsxs("p",{children:[t.jsx("span",{className:"font-bold text-gray-900",children:"Total activities:"})," ",gt.total]}),t.jsxs("p",{children:[t.jsx("span",{className:"font-bold text-gray-900",children:"Comments:"})," ",gt.comments]}),t.jsxs("p",{children:[t.jsx("span",{className:"font-bold text-gray-900",children:"Attachments:"})," ",gt.attachments]}),t.jsxs("p",{children:[t.jsx("span",{className:"font-bold text-gray-900",children:"Label updates:"})," ",gt.labelUpdates]}),t.jsxs("p",{children:[t.jsx("span",{className:"font-bold text-gray-900",children:"Payment updates:"})," ",gt.paymentUpdates]}),t.jsxs("p",{children:[t.jsx("span",{className:"font-bold text-gray-900",children:"Last activity:"})," ",gt.latestAt?Us(gt.latestAt):"No activity yet"]})]}),t.jsx("div",{className:"px-5 py-4 border-t bg-gray-50 flex justify-end",children:t.jsx("button",{type:"button",onClick:()=>Ze(!1),className:"px-4 py-2 rounded-lg bg-indigo-600 text-white text-sm font-bold hover:bg-indigo-700",children:"Close"})})]})}),He&&t.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-[60] p-4",children:t.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-md p-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsx("h3",{className:"text-lg font-bold text-gray-900",children:"Select Due Date"}),t.jsx("button",{onClick:()=>ut(!1),className:"text-gray-500 hover:text-gray-700",children:t.jsx(Tt,{size:20})})]}),t.jsx(a.Suspense,{fallback:t.jsx("div",{className:"py-8 text-center text-gray-500",children:"Loading calendar..."}),children:t.jsx("div",{className:"flex justify-center mb-4",children:t.jsx(gl,{inline:!0,selected:me?new Date(me):null,onChange:l=>{qe(l?l.toISOString().split("T")[0]:"")},dateFormat:"yyyy-MM-dd"})})}),me?t.jsx("div",{className:"mb-4 text-sm text-gray-600",children:`Selected: ${Vt(me)}`}):null,t.jsxs("div",{className:"flex justify-end gap-3",children:[t.jsx("button",{onClick:()=>qe(""),className:"px-5 py-2 text-sm text-gray-700 hover:bg-gray-100 rounded-lg",disabled:_e,children:"Clear"}),t.jsx("button",{onClick:()=>{ut(!1),qe(Is(e.due_date))},className:"px-5 py-2 text-sm text-gray-700 hover:bg-gray-100 rounded-lg",disabled:_e,children:"Cancel"}),t.jsx("button",{onClick:Qt,className:`px-6 py-2 text-sm font-bold text-white rounded-lg ${_e?"bg-indigo-400 cursor-not-allowed":"bg-indigo-600 hover:bg-indigo-700"}`,disabled:_e,children:_e?"Saving...":"Save Date"})]})]})}),zt&&t.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-[60] p-4",children:t.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-xl max-h-[85vh] overflow-hidden flex flex-col",children:[t.jsxs("div",{className:"p-6 border-b flex items-center justify-between",children:[t.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"Card Members"}),t.jsx("button",{onClick:()=>Ct(!1),className:"text-gray-500 hover:text-gray-700",children:t.jsx(Tt,{size:24})})]}),t.jsxs("div",{className:"p-6 space-y-4 flex-1 overflow-y-auto",children:[t.jsx("p",{className:"text-sm text-gray-600",children:"If no members are selected, everyone with board access can see this card."}),tt&&t.jsx("input",{value:re,onChange:l=>Ke(l.target.value),placeholder:"Search user by name or email...",className:"w-full h-10 rounded-lg border border-gray-300 px-3 text-sm focus:outline-none focus:ring-2 focus:ring-indigo-400"}),Ce&&t.jsx("div",{className:"text-sm text-red-600 bg-red-50 border border-red-200 rounded-lg px-3 py-2",children:Ce}),St?t.jsx("div",{className:"text-center py-10 text-gray-500",children:"Loading members..."}):t.jsx("div",{className:"border border-gray-200 rounded-xl overflow-hidden",children:cn.length===0?t.jsx("div",{className:"py-8 text-center text-sm text-gray-500",children:"No users found for roles 2, 3, and 4."}):t.jsx("div",{className:"max-h-[330px] overflow-y-auto divide-y",children:cn.map(l=>{const y=de.includes(l.id);return t.jsxs("label",{className:`flex items-center gap-3 px-4 py-3 ${tt?"cursor-pointer hover:bg-gray-50":""}`,children:[t.jsx("input",{type:"checkbox",checked:y,disabled:!tt||te,onChange:()=>Vn(l.id),className:"h-4 w-4 rounded text-indigo-600"}),t.jsxs("div",{className:"min-w-0",children:[t.jsx("p",{className:"text-sm font-bold text-gray-900 truncate",children:wn(l)}),l.email?t.jsx("p",{className:"text-xs text-gray-500 truncate",children:l.email}):null]})]},l.id)})})})]}),t.jsxs("div",{className:"p-5 border-t flex justify-end gap-3",children:[t.jsx("button",{onClick:()=>Ct(!1),className:"px-5 py-2.5 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50",children:"Close"}),tt&&t.jsx("button",{onClick:ct,disabled:te||St,className:`px-6 py-2.5 rounded-lg text-white font-bold ${te||St?"bg-indigo-400 cursor-not-allowed":"bg-indigo-600 hover:bg-indigo-700"}`,children:te?"Saving...":"Save Members"})]})]})}),u&&t.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-[60] p-4",children:t.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-lg max-h-[85vh] overflow-hidden flex flex-col",children:[t.jsxs("div",{className:"p-6 border-b flex items-center justify-between",children:[t.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"Select Labels"}),t.jsx("button",{onClick:()=>f(!1),className:"text-gray-500 hover:text-gray-700",children:t.jsx(Tt,{size:24})})]}),t.jsx("div",{className:"p-6 flex-1 overflow-y-auto space-y-8",children:K?t.jsx("div",{className:"text-center py-10 text-gray-500",children:"Loading labels..."}):t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("button",{type:"button",onClick:()=>void bt("country"),className:`px-3 py-1.5 rounded-md text-sm font-bold border transition ${F==="country"?"bg-[#8f53c6] text-white border-[#8f53c6]":"bg-white text-gray-700 border-gray-300 hover:bg-gray-50"}`,children:"Country"}),t.jsx("button",{type:"button",onClick:()=>void bt("intake"),className:`px-3 py-1.5 rounded-md text-sm font-bold border transition ${F==="intake"?"bg-[#f2b205] text-[#4a2b00] border-[#f2b205]":"bg-white text-gray-700 border-gray-300 hover:bg-gray-50"}`,children:"Intake"}),t.jsx("button",{type:"button",onClick:()=>void bt("serviceArea"),className:`px-3 py-1.5 rounded-md text-sm font-bold border transition ${F==="serviceArea"?"bg-[#d63a3a] text-white border-[#d63a3a]":"bg-white text-gray-700 border-gray-300 hover:bg-gray-50"}`,children:"Service Area"})]}),F==="country"?t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-bold text-gray-700 mb-2",children:"Country (multi-select)"}),t.jsx("div",{className:"max-h-64 overflow-y-auto border border-gray-200 rounded-lg divide-y",children:A.length===0?t.jsx("div",{className:"px-4 py-6 text-sm text-gray-500 text-center",children:"No countries found"}):A.map(l=>{const y=g.includes(l.id);return t.jsxs("label",{className:"flex items-center gap-3 px-4 py-2.5 hover:bg-gray-50 cursor-pointer",children:[t.jsx("input",{type:"checkbox",checked:y,onChange:()=>$t(l.id,p),className:"h-4 w-4 rounded text-indigo-600"}),t.jsx("span",{className:"text-sm text-gray-800",children:l.name})]},l.id)})})]}):F==="intake"?t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-bold text-gray-700 mb-2",children:"Intake / Semester"}),t.jsxs("select",{value:v??"",onChange:l=>w(l.target.value?Number(l.target.value):null),className:"w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",children:[t.jsx("option",{value:"",children:"Select an intake"}),D.map(l=>t.jsx("option",{value:l.id,children:l.name},l.id))]})]}):t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-bold text-gray-700 mb-2",children:"Service Area (multi-select)"}),t.jsx("div",{className:"max-h-64 overflow-y-auto border border-gray-200 rounded-lg divide-y",children:W.length===0?t.jsx("div",{className:"px-4 py-6 text-sm text-gray-500 text-center",children:"No service areas found"}):W.map(l=>{const y=k.includes(l.id);return t.jsxs("label",{className:"flex items-center gap-3 px-4 py-2.5 hover:bg-gray-50 cursor-pointer",children:[t.jsx("input",{type:"checkbox",checked:y,onChange:()=>$t(l.id,S),className:"h-4 w-4 rounded text-indigo-600"}),t.jsx("span",{className:"text-sm text-gray-800",children:l.name})]},l.id)})})]})]})}),t.jsxs("div",{className:"p-5 border-t flex justify-end gap-4",children:[t.jsx("button",{onClick:()=>f(!1),className:"px-6 py-2.5 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50",children:"Cancel"}),t.jsx("button",{onClick:gs,className:"px-6 py-2.5 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 font-bold",children:"Save"})]})]})})]})}function pl({card:e,onClick:n,labelBadges:s=[],dragDisabled:i=!1,showActions:o=!1,disableActions:d=!1,onOpenActions:u}){const{setNodeRef:f,attributes:g,listeners:p,transform:v,transition:w}=ai({id:e.id,disabled:i}),k={transform:Ot.Transform.toString(v),transition:w},F=`${e.invoice||`ID-${e.id}`} ${e.first_name||""} ${e.last_name||""}`.trim(),_=s.filter(D=>D.kind==="country"||D.kind==="intake"),A=D=>{D.stopPropagation()},O=D=>{!o||d||!u||(D.preventDefault(),D.stopPropagation(),u(e,{x:D.clientX,y:D.clientY}))};return t.jsxs("div",{ref:f,style:k,...g,...p,onClick:()=>n(e),onContextMenu:O,className:`relative bg-white rounded-xl border border-gray-200 px-4 py-4 shadow-sm transition-shadow select-none ${i?"cursor-default":"cursor-pointer hover:shadow-md"}`,children:[t.jsx("div",{className:"absolute right-3 top-3 z-10 flex items-center gap-1",children:t.jsx("button",{type:"button",onMouseDown:A,onPointerDown:A,onClick:D=>{D.stopPropagation(),n(e)},className:"p-1.5 rounded-md shrink-0 text-gray-600 hover:bg-gray-100",title:"Edit card","aria-label":"Edit card",children:t.jsx(Er,{size:16})})}),t.jsxs("div",{className:"min-w-0",children:[t.jsxs("div",{className:"pr-10",children:[t.jsx("p",{className:"text-sm font-bold text-indigo-700",children:F}),t.jsx("p",{className:"text-xs text-gray-500 mt-1",children:Vt(e.created_at)})]}),(_.length>0||e.members&&e.members.length>0)&&t.jsxs("div",{className:"mt-4 flex w-full items-start gap-2",children:[_.length>0?t.jsxs("div",{className:"flex min-w-0 flex-1 items-center gap-1.5 overflow-x-auto whitespace-nowrap no-scrollbar pr-1",children:[t.jsx(Ir,{size:12,className:"shrink-0 text-gray-500"}),_.map((D,R)=>t.jsx("span",{className:`shrink-0 px-2 py-0.5 rounded-md text-[10px] font-semibold ${D.kind==="country"?"bg-[#8f53c6] text-white":"bg-[#f2b205] text-[#4a2b00]"}`,children:D.name},`${D.kind}-${D.name}-${R}`))]}):t.jsx("div",{className:"flex-1"}),e.members&&e.members.length>0?t.jsxs("div",{className:"ml-auto -mr-1 flex shrink-0 flex-row-reverse items-center justify-end -space-x-1 space-x-reverse",children:[e.members.slice(0,3).map((D,R)=>t.jsx("div",{className:`h-5 w-5 rounded-full border border-white text-white text-[9px] font-semibold flex items-center justify-center ${Sr[(D.id+R)%Sr.length]}`,title:`${D.first_name||""} ${D.last_name||""}`.trim()||"Member",children:hl(D)},`card-${e.id}-member-${D.id}`)),e.members.length>3&&t.jsxs("div",{className:"mr-1 text-[10px] font-semibold text-gray-500",children:["+",e.members.length-3]})]}):null]})]})]})}function bl({list:e,children:n,dragDisabled:s=!1}){const{setNodeRef:i,transform:o,transition:d,attributes:u,listeners:f,isDragging:g}=ai({id:`list-${e.id}`,disabled:{draggable:s,droppable:!1},transition:{duration:180,easing:"cubic-bezier(0.2, 0, 0, 1)"}}),p={transform:Ot.Transform.toString(o),transition:d},v=s?{}:{...u,...f};return t.jsx("div",{ref:i,style:p,className:`w-[22rem] bg-white rounded-xl border border-gray-200 shadow-md flex flex-col min-h-[120px] will-change-transform ${g?"opacity-35":""}`,children:typeof n=="function"?n({dragHandleProps:v,isDragging:g}):n})}const yl={1:"superadmin",2:"admin",3:"subadmin",4:"counsellor"},Ts=["#6A359C","#A52A2A","#2066B0","#0F766E","#DC2626","#B91C1C","#EA580C","#C2410C","#D97706","#A16207","#CA8A04","#65A30D","#4D7C0F","#16A34A","#15803D","#059669","#047857","#0D9488","#0891B2","#0E7490","#0284C7","#0369A1","#2563EB","#1D4ED8","#4F46E5","#4338CA","#7C3AED","#6D28D9","#9333EA","#7E22CE","#A21CAF","#86198F","#C026D3","#DB2777","#BE185D","#E11D48","#BE123C","#F43F5E","#FB7185","#F97316","#FB923C","#F59E0B","#EAB308","#84CC16","#22C55E","#10B981","#14B8A6","#06B6D4","#3B82F6","#6366F1"],Dr="#6A359C",_r="board-bg-theme-v3",Os=e=>Math.max(0,Math.min(255,Math.round(e))),oi=e=>{const n=e.replace("#","");return/^[0-9a-fA-F]{6}$/.test(n)?{r:parseInt(n.slice(0,2),16),g:parseInt(n.slice(2,4),16),b:parseInt(n.slice(4,6),16)}:null},Fs=(e,n)=>{const s=oi(e);if(!s)return e;const i=Os(s.r+n).toString(16).padStart(2,"0"),o=Os(s.g+n).toString(16).padStart(2,"0"),d=Os(s.b+n).toString(16).padStart(2,"0");return`#${i}${o}${d}`.toUpperCase()},Ar=(e,n)=>{const s=oi(e);return s?`rgba(${s.r}, ${s.g}, ${s.b}, ${n})`:`rgba(0, 0, 0, ${n})`},vl=e=>{if(e.toUpperCase()==="#6A359C")return{canvasBackground:"linear-gradient(135deg, #eef2ff 0%, #faf5ff 50%, #fdf2f8 100%)",headerBackground:"linear-gradient(90deg, #7e22ce 0%, #4338ca 50%, #6b21a8 100%)"};const n=Fs(e,38),s=Fs(e,-46),i=Fs(e,-76);return{canvasBackground:`radial-gradient(circle at 14% 18%, ${Ar(n,.34)}, transparent 44%), radial-gradient(circle at 86% 84%, ${Ar(i,.2)}, transparent 52%), linear-gradient(140deg, ${n} 0%, ${e} 48%, ${s} 100%)`,headerBackground:`linear-gradient(90deg, ${s} 0%, ${e} 55%, ${i} 100%)`}},Lr=e=>e!=null?yl[e]||`role ${e}`:"unknown";function El(){const{boardId:e}=qi(),n=Gi(),[s,i]=a.useState(null),[o,d]=a.useState(!0),[u,f]=a.useState(null),[g,p]=a.useState(null),[v,w]=a.useState(null),[k,S]=a.useState(null),[F,_]=a.useState(!1),[A,O]=a.useState(""),[D,R]=a.useState(3),[W,U]=a.useState(null),[K,T]=a.useState(""),[z,q]=a.useState(""),[ie,Y]=a.useState(""),[ve,ge]=a.useState(null),[Me,He]=a.useState(""),[ut,me]=a.useState(null),[qe,_e]=a.useState(null),[ze,Ge]=a.useState(null),[ae,Be]=a.useState(null),[ee,rt]=a.useState(null),[xe,jt]=a.useState([]),[Ie,Te]=a.useState("Commission Board"),[H,ft]=a.useState(!1),[Oe,it]=a.useState(null),[Re,Ae]=a.useState(""),[mt,at]=a.useState(null),[ot,Je]=a.useState(!1),[ke,Pe]=a.useState(!1),[Qe,Ft]=a.useState(!1),[Ze,At]=a.useState(!1),[Fe,et]=a.useState(!1),[we,ht]=a.useState(Dr),[Le,We]=a.useState("all"),[Yt,ln]=a.useState([]),[Ht,Lt]=a.useState(!1),[Et,qt]=a.useState(null),[zt,Ct]=a.useState([]),[St,Bt]=a.useState(""),[te,Ne]=a.useState([]),[le,Ue]=a.useState([]),[he,je]=a.useState([]),[de,Xe]=a.useState(""),[re,Ke]=a.useState("all"),[Ce,pe]=a.useState(null),[tt,lt]=a.useState(!1),[ue,kt]=a.useState(null),[dt,wn]=a.useState([]),[Mt,dn]=a.useState([]),[Rt,Vn]=a.useState([]),[ct,cn]=a.useState(""),[gt,un]=a.useState([]),[Dt,Nn]=a.useState("all"),[Gt,bt]=a.useState(null),[$t,gs]=a.useState([]),[Pt,Yn]=a.useState([]),[Jt,xs]=a.useState([]),[Qt,ps]=a.useState({}),[Zt,bs]=a.useState({}),[en,ys]=a.useState({}),tn=a.useRef(null),fn=a.useRef(null),jn=a.useRef(null),Cn=a.useRef(null),Sn=a.useRef(null),Wt=a.useRef(null),nn=a.useRef(null),kn=a.useRef(null),[Hn,Dn]=a.useState(!1),Ut=a.useDeferredValue(Re.trim().toLowerCase()),$e=Ut.length>0,vs=Ut==="*",be=dt.length>0||Mt.length>0||Rt.length>0||ct!==""||Dt!=="all",l=vs||be,y=te.length>0||le.length>0||he.length>0||de!==""||re!=="all",N=St.trim().length>0||y,j=a.useMemo(()=>{const r=((s==null?void 0:s.name)||"").trim().toLowerCase();return r.includes("commission")||r.includes("comission")},[s==null?void 0:s.name]),ne=a.useMemo(()=>vl(we),[we]),J=(r,c)=>{c(h=>h.includes(r)?h.filter(x=>x!==r):[...h,r])},ye=(r,c,h)=>{if(r.length===0)return h;const x=c.filter(m=>r.includes(m.id)).map(m=>m.name);return x.length===0?`${r.length} selected`:x.length<=2?x.join(", "):`${x.slice(0,2).join(", ")} +${x.length-2}`},It=Ra(Ma(Qs,{activationConstraint:{distance:2}})),ce=async()=>{var r;try{const c=await V.get(`/boards/${e}`,{params:{with:"lists.cards"}}),h=c.data.data||c.data;h.lists=[...h.lists||[]].sort((x,m)=>x.position-m.position),h.lists.forEach(x=>{x.cards=[...x.cards||[]].sort((m,b)=>m.position-b.position)}),i(h)}catch(c){console.error("Fetch board failed",c),((r=c==null?void 0:c.response)==null?void 0:r.status)===403&&(alert("You are not allowed to access this board."),n("/choose-dashboard"))}},li=async()=>{if(e){lt(!0);try{const r=await V.get(`/boards/${e}/archived-cards`);Ct(Array.isArray(r.data)?r.data:[])}catch(r){console.error("Fetch archived cards failed",r),alert("Could not load archived cards.")}finally{lt(!1)}}},di=async()=>{Bt(""),Ne([]),Ue([]),je([]),Xe(""),Ke("all"),pe(null),Ft(!0),await li()},qn=a.useMemo(()=>{const r=St.trim().toLowerCase(),c=r==="*",h=r.length>0&&!c,x=h?r.split(/\s+/).filter(Boolean):[],m=de!==""?gt.find(M=>Number(M==null?void 0:M.id)===Number(de)):null,b=de!==""?new Set(((m==null?void 0:m.board_lists)||(m==null?void 0:m.boardLists)||[]).map(M=>Number(M==null?void 0:M.id)).filter(M=>Number.isFinite(M))):null,L=new Date,$=new Date(L.getFullYear(),L.getMonth(),L.getDate()),B=($.getDay()+6)%7,fe=new Date($);fe.setDate($.getDate()-B);const Ve=new Date(fe);Ve.setDate(fe.getDate()+6);const hn=M=>{if(re==="all")return!0;const nt=kr(M.due_date);return nt?re==="today"?nt.toDateString()===$.toDateString():re==="this_week"?nt>=fe&&nt<=Ve:re==="overdue"?nt<$:!0:!1};return zt.filter(M=>{var I,st;const nt=M.boardList||M.board_list,En=Array.isArray(M.country_label_ids)&&M.country_label_ids.length>0?M.country_label_ids:M.country_label_id!=null?[M.country_label_id]:[],Mn=Array.isArray(M.service_area_ids)&&M.service_area_ids.length>0?M.service_area_ids:M.service_area_id!=null?[M.service_area_id]:[],yt=(M.members||[]).map(X=>Number(X.id)).filter(X=>Number.isFinite(X)),gn=Number(M.board_list_id??((I=M.boardList)==null?void 0:I.id)??((st=M.board_list)==null?void 0:st.id)??0);if(te.length>0&&!En.some(X=>te.includes(X))||le.length>0&&(M.intake_label_id==null||!le.includes(M.intake_label_id))||he.length>0&&!Mn.some(X=>he.includes(X)))return!1;if(de!==""){const X=yt.includes(de),_t=Number.isFinite(gn)&&((b==null?void 0:b.has(gn))??!1);if(!X&&!_t)return!1}if(!hn(M))return!1;if(!h)return!0;const Xt=En.map(X=>Qt[X]||"").filter(Boolean).join(" "),sn=M.intake_label_id!=null&&Zt[M.intake_label_id]||"",rn=Mn.map(X=>en[X]||"").filter(Boolean).join(" "),an=M.payment_done?"visa payment paid done":"visa payment unpaid pending",P=M.dependant_payment_done?"dependant payment dependant-paid dependant-done":"dependant payment dependant-unpaid dependant-pending",Q=(nt==null?void 0:nt.title)||"Unknown List",Se=(M.members||[]).map(X=>`${X.first_name||""} ${X.last_name||""}`.trim()).filter(Boolean).join(" "),C=[M.invoice,M.first_name,M.last_name,M.title,M.description,Q,Xt,sn,rn,an,P,Se].filter(X=>!!X).join(" ").toLowerCase();return x.every(X=>X==="paid"||X==="done"?M.payment_done===!0:X==="unpaid"||X==="pending"?M.payment_done!==!0:X==="dependant-paid"||X==="dependent-paid"||X==="dependant-done"?M.dependant_payment_done===!0:X==="dependant-unpaid"||X==="dependent-unpaid"||X==="dependant-pending"?M.dependant_payment_done!==!0:C.includes(X))})},[zt,St,te,le,he,de,re,gt,Qt,Zt,en]),ci=async(r=Le)=>{var c;if(e){Lt(!0);try{const h=await V.get(`/boards/${e}/activities`,{params:{tab:r,limit:300}}),x=Array.isArray((c=h.data)==null?void 0:c.data)?h.data.data:Array.isArray(h.data)?h.data:[];ln(x)}catch(h){console.error("Fetch board activities failed",h),alert("Could not load board activities.")}finally{Lt(!1)}}},ui=()=>{At(!0)},fi=async r=>{kt(r);try{await V.put(`/cards/${r}/archive`,{is_archived:!1}),Ct(c=>c.filter(h=>h.id!==r)),await ce()}catch(c){console.error("Restore archived card failed",c),alert("Could not restore card.")}finally{kt(null)}};a.useEffect(()=>{(async()=>{d(!0);try{const[,c]=await Promise.all([ce(),Ji()]);f(c)}finally{d(!1)}})()},[e]),a.useEffect(()=>{(async()=>{try{const[c,h,x]=await Promise.all([V.get("/country-labels"),V.get("/intake-labels"),V.get("/service-areas")]),m=E=>Array.isArray(E==null?void 0:E.data)?E.data:Array.isArray(E)?E:[],b=m(c.data),L=m(h.data),$=m(x.data);gs(b),Yn(L),xs($),ps(b.reduce((E,B)=>(E[B.id]=B.name,E),{})),bs(L.reduce((E,B)=>(E[B.id]=B.name,E),{})),ys($.reduce((E,B)=>(E[B.id]=B.name,E),{}))}catch(c){console.error("Failed to load label maps",c)}})()},[]),a.useEffect(()=>{(async()=>{var c;try{const h=await V.get("/users"),m=(Array.isArray((c=h.data)==null?void 0:c.data)?h.data.data:Array.isArray(h.data)?h.data:[]).filter(b=>typeof b=="object"&&b!==null);un(m)}catch(h){console.error("Failed to load users for member filter",h),un([])}})()},[e]),a.useEffect(()=>{R(j?4:3)},[j]),a.useEffect(()=>{const r=()=>{window.setTimeout(()=>{var x,m;(x=fn.current)==null||x.focus(),(m=fn.current)==null||m.select()},0)},c=x=>{if(!(x instanceof HTMLElement))return!1;const m=x.tagName.toLowerCase();return m==="input"||m==="textarea"||m==="select"||x.isContentEditable},h=x=>{var L,$;const m=x.key.toLowerCase(),b=c(x.target);if((x.ctrlKey||x.metaKey)&&m==="k"){x.preventDefault(),(L=tn.current)==null||L.focus(),($=tn.current)==null||$.select();return}if(x.key==="Escape"&&document.activeElement===tn.current){Ae("");return}if(x.key==="Escape"&&Ze){At(!1);return}if(x.key==="Escape"&&ot){Je(!1);return}if(x.key==="Escape"&&ke){Pe(!1);return}if(x.key==="Escape"&&Fe){et(!1);return}if(x.key==="Escape"&&ze!==null){Ge(null);return}if(x.key==="Escape"&&ee){rt(null);return}if(!(x.ctrlKey||x.metaKey||x.altKey)){if(!b&&m==="f"){x.preventDefault(),Je(!0),r();return}if(x.key==="*"||x.code==="NumpadMultiply"){if(b&&document.activeElement!==fn.current)return;x.preventDefault(),Je(!0),Ae("*"),r()}}};return window.addEventListener("keydown",h),()=>window.removeEventListener("keydown",h)},[Ze,ot,ke,Fe,ze,ee]),a.useEffect(()=>{if(!ke)return;const r=c=>{jn.current&&(jn.current.contains(c.target)||Pe(!1))};return document.addEventListener("mousedown",r),()=>document.removeEventListener("mousedown",r)},[ke]),a.useEffect(()=>{if(!ot)return;const r=c=>{Cn.current&&(Cn.current.contains(c.target)||Je(!1))};return document.addEventListener("mousedown",r),()=>document.removeEventListener("mousedown",r)},[ot]),a.useEffect(()=>{ot||bt(null)},[ot]),a.useEffect(()=>{if(!e)return;const r=`${_r}-${e}`,c=localStorage.getItem(r);if(c&&Ts.includes(c)){ht(c);return}ht(Dr)},[e]),a.useEffect(()=>{e&&localStorage.setItem(`${_r}-${e}`,we)},[we,e]),a.useEffect(()=>{if(!Fe)return;const r=c=>{Sn.current&&(Sn.current.contains(c.target)||et(!1))};return document.addEventListener("mousedown",r),()=>document.removeEventListener("mousedown",r)},[Fe]),a.useEffect(()=>{if(ze===null)return;const r=c=>{const h=c.target;if(!(h instanceof HTMLElement)){Ge(null);return}const x=`[data-list-actions-menu-id="${ze}"]`;h.closest(x)||Ge(null)};return document.addEventListener("mousedown",r),()=>document.removeEventListener("mousedown",r)},[ze]),a.useEffect(()=>{if(!ee)return;const r=c=>{Wt.current&&(Wt.current.contains(c.target)||rt(null))};return document.addEventListener("mousedown",r),()=>document.removeEventListener("mousedown",r)},[ee]),a.useEffect(()=>{Ze&&ci(Le)},[Ze,Le,e]),a.useEffect(()=>{if(!Hn)return;const r=h=>{const x=kn.current,m=nn.current;if(!x||!m)return;const b=h.clientX-x.x;m.scrollLeft=x.scrollLeft-b},c=()=>{Dn(!1),kn.current=null};return window.addEventListener("mousemove",r),window.addEventListener("mouseup",c),()=>{window.removeEventListener("mousemove",r),window.removeEventListener("mouseup",c)}},[Hn]);const mi=r=>{if(!s)return"Unknown";const c=s.lists.find(h=>h.id===r.board_list_id);return(c==null?void 0:c.title)||"Unknown"},hi=r=>{const c=[];return(Array.isArray(r.country_label_ids)&&r.country_label_ids.length>0?r.country_label_ids:r.country_label_id!=null?[r.country_label_id]:[]).forEach(m=>{c.push({name:Qt[m]||`Country #${m}`,kind:"country"})}),r.intake_label_id!=null&&c.push({name:Zt[r.intake_label_id]||`Intake #${r.intake_label_id}`,kind:"intake"}),(Array.isArray(r.service_area_ids)&&r.service_area_ids.length>0?r.service_area_ids:r.service_area_id!=null?[r.service_area_id]:[]).forEach(m=>{c.push({name:en[m]||`Service Area #${m}`,kind:"serviceArea"})}),c},gi=r=>{var m;const c=r.card;if(!c)return r.card_id?`Card #${r.card_id}`:"Card";const h=`${c.first_name||""} ${c.last_name||""}`.trim(),x=((m=c.invoice)==null?void 0:m.trim())||"";return x&&h?`${x} ${h}`:x||h||`Card #${c.id}`},xi=r=>{var c,h,x,m,b;return(c=r.list)!=null&&c.title?r.list.title:(x=(h=r.card)==null?void 0:h.boardList)!=null&&x.title?r.card.boardList.title:(b=(m=r.card)==null?void 0:m.board_list)!=null&&b.title?r.card.board_list.title:r.list_id?`List #${r.list_id}`:"Board"},pi=/((?:https?:\/\/|www\.)[^\s]+)/gi,bi=r=>/^(?:https?:\/\/|www\.)[^\s]+$/i.test(r),yi=r=>/^https?:\/\//i.test(r)?r:`https://${r}`,Gn=r=>{if(!r)return null;const c=r.split(/\r?\n/);return c.map((h,x)=>t.jsxs("span",{children:[h.split(pi).map((m,b)=>{if(!m)return null;if(!bi(m))return t.jsx("span",{children:m},`activity-text-${x}-${b}`);const L=m.match(/^(.*?)([.,!?)]*)$/),$=(L==null?void 0:L[1])||m,E=(L==null?void 0:L[2])||"";return t.jsxs("span",{children:[t.jsx("a",{href:yi($),target:"_blank",rel:"noopener noreferrer",className:"text-indigo-600 hover:text-indigo-700 underline break-all",children:$}),E]},`activity-link-${x}-${b}`)}),x<c.length-1?t.jsx("br",{}):null]},`activity-line-${x}`))},tr=r=>{const c=r.trim().toLowerCase();return c.startsWith("country:")?{label:"Country",badgeClass:"inline-flex items-center rounded-full border border-[#8f53c6] bg-[#8f53c6] px-2 py-0.5 text-xs font-semibold text-white",valueClass:"text-[#5f3a8c]"}:c.startsWith("intake:")?{label:"Intake",badgeClass:"inline-flex items-center rounded-full border border-[#f2b205] bg-[#f2b205] px-2 py-0.5 text-xs font-semibold text-[#4a2b00]",valueClass:"text-[#7a4a00]"}:c.startsWith("service area:")?{label:"Service Area",badgeClass:"inline-flex items-center rounded-full border border-[#d63a3a] bg-[#d63a3a] px-2 py-0.5 text-xs font-semibold text-white",valueClass:"text-[#8f2a2a]"}:null},vi=(r,c)=>(r||"").toLowerCase().includes("label")?!0:c?c.split(/\r?\n/).some(h=>!!tr(h)):!1,wi=r=>{if(!r)return null;const c=r.split(/\r?\n/).map(h=>h.trim()).filter(h=>h.length>0);return c.length===0?null:t.jsx("div",{className:"space-y-1.5",children:c.map((h,x)=>{const m=tr(h);if(!m)return t.jsx("div",{className:"text-sm text-gray-700",children:Gn(h)},`label-change-plain-${x}`);const b=h.indexOf(":"),L=b>=0?h.slice(b+1).trim():h;return t.jsxs("div",{className:"flex flex-wrap items-start gap-2",children:[t.jsx("span",{className:m.badgeClass,children:m.label}),t.jsx("span",{className:`min-w-0 text-sm ${m.valueClass}`,children:Gn(L||"None")})]},`label-change-row-${x}`)})})},nr=r=>{if(!r)return null;const h=r.split(/\r?\n/).find(E=>E.trim().toLowerCase().startsWith("description:"));if(!h)return null;const x=h.trim().slice(12).trim(),m='" -> "';if(!x.startsWith('"')||!x.endsWith('"')||!x.includes(m))return null;const b=x.indexOf(m);if(b<=0)return null;const L=x.slice(1,b),$=x.slice(b+m.length,x.length-1);return{before:L.trim()||"[empty]",after:$.trim()||"[empty]"}},Ni=(r,c)=>{let h=0;const x=Math.min(r.length,c.length);for(;h<x&&r[h]===c[h];)h+=1;let m=r.length-1,b=c.length-1;for(;m>=h&&b>=h&&r[m]===c[b];)m-=1,b-=1;return{prefix:r.slice(0,h),beforeChanged:r.slice(h,m+1),afterChanged:c.slice(h,b+1),suffix:r.slice(m+1)}},sr=(r,c,h,x)=>t.jsxs(t.Fragment,{children:[r,c?t.jsx("mark",{className:`rounded px-0.5 ${x}`,children:c}):null,h]}),ji=r=>{const c=nr(r);if(!c)return null;const h=Ni(c.before,c.after);return t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"rounded-md border border-rose-200 bg-rose-50 p-2.5",children:[t.jsx("p",{className:"text-[11px] font-semibold uppercase tracking-wide text-rose-700",children:"Before"}),t.jsx("p",{className:"mt-1 whitespace-pre-wrap break-words text-sm text-rose-900",children:sr(h.prefix,h.beforeChanged,h.suffix,"bg-rose-200/80 text-rose-900")})]}),t.jsxs("div",{className:"rounded-md border border-emerald-200 bg-emerald-50 p-2.5",children:[t.jsx("p",{className:"text-[11px] font-semibold uppercase tracking-wide text-emerald-700",children:"After"}),t.jsx("p",{className:"mt-1 whitespace-pre-wrap break-words text-sm text-emerald-900",children:sr(h.prefix,h.afterChanged,h.suffix,"bg-emerald-200/90 text-emerald-900")})]})]})},Ci=async r=>{if(!(!r.attachment_path&&!r.attachment_url))try{qt(r.id);const c=await V.get(`/activities/${r.id}/attachment`,{responseType:"blob"}),h=new Blob([c.data],{type:r.attachment_mime||c.headers["content-type"]||"application/octet-stream"}),x=window.URL.createObjectURL(h),m=document.createElement("a");m.href=x,m.target="_blank",r.attachment_name&&(m.download=r.attachment_name),document.body.appendChild(m),m.click(),m.remove(),window.URL.revokeObjectURL(x)}catch(c){console.error("Open board activity attachment failed",c),alert("Could not open attachment.")}finally{qt(null)}},ws=async(r,c,h,x)=>{try{await V.post("/activities",{card_id:h??null,list_id:x??null,action:r,details:c})}catch(m){console.error("Failed to log activity:",m)}},Si=async()=>{if(!A.trim()||!s)return;const r=j?4:D,c=s.lists.length+1,h={id:Date.now(),board_id:s.id,title:A.trim(),category:r,position:c,created_at:new Date().toISOString(),updated_at:new Date().toISOString(),cards:[]};i(x=>x?{...x,lists:[...x.lists,h]}:null),O(""),R(j?4:3),_(!1);try{const m=(await V.post(`/boards/${s.id}/lists`,{title:h.title,category:h.category??(j?4:0),position:c})).data.id;await ws("created list",`List: ${h.title}`,void 0,m),await ce()}catch(x){console.error("Create list failed",x),await ce()}},Ns=Number(u==null?void 0:u.role_id)===1,Jn=Number(u==null?void 0:u.role_id)===1,rr=Number(u==null?void 0:u.role_id)===1,ir=Number(u==null?void 0:u.role_id)===1,ki=r=>{!Ns||ut!==null||(ge(r.id),He(r.title))},ar=async r=>{if(!s)return;const c=Me.trim();if(!c){He(r.title),ge(null);return}if(c===r.title){ge(null);return}me(r.id);try{await V.put(`/boards/${s.id}/lists/${r.id}`,{title:c}),i(h=>h&&{...h,lists:h.lists.map(x=>x.id===r.id?{...x,title:c}:x)}),ge(null)}catch(h){console.error("Update list title failed",h),alert("Could not update list title."),He(r.title)}finally{me(null)}},Di=async r=>{var x,m;if(!s||!rr||(Ge(null),!window.confirm(`Delete list "${r.title}" and all its cards? This cannot be undone.`)))return;const h=s.lists;_e(r.id),i(b=>b&&{...b,lists:b.lists.filter(L=>L.id!==r.id)}),W===r.id&&U(null),ve===r.id&&(ge(null),He("")),(g==null?void 0:g.board_list_id)===r.id&&p(null);try{await V.delete(`/boards/${s.id}/lists/${r.id}`),await ws("deleted list",`List: ${r.title}`,void 0,r.id)}catch(b){console.error("Delete list failed",b),i(L=>L&&{...L,lists:h}),alert(((m=(x=b==null?void 0:b.response)==null?void 0:x.data)==null?void 0:m.message)||"Could not delete list.")}finally{_e(null)}},_i=async r=>{var h,x,m,b,L,$,E;if(!K.trim()){alert("Invoice is required.");return}const c={invoice:K.trim(),first_name:z.trim()||void 0,last_name:ie.trim()||void 0};try{const fe=(await V.post(`/board-lists/${r}/cards`,c)).data.id;await ws("created card",`Card: ${c.invoice} ${c.first_name||""} ${c.last_name||""}`.trim(),fe),T(""),q(""),Y(""),U(null),await ce()}catch(B){console.error("Create card failed",B);const fe=((b=(m=(x=(h=B==null?void 0:B.response)==null?void 0:h.data)==null?void 0:x.errors)==null?void 0:m.invoice)==null?void 0:b[0])||(($=(L=B==null?void 0:B.response)==null?void 0:L.data)==null?void 0:$.message)||(((E=B==null?void 0:B.response)==null?void 0:E.status)===403?"You do not have permission to create cards in this list.":null);alert(fe||"Could not create card. Please try again.")}},Ai=r=>`${r.invoice||`ID-${r.id}`} ${r.first_name||""} ${r.last_name||""}`.trim(),Li=async r=>{var c,h,x;ft(!0),it(null),jt([]),Te("Commission Board");try{const b=(await V.get(`/cards/${r.id}/commission-targets`)).data??{},$=(Array.isArray(b==null?void 0:b.lists)?b.lists:[]).map(E=>({id:Number(E==null?void 0:E.id),title:String((E==null?void 0:E.title)??"").trim(),position:(E==null?void 0:E.position)!=null?Number(E.position):void 0})).filter(E=>Number.isFinite(E.id)&&E.title.length>0);Te(typeof((c=b==null?void 0:b.board)==null?void 0:c.name)=="string"&&b.board.name.trim().length>0?b.board.name:"Commission Board"),jt($)}catch(m){console.error("Fetch commission targets failed",m),it(((x=(h=m==null?void 0:m.response)==null?void 0:h.data)==null?void 0:x.message)||"Could not load commission board lists.")}finally{ft(!1)}},Ei=(r,c)=>{!ir||ae!==null||(rt({card:r,x:c.x,y:c.y}),Li(r))},Mi=async(r,c)=>{var h,x;if(ae===null){rt(null),Be(r.id);try{await V.put(`/cards/${r.id}/move-to-commission`,{to_list_id:c}),(g==null?void 0:g.id)===r.id&&p(null),await ce()}catch(m){console.error("Move card to Commission Board failed",m),alert(((x=(h=m==null?void 0:m.response)==null?void 0:h.data)==null?void 0:x.message)||"Could not move card to Commission Board.")}finally{Be(null)}}},Ri=async r=>{ee&&await Mi(ee.card,r)},$i=()=>{T(""),q(""),Y(""),U(null)},js=r=>{const c=String(r);if(!c.startsWith("list-"))return null;const h=Number(c.slice(5));return Number.isFinite(h)?h:null},Ii=r=>{if(String(r.active.id).startsWith("list-"))return Fa(r);const h=Wa(r);return h.length>0?h:Oa(r)},Ti=r=>{if(!s)return;const c=js(r.active.id);if(c!=null){if(!Jn||$e||be)return;S(c);return}if(S(null),$e||be)return;const h=Number(r.active.id);for(const x of s.lists){const m=x.cards.find(b=>b.id===h);if(m){w(m);break}}},Oi=async r=>{var rn,an;if(w(null),S(null),!s||!r.over)return;const c=js(r.active.id),h=js(r.over.id);if(c!=null){if(!Jn||$e||be||h==null||c===h)return;const P=s.lists.find(se=>se.id===c),Q=s.lists.find(se=>se.id===h);if(!P||!Q)return;const Se=P.category??0,C=Q.category??0;if(Se!==C)return;const I=s.lists.filter(se=>(se.category??0)===Se).sort((se,vt)=>se.position-vt.position),st=I.findIndex(se=>se.id===c),X=I.findIndex(se=>se.id===h);if(st<0||X<0||st===X)return;const _t=[...I],[Rn]=_t.splice(st,1);_t.splice(X,0,Rn);const Qn=_t.reduce((se,vt,Ls)=>(se[vt.id]=Ls+1,se),{}),As={...s,lists:s.lists.map(se=>({...se,cards:se.cards.map(vt=>({...vt}))}))};i({...s,lists:s.lists.map(se=>Qn[se.id]!=null?{...se,position:Qn[se.id]}:se).sort((se,vt)=>se.position-vt.position)});try{await Promise.all(_t.map((se,vt)=>V.put(`/boards/${s.id}/lists/${se.id}`,{position:vt+1}))),await ce()}catch(se){console.error("Reorder lists failed",se),i(As),alert("Could not reorder lists.")}return}if($e||be)return;const x=Number(r.active.id);if(!Number.isFinite(x))return;const m=s.lists.findIndex(P=>P.cards.some(Q=>Q.id===x));if(m<0)return;const b=s.lists[m],L=b.cards.findIndex(P=>P.id===x);if(L<0)return;const $=b.cards[L],E=String(r.over.id);let B=-1,fe=-1;if(E.startsWith("list-")){const P=Number(E.replace("list-",""));B=s.lists.findIndex(Q=>Q.id===P),B>=0&&(fe=s.lists[B].cards.length)}else{const P=Number(r.over.id);Number.isFinite(P)&&(B=s.lists.findIndex(Q=>Q.cards.some(Se=>Se.id===P)),B>=0&&(fe=s.lists[B].cards.findIndex(Q=>Q.id===P)))}if(B<0||fe<0)return;const Ve=s.lists[B],hn={...s,lists:s.lists.map(P=>({...P,cards:P.cards.map(Q=>({...Q}))}))};if(b.id===Ve.id){const P=b.cards.length-1,Q=Math.min(fe,P);if(L===Q)return;const Se=er(b.cards,L,Q).map((C,I)=>({...C,position:I+1}));i({...s,lists:s.lists.map((C,I)=>I===m?{...C,cards:Se}:C)});try{await Promise.all(Se.map((C,I)=>V.put(`/board-lists/${b.id}/cards/${C.id}`,{position:I+1}))),await ce()}catch(C){console.error("Reorder card failed",C),i(hn)}return}const M=b.category??0,nt=Ve.category??0;if(M!==1&&nt===1&&!$.payment_done){at("This card is unpaid. Mark visa payment as done before moving it to Visa.");return}if(M!==2&&nt===2&&!$.dependant_payment_done){at("Dependant payment is pending. Mark dependant payment as done before moving it to Dependant Visa.");return}const yt=s.lists.map(P=>({...P,cards:P.cards.map(Q=>({...Q}))})),gn=yt[m].cards.filter(P=>P.id!==$.id),Xt=yt[B].cards,sn=Math.min(Math.max(fe,0),Xt.length);Xt.splice(sn,0,{...$,board_list_id:Ve.id}),yt[m].cards=gn.map((P,Q)=>({...P,position:Q+1})),yt[B].cards=Xt.map((P,Q)=>({...P,board_list_id:Ve.id,position:Q+1})),i({...s,lists:yt});try{await V.post("/cards/move",{card_id:$.id,to_list_id:Ve.id,position:sn+1})}catch(P){i(hn);const Q=(an=(rn=P==null?void 0:P.response)==null?void 0:rn.data)==null?void 0:an.message;typeof Q=="string"&&Q.toLowerCase().includes("payment")&&at(Q);return}try{const P=yt[m].cards.map((Se,C)=>V.put(`/board-lists/${b.id}/cards/${Se.id}`,{position:Se.position??C+1})),Q=yt[B].cards.filter(Se=>Se.id!==$.id).map(Se=>V.put(`/board-lists/${Ve.id}/cards/${Se.id}`,{position:Se.position??1}));await Promise.allSettled([...P,...Q])}catch(P){console.error("Background card position normalization failed",P)}await ce()},_n=a.useMemo(()=>{const r=new Map;return gt.forEach(c=>{var $;const h=Number(c==null?void 0:c.id);if(!Number.isFinite(h))return;const x=(c==null?void 0:c.role_id)??(($=c==null?void 0:c.role)==null?void 0:$.id),m=x!=null?Number(x):null;if(m==null||![2,3,4].includes(m))return;const L=(Array.isArray(c==null?void 0:c.board_lists)?c.board_lists:Array.isArray(c==null?void 0:c.boardLists)?c.boardLists:[]).map(E=>Number(E==null?void 0:E.id)).filter(E=>Number.isFinite(E));r.set(h,{id:h,firstName:`${(c==null?void 0:c.first_name)||""}`.trim(),lastName:`${(c==null?void 0:c.last_name)||""}`.trim(),roleId:m,boardListIds:L})}),r},[gt]),mn=a.useMemo(()=>{if(!s)return[];const r=new Set(s.lists.map(m=>m.id)),c=new Map(s.lists.map(m=>[m.id,m.title])),h=new Map,x=(m,b)=>{const L=h.get(m);if(L)return L;const $={id:m,name:b.name,roleId:b.roleId,roleName:Lr(b.roleId),cardIds:new Set,listIds:new Set,listTitles:new Set};return h.set(m,$),$};return _n.forEach(m=>{const b=`${m.firstName||""} ${m.lastName||""}`.trim()||`User #${m.id}`,L=x(m.id,{name:b,roleId:m.roleId});m.boardListIds.forEach($=>{r.has($)&&(L.listIds.add($),L.listTitles.add(c.get($)||`List #${$}`))})}),s.lists.forEach(m=>{m.cards.forEach(b=>{(b.members||[]).forEach(L=>{const $=Number(L.id);if(!Number.isFinite($))return;const E=_n.get($),B=(E==null?void 0:E.roleId)??(L.role_id!=null?Number(L.role_id):null);if(B==null||![2,3,4].includes(B))return;const fe=E?`${E.firstName||""} ${E.lastName||""}`.trim()||`User #${$}`:`${L.first_name||""} ${L.last_name||""}`.trim()||`User #${$}`,Ve=x($,{name:fe,roleId:B});Ve.cardIds.add(b.id),Ve.listIds.add(m.id),Ve.listTitles.add(m.title)})})}),Array.from(h.values()).map(m=>({id:m.id,name:m.name,roleId:m.roleId,roleName:m.roleName,listCount:m.listIds.size,cardCount:m.cardIds.size,listTitles:Array.from(m.listTitles).sort((b,L)=>b.localeCompare(L))})).sort((m,b)=>m.name.localeCompare(b.name))},[s,_n]);a.useEffect(()=>{if(ct==="")return;new Set(mn.map(c=>c.id)).has(ct)||cn("")},[mn,ct]),a.useEffect(()=>{if(de==="")return;new Set(mn.map(c=>c.id)).has(de)||Xe("")},[mn,de]);const{laterIntakeLists:Cs,admissionLists:Ss,visaLists:ks,dependantVisaLists:Ds,commissionBoardLists:_s,totalMatchedCards:or}=a.useMemo(()=>{var Se;if(!s)return{laterIntakeLists:[],admissionLists:[],visaLists:[],dependantVisaLists:[],commissionBoardLists:[],totalMatchedCards:0};const r=new Date,c=new Date(r.getFullYear(),r.getMonth(),r.getDate()),x=(c.getDay()+6)%7,m=new Date(c);m.setDate(c.getDate()-x);const b=new Date(m);b.setDate(m.getDate()+6);const $=$e&&!(Ut==="*"),E=$?Ut.split(/\s+/).filter(Boolean):[],B=E.some(C=>["paid","done","unpaid","pending"].includes(C)),fe=ct!==""?new Set(((Se=_n.get(ct))==null?void 0:Se.boardListIds)||[]):null,Ve=C=>{if(Dt==="all")return!0;const I=kr(C.due_date);return I?Dt==="today"?I.toDateString()===c.toDateString():Dt==="this_week"?I>=m&&I<=b:Dt==="overdue"?I<c:!0:!1},hn=C=>{const I=Array.isArray(C.country_label_ids)&&C.country_label_ids.length>0?C.country_label_ids:C.country_label_id!=null?[C.country_label_id]:[],st=Array.isArray(C.service_area_ids)&&C.service_area_ids.length>0?C.service_area_ids:C.service_area_id!=null?[C.service_area_id]:[],X=(C.members||[]).map(G=>Number(G.id)).filter(G=>Number.isFinite(G));if(dt.length>0&&!I.some(G=>dt.includes(G))||Mt.length>0&&(C.intake_label_id==null||!Mt.includes(C.intake_label_id))||Rt.length>0&&!st.some(G=>Rt.includes(G)))return!1;if(ct!==""){const G=X.includes(ct),Yi=(fe==null?void 0:fe.has(Number(C.board_list_id)))??!1;if(!G&&!Yi)return!1}if(!Ve(C))return!1;if(!$)return!0;const _t=I.map(G=>Qt[G]||"").filter(Boolean).join(" "),Rn=C.intake_label_id!=null&&Zt[C.intake_label_id]||"",Qn=st.map(G=>en[G]||"").filter(Boolean).join(" "),As=(C.members||[]).map(G=>`${G.first_name||""} ${G.last_name||""}`.trim()).filter(Boolean).join(" "),se=(C.members||[]).map(G=>Lr(G.role_id)).filter(Boolean).join(" "),vt=C.payment_done?"visa payment paid done":"visa payment unpaid pending",Ls=C.dependant_payment_done?"dependant payment dependant-paid dependant-done":"dependant payment dependant-unpaid dependant-pending",Vi=[C.invoice,C.first_name,C.last_name,C.title,C.description,_t,Rn,Qn,As,se,vt,Ls].filter(G=>!!G).join(" ").toLowerCase();return E.every(G=>G==="paid"||G==="done"?C.payment_done===!0:G==="unpaid"||G==="pending"?C.payment_done!==!0:G==="dependant-paid"||G==="dependent-paid"||G==="dependant-done"?C.dependant_payment_done===!0:G==="dependant-unpaid"||G==="dependent-unpaid"||G==="dependant-pending"?C.dependant_payment_done!==!0:Vi.includes(G))},M=C=>C.map(I=>{const st=I.cards.length;if(!$&&!be)return{...I,cards:[...I.cards],totalCards:st,matchedByTitle:!1};const X=$&&!be&&!B&&I.title.toLowerCase().includes(Ut),_t=I.cards.filter(Rn=>hn(Rn));return{...I,cards:_t,totalCards:st,matchedByTitle:X}}).filter(I=>{if(!$&&!be)return!0;if(be){const st=ct!==""&&((fe==null?void 0:fe.has(Number(I.id)))??!1);return I.cards.length>0||st}return I.matchedByTitle||I.cards.length>0}),nt=s.lists.filter(C=>C.category===3).sort((C,I)=>C.position-I.position),En=s.lists.filter(C=>(C.category??0)===0).sort((C,I)=>C.position-I.position),Mn=s.lists.filter(C=>C.category===1).sort((C,I)=>C.position-I.position),yt=s.lists.filter(C=>C.category===2).sort((C,I)=>C.position-I.position),gn=s.lists.filter(C=>C.category===4).sort((C,I)=>C.position-I.position),Xt=M(nt),sn=M(En),rn=M(Mn),an=M(yt),P=M(gn);if(j)return{laterIntakeLists:[],admissionLists:[],visaLists:[],dependantVisaLists:[],commissionBoardLists:P,totalMatchedCards:P.reduce((C,I)=>C+I.cards.length,0)};const Q=[...Xt,...sn,...rn,...an];return{laterIntakeLists:Xt,admissionLists:sn,visaLists:rn,dependantVisaLists:an,commissionBoardLists:[],totalMatchedCards:Q.reduce((C,I)=>C+I.cards.length,0)}},[s,j,Ut,$e,be,Dt,dt,Mt,Rt,ct,_n,Qt,Zt,en]),An=a.useMemo(()=>{if(!s||s.lists.length===0)return new Set;if(j){const m=[...s.lists].filter(b=>b.category===4).sort((b,L)=>b.position-L.position)[0];return new Set([m==null?void 0:m.id].filter(b=>b!=null))}const r=[...s.lists].filter(m=>m.category===3).sort((m,b)=>m.position-b.position)[0],c=[...s.lists].filter(m=>(m.category??0)===0).sort((m,b)=>m.position-b.position)[0],h=[...s.lists].filter(m=>m.category===1).sort((m,b)=>m.position-b.position)[0],x=[...s.lists].filter(m=>m.category===2).sort((m,b)=>m.position-b.position)[0];return new Set([r==null?void 0:r.id,c==null?void 0:c.id,h==null?void 0:h.id,x==null?void 0:x.id].filter(m=>m!=null))},[s,j]);if(o)return t.jsx(Qi,{message:"Loading board..."});if(!s)return null;const Ln=(r,c)=>{const h=$e||be,x=Jn&&!h&&ve!==r.id;return t.jsx(bl,{list:r,dragDisabled:!Jn||h,children:({dragHandleProps:m})=>t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"p-4 pb-2",children:[t.jsxs("div",{className:`flex justify-between items-center gap-2 mb-3 ${x?"cursor-grab active:cursor-grabbing select-none touch-none":""}`,...x?m:{},title:x?"Drag to reorder list":void 0,children:[ve===r.id?t.jsx("input",{autoFocus:!0,value:Me,onChange:b=>He(b.target.value),onBlur:()=>void ar(r),onKeyDown:b=>{b.key==="Enter"&&(b.preventDefault(),ar(r)),b.key==="Escape"&&(He(r.title),ge(null))},disabled:ut===r.id,className:"h-9 w-full rounded-md border border-indigo-300 bg-white px-3 text-[14px] leading-5 font-semibold text-gray-900 focus:outline-none focus:ring-2 focus:ring-indigo-400"}):t.jsx("h3",{className:`min-w-0 font-semibold text-[15px] leading-5 whitespace-normal break-words ${Ns?"cursor-text hover:underline underline-offset-4":""} ${$e&&r.matchedByTitle?"text-indigo-700":""}`,onDoubleClick:()=>ki(r),title:Ns?"Double-click to edit list title":void 0,children:r.title}),t.jsxs("div",{className:"flex items-center gap-2 shrink-0",children:[l&&t.jsxs("span",{className:"px-2 py-0.5 rounded-full bg-indigo-50 text-indigo-700 text-xs font-semibold whitespace-nowrap",children:[r.cards.length," ",r.cards.length===1?"card":"cards"," match"]}),rr&&t.jsxs("div",{className:"relative","data-list-actions-menu-id":r.id,children:[t.jsx("button",{type:"button",onClick:b=>{b.stopPropagation(),Ge(L=>L===r.id?null:r.id)},disabled:qe===r.id,className:"inline-flex h-8 w-8 items-center justify-center rounded-md border border-gray-200 text-gray-600 hover:bg-gray-50 disabled:cursor-not-allowed disabled:opacity-60",title:"List actions","aria-label":`Actions for ${r.title}`,children:t.jsx(Rr,{size:15})}),ze===r.id&&t.jsx("div",{className:"absolute right-0 top-full mt-1 z-20 w-40 rounded-md border border-gray-200 bg-white p-1.5 shadow-lg",children:t.jsx("button",{type:"button",onClick:()=>void Di(r),disabled:qe===r.id,className:`w-full rounded-md px-3 py-2 text-left text-sm transition ${qe===r.id?"text-gray-400 cursor-not-allowed":"text-red-700 hover:bg-red-50"}`,children:qe===r.id?"Deleting...":"Delete list"})})]})]})]}),t.jsx(xn,{items:r.cards.map(b=>b.id),strategy:il,children:t.jsx("div",{className:"max-h-[calc(100vh-320px)] overflow-y-auto pr-1",children:t.jsx("div",{className:"space-y-3",children:r.cards.map(b=>t.jsx(pl,{card:b,onClick:()=>p(b),labelBadges:hi(b),dragDisabled:$e||be,showActions:ir,disableActions:ae===b.id,onOpenActions:Ei},b.id))})})})]}),c?t.jsx("div",{className:"p-3 pt-0",children:W===r.id?t.jsxs("div",{className:"bg-white rounded-lg border p-3 shadow-sm",children:[t.jsx("input",{value:K,onChange:b=>T(b.target.value),placeholder:"Invoice",className:"w-full border rounded-md px-3 py-2 text-sm focus:ring-2 focus:ring-indigo-400 outline-none mb-3"}),t.jsxs("div",{className:"grid grid-cols-2 gap-2 mb-3",children:[t.jsx("input",{value:z,onChange:b=>q(b.target.value),placeholder:"First name",className:"w-full border rounded-md px-3 py-2 text-sm focus:ring-2 focus:ring-indigo-400 outline-none"}),t.jsx("input",{value:ie,onChange:b=>Y(b.target.value),placeholder:"Last name",className:"w-full border rounded-md px-3 py-2 text-sm focus:ring-2 focus:ring-indigo-400 outline-none"})]}),t.jsxs("div",{className:"flex gap-3 mt-4",children:[t.jsx("button",{onClick:()=>_i(r.id),className:"flex-1 bg-indigo-600 text-white py-2 rounded-md text-sm font-medium",children:"Add card"}),t.jsx("button",{onClick:$i,className:"flex-1 bg-gray-200 text-gray-800 py-2 rounded-md text-sm font-medium hover:bg-gray-300",children:"Cancel"})]})]}):t.jsxs("button",{onClick:()=>U(r.id),className:"w-full flex items-center gap-2 text-gray-600 hover:bg-gray-100 rounded-lg px-2 py-2 text-sm",children:[t.jsx(ss,{size:16})," Add a card"]})}):t.jsx("div",{className:"h-12"})]})},r.id)},lr=k!=null&&s.lists.find(r=>r.id===k)||null,Fi=ee?Math.max(12,Math.min(ee.x,(typeof window<"u"?window.innerWidth:ee.x)-320)):12,zi=ee?Math.max(12,Math.min(ee.y,(typeof window<"u"?window.innerHeight:ee.y)-420)):12,Bi=r=>{const c=r.cards.slice(0,3);return t.jsx("div",{className:"w-[22rem] rounded-xl border border-gray-200 bg-white/95 backdrop-blur-sm shadow-2xl rotate-[1.2deg]",children:t.jsxs("div",{className:"p-4 pb-2",children:[t.jsx("h3",{className:"font-semibold text-lg text-gray-900 truncate",children:r.title}),t.jsx("div",{className:"mt-3 space-y-3",children:c.length===0?t.jsx("div",{className:"h-14 rounded-lg border border-dashed border-gray-300 bg-gray-50"}):c.map(h=>{const x=`${h.invoice||`ID-${h.id}`} ${h.first_name||""} ${h.last_name||""}`.trim();return t.jsxs("div",{className:"rounded-lg border border-gray-200 bg-white px-3 py-2",children:[t.jsx("p",{className:"text-sm font-semibold text-indigo-700 truncate",children:x}),t.jsx("p",{className:"text-xs text-gray-500 mt-1",children:Vt(h.created_at)})]},`overlay-card-${h.id}`)})})]})})},Pi=r=>{const c=nn.current;if(!c||!(c.scrollWidth>c.clientWidth))return;const x=c.scrollHeight>c.clientHeight;if(!r.shiftKey&&x)return;const m=r.deltaX!==0?r.deltaX:r.deltaY;m!==0&&(c.scrollLeft+=m,r.preventDefault())},Wi=r=>!(!(r instanceof HTMLElement)||r.closest("button, a, input, textarea, select, label, [role='button'], [role='dialog'], [contenteditable='true']")),Ui=r=>{if(r.button!==0||!Wi(r.target))return;const c=nn.current;c&&(kn.current={x:r.clientX,scrollLeft:c.scrollLeft},Dn(!0))},Xi=()=>{et(!1),n("/profile")},Ki=()=>{et(!1),sessionStorage.removeItem("token"),sessionStorage.removeItem("role_id"),sessionStorage.removeItem("panel_permission"),sessionStorage.removeItem("user"),sessionStorage.removeItem("auth"),localStorage.removeItem("token"),localStorage.removeItem("user"),n("/signin")};return t.jsxs("div",{className:"h-screen flex flex-col bg-gray-50 overflow-hidden",children:[t.jsxs("header",{className:"h-14 bg-white border-b shadow-sm flex items-center justify-between px-4 gap-4",children:[t.jsx("div",{className:"flex items-center gap-4",children:t.jsx("button",{type:"button",onClick:()=>n("/choose-dashboard"),className:"h-7 flex items-center cursor-pointer",title:"Go to home",children:t.jsx("img",{src:"/images/logo/connected_logo.png",alt:"Connected Logo",className:"h-7 w-auto object-contain"})})}),t.jsx("div",{className:"flex-1 max-w-2xl mx-6",children:t.jsxs("div",{className:"relative",children:[t.jsx(Zi,{size:15,className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 pointer-events-none"}),t.jsx("input",{ref:tn,value:Re,onChange:r=>Ae(r.target.value),placeholder:"Search cards, invoice, student, list title (Ctrl+K)",className:"w-full h-9 pl-9 pr-9 rounded-lg bg-gray-100 border text-sm focus:ring-2 focus:ring-indigo-400/40 outline-none"}),Re&&t.jsx("button",{type:"button",onClick:()=>{var r;Ae(""),(r=tn.current)==null||r.focus()},className:"absolute right-2.5 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600","aria-label":"Clear search",children:t.jsx(Tt,{size:14})})]})}),t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsxs("div",{className:"relative",ref:jn,children:[t.jsxs("button",{type:"button",onClick:()=>Pe(r=>!r),className:`flex items-center gap-2 px-3 py-1.5 border rounded-lg text-sm font-medium transition ${ke?"bg-indigo-50 border-indigo-300 text-indigo-700":"bg-white border-gray-300 text-gray-700 hover:bg-gray-50"}`,children:[t.jsx("span",{children:"Theme"}),t.jsx("span",{className:"h-4 w-4 rounded-full border border-gray-300",style:{backgroundColor:we},"aria-hidden":"true"}),t.jsx(on,{size:14,className:`transition-transform ${ke?"rotate-180":""}`})]}),ke&&t.jsxs("div",{className:"absolute right-0 mt-2 w-[22rem] rounded-xl border border-gray-200 bg-white shadow-xl p-3 z-50",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsx("p",{className:"text-xs font-semibold text-gray-700",children:"Choose Theme Color"}),t.jsxs("span",{className:"text-[11px] text-gray-500",children:[Ts.length," options"]})]}),t.jsx("div",{className:"grid grid-cols-10 gap-2 max-h-44 overflow-y-auto pr-1",children:Ts.map(r=>{const c=we===r;return t.jsx("button",{type:"button",onClick:()=>{ht(r),Pe(!1)},className:`h-6 w-6 rounded-full border transition ${c?"border-gray-900 ring-2 ring-gray-400 ring-offset-1":"border-gray-200 hover:scale-105 hover:border-gray-500"}`,style:{backgroundColor:r},title:r,"aria-label":`Set theme color ${r}`},r)})})]})]}),t.jsxs("div",{className:"relative",ref:Cn,children:[t.jsxs("button",{type:"button",onClick:()=>Je(r=>!r),className:`flex items-center gap-1.5 px-3 py-1.5 border rounded-lg text-sm font-medium transition ${be?"bg-indigo-50 border-indigo-300 text-indigo-700":"bg-white border-gray-300 text-gray-700 hover:bg-gray-50"}`,children:[t.jsx(ca,{size:15}),"Filter"]}),ot&&t.jsxs("div",{className:"absolute right-0 mt-2 w-80 rounded-xl border border-gray-200 bg-white shadow-xl p-4 z-50 space-y-3",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("p",{className:"text-sm font-semibold text-gray-800",children:"Card Filters"}),t.jsx("button",{type:"button",onClick:()=>{Ae(""),wn([]),dn([]),Vn([]),cn(""),Nn("all"),bt(null)},className:"text-xs text-indigo-600 hover:text-indigo-800 font-medium",children:"Reset"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Search"}),t.jsx("input",{ref:fn,value:Re,onChange:r=>Ae(r.target.value),placeholder:"Type to filter cards, use * for all cards",className:"h-9 w-full rounded-md border border-gray-300 px-2.5 text-sm text-gray-800 focus:outline-none focus:ring-2 focus:ring-indigo-300"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Member"}),t.jsxs("select",{value:ct,onChange:r=>cn(r.target.value?Number(r.target.value):""),className:"h-9 w-full rounded-md border border-gray-300 px-2.5 text-sm text-gray-800 focus:outline-none focus:ring-2 focus:ring-indigo-300",children:[t.jsx("option",{value:"",children:"Select"}),mn.map(r=>t.jsxs("option",{value:r.id,children:[r.name," (",r.roleName,")"]},`member-filter-option-${r.id}`))]})]}),t.jsxs("div",{children:[t.jsxs("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:["Country (",dt.length,")"]}),t.jsxs("div",{className:"relative",children:[t.jsxs("button",{type:"button",onClick:()=>bt(r=>r==="country"?null:"country"),className:"h-9 w-full rounded-md border border-gray-300 px-2.5 text-sm focus:outline-none focus:ring-2 focus:ring-indigo-300 bg-white text-gray-800 flex items-center justify-between",children:[t.jsx("span",{className:"truncate text-left",children:ye(dt,$t,"Select")}),t.jsx(on,{size:15,className:`text-gray-500 transition-transform ${Gt==="country"?"rotate-180":""}`})]}),Gt==="country"&&t.jsx("div",{className:"absolute left-0 right-0 top-full mt-1 max-h-40 overflow-y-auto rounded-md border border-gray-300 bg-white shadow-lg z-50",children:$t.length===0?t.jsx("div",{className:"px-2.5 py-2 text-xs text-gray-500",children:"No options"}):$t.map(r=>t.jsxs("label",{className:"flex items-center gap-2 px-2.5 py-1.5 text-sm text-gray-800 hover:bg-gray-50 cursor-pointer",children:[t.jsx("input",{type:"checkbox",checked:dt.includes(r.id),onChange:()=>J(r.id,wn),className:"h-3.5 w-3.5 rounded text-indigo-600"}),t.jsx("span",{children:r.name})]},`country-filter-${r.id}`))})]})]}),t.jsxs("div",{children:[t.jsxs("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:["Intake (",Mt.length,")"]}),t.jsxs("div",{className:"relative",children:[t.jsxs("button",{type:"button",onClick:()=>bt(r=>r==="intake"?null:"intake"),className:"h-9 w-full rounded-md border border-gray-300 px-2.5 text-sm focus:outline-none focus:ring-2 focus:ring-indigo-300 bg-white text-gray-800 flex items-center justify-between",children:[t.jsx("span",{className:"truncate text-left",children:ye(Mt,Pt,"Select")}),t.jsx(on,{size:15,className:`text-gray-500 transition-transform ${Gt==="intake"?"rotate-180":""}`})]}),Gt==="intake"&&t.jsx("div",{className:"absolute left-0 right-0 top-full mt-1 max-h-40 overflow-y-auto rounded-md border border-gray-300 bg-white shadow-lg z-50",children:Pt.length===0?t.jsx("div",{className:"px-2.5 py-2 text-xs text-gray-500",children:"No options"}):Pt.map(r=>t.jsxs("label",{className:"flex items-center gap-2 px-2.5 py-1.5 text-sm text-gray-800 hover:bg-gray-50 cursor-pointer",children:[t.jsx("input",{type:"checkbox",checked:Mt.includes(r.id),onChange:()=>J(r.id,dn),className:"h-3.5 w-3.5 rounded text-indigo-600"}),t.jsx("span",{children:r.name})]},`intake-filter-${r.id}`))})]})]}),t.jsxs("div",{children:[t.jsxs("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:["Service (",Rt.length,")"]}),t.jsx("div",{className:"max-h-28 overflow-y-auto rounded-md border border-gray-300 bg-white",children:Jt.length===0?t.jsx("div",{className:"px-2.5 py-2 text-xs text-gray-500",children:"No options"}):Jt.map(r=>t.jsxs("label",{className:"flex items-center gap-2 px-2.5 py-1.5 text-sm text-gray-800 hover:bg-gray-50 cursor-pointer",children:[t.jsx("input",{type:"checkbox",checked:Rt.includes(r.id),onChange:()=>J(r.id,Vn),className:"h-3.5 w-3.5 rounded text-indigo-600"}),t.jsx("span",{children:r.name})]},`service-filter-${r.id}`))})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Due Date"}),t.jsxs("select",{value:Dt,onChange:r=>Nn(r.target.value),className:"h-9 w-full rounded-md border border-gray-300 px-2.5 text-sm text-gray-800 focus:outline-none focus:ring-2 focus:ring-indigo-300",children:[t.jsx("option",{value:"all",children:"Select"}),t.jsx("option",{value:"this_week",children:"This Week"}),t.jsx("option",{value:"today",children:"Today"}),t.jsx("option",{value:"overdue",children:"Overdue"})]})]}),l&&t.jsxs("div",{className:"pt-1 text-xs font-medium text-gray-600",children:[or," ",or===1?"card":"cards"," match current filters"]})]})]}),t.jsxs("button",{type:"button",onClick:ui,className:`flex items-center gap-1.5 px-3 py-1.5 border rounded-lg text-sm font-medium transition ${Ze?"bg-indigo-50 border-indigo-300 text-indigo-700":"bg-white border-gray-300 text-gray-700 hover:bg-gray-50"}`,children:[t.jsx(dr,{size:15}),"Activity"]}),t.jsxs("button",{type:"button",onClick:()=>void di(),className:"flex items-center gap-1.5 px-3 py-1.5 border border-gray-300 bg-white rounded-lg text-sm font-medium text-gray-700 hover:bg-gray-50 transition",children:[t.jsx(Mr,{size:15}),"Archived"]}),t.jsxs("button",{onClick:()=>{R(j?4:3),_(!0)},className:"flex items-center gap-1.5 px-4 py-1.5 bg-gradient-to-r from-indigo-600 to-blue-600 text-white text-sm rounded-lg shadow-md",children:[t.jsx(ss,{size:16})," New List"]}),t.jsxs("div",{className:"relative",ref:Sn,children:[t.jsxs("button",{type:"button",onClick:()=>et(r=>!r),className:"h-8 px-3 rounded-full bg-gradient-to-r from-blue-600 to-indigo-600 text-white text-sm font-semibold flex items-center justify-center gap-1.5 shadow-sm hover:opacity-95",title:"Open user menu","aria-expanded":Fe,"aria-haspopup":"menu",children:[(u==null?void 0:u.first_name)||"User",t.jsx(on,{size:14,className:`transition-transform ${Fe?"rotate-180":""}`})]}),Fe&&t.jsxs("div",{className:"absolute right-0 mt-2 w-44 rounded-lg border border-gray-200 bg-white py-1.5 shadow-lg z-40",children:[t.jsx("button",{type:"button",onClick:Xi,className:"w-full px-3 py-2 text-left text-sm text-gray-700 hover:bg-gray-50",children:"Profile Settings"}),t.jsx("button",{type:"button",onClick:Ki,className:"w-full px-3 py-2 text-left text-sm text-red-600 hover:bg-red-50",children:"Logout"})]})]})]})]}),t.jsxs("main",{className:"flex-1 flex flex-col overflow-hidden rounded-xl shadow-inner m-4 transition-all duration-200",style:{backgroundColor:we,backgroundImage:ne.canvasBackground},children:[t.jsx("div",{className:"h-12 text-white flex items-center justify-between px-6 rounded-t-xl border-b border-white/15",style:{backgroundImage:ne.headerBackground},children:t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx(ea,{size:20}),t.jsx("h1",{className:"text-xl font-bold",children:s.name})]})}),t.jsxs(Io,{sensors:It,collisionDetection:Ii,onDragStart:Ti,onDragEnd:Oi,children:[t.jsx("div",{ref:nn,onWheel:Pi,onMouseDown:Ui,className:"flex-1 min-h-0 overflow-x-auto overflow-y-auto",children:t.jsxs("div",{className:"min-h-full p-6 flex gap-6 min-w-max",children:[j?t.jsx("div",{className:"min-h-0 flex gap-6",children:t.jsxs("div",{className:"min-w-[320px] flex flex-col gap-3",children:[t.jsx("div",{className:"inline-flex items-center gap-2 px-3 py-1 rounded-full bg-indigo-100 text-indigo-800 text-xs font-semibold uppercase tracking-wide",children:"Commission Board Category"}),t.jsx("div",{className:"flex-1",children:t.jsx(xn,{items:_s.map(r=>`list-${r.id}`),strategy:$n,children:t.jsx("div",{className:"flex gap-6 min-w-max items-start pb-2 pr-0",children:_s.length>0?_s.map(r=>Ln(r,An.has(r.id))):t.jsx("div",{className:"w-[22rem] h-28 rounded-xl border border-dashed border-indigo-300 bg-indigo-50/50 text-indigo-800 text-sm flex items-center justify-center",children:$e||be?"No matching cards in commission board":"No commission board lists"})})})})]})}):t.jsxs("div",{className:"min-h-0 flex gap-6",children:[t.jsxs("div",{className:"min-w-[320px] flex flex-col gap-3",children:[t.jsx("div",{className:"inline-flex items-center gap-2 px-3 py-1 rounded-full bg-sky-100 text-sky-800 text-xs font-semibold uppercase tracking-wide",children:"Later Intake"}),t.jsx("div",{className:"flex-1",children:t.jsx(xn,{items:Cs.map(r=>`list-${r.id}`),strategy:$n,children:t.jsx("div",{className:"flex gap-6 min-w-max items-start pb-2 pr-0",children:Cs.length>0?Cs.map(r=>Ln(r,An.has(r.id))):t.jsx("div",{className:"w-[22rem] h-28 rounded-xl border border-dashed border-sky-300 bg-sky-50/50 text-sky-800 text-sm flex items-center justify-center",children:$e||be?"No matching cards in later intake":"No later intake lists"})})})})]}),t.jsx("div",{className:"self-stretch border-l-2 border-dotted border-indigo-300/70"}),t.jsxs("div",{className:"min-w-[320px] flex flex-col gap-3",children:[t.jsx("div",{className:"inline-flex items-center gap-2 px-3 py-1 rounded-full bg-emerald-100 text-emerald-800 text-xs font-semibold uppercase tracking-wide",children:"Admission"}),t.jsx("div",{className:"flex-1",children:t.jsx(xn,{items:Ss.map(r=>`list-${r.id}`),strategy:$n,children:t.jsx("div",{className:"flex gap-6 min-w-max items-start pb-2 pr-0",children:Ss.length>0?Ss.map(r=>Ln(r,An.has(r.id))):t.jsx("div",{className:"w-[22rem] h-28 rounded-xl border border-dashed border-emerald-300 bg-emerald-50/50 text-emerald-800 text-sm flex items-center justify-center",children:$e||be?"No matching cards in admission":"No admission lists"})})})})]}),t.jsx("div",{className:"self-stretch border-l-2 border-dotted border-indigo-300/70"}),t.jsxs("div",{className:"min-w-[320px] flex flex-col gap-3",children:[t.jsx("div",{className:"inline-flex items-center gap-2 px-3 py-1 rounded-full bg-amber-100 text-amber-800 text-xs font-semibold uppercase tracking-wide",children:"Visa"}),t.jsx("div",{className:"flex-1",children:t.jsx(xn,{items:ks.map(r=>`list-${r.id}`),strategy:$n,children:t.jsx("div",{className:"flex gap-6 min-w-max items-start pb-2 pr-0",children:ks.length>0?ks.map(r=>Ln(r,An.has(r.id))):t.jsx("div",{className:"w-[22rem] h-28 rounded-xl border border-dashed border-amber-300 bg-amber-50/50 text-amber-800 text-sm flex items-center justify-center",children:$e||be?"No matching cards in visa":"No visa lists"})})})})]}),t.jsx("div",{className:"self-stretch border-l-2 border-dotted border-indigo-300/70"}),t.jsxs("div",{className:"min-w-[320px] flex flex-col gap-3",children:[t.jsx("div",{className:"inline-flex items-center gap-2 px-3 py-1 rounded-full bg-rose-100 text-rose-800 text-xs font-semibold uppercase tracking-wide",children:"Dependant Visa"}),t.jsx("div",{className:"flex-1",children:t.jsx(xn,{items:Ds.map(r=>`list-${r.id}`),strategy:$n,children:t.jsx("div",{className:"flex gap-6 min-w-max items-start pb-2 pr-0",children:Ds.length>0?Ds.map(r=>Ln(r,An.has(r.id))):t.jsx("div",{className:"w-[22rem] h-28 rounded-xl border border-dashed border-rose-300 bg-rose-50/50 text-rose-800 text-sm flex items-center justify-center",children:$e||be?"No matching cards in dependant visa":"No dependant visa lists"})})})})]})]}),F&&t.jsx("div",{className:"w-[22rem] shrink-0 self-start",children:t.jsxs("div",{className:"bg-white rounded-xl p-4 border shadow-md",children:[j?t.jsx("div",{className:"mb-3",children:t.jsx("button",{type:"button",className:"h-9 w-full rounded-md text-sm font-semibold border bg-indigo-600 text-white border-indigo-600 cursor-default",children:"Commission Board"})}):t.jsxs("div",{className:"grid grid-cols-2 gap-2 mb-3",children:[t.jsx("button",{type:"button",onClick:()=>R(3),className:`h-9 rounded-md text-sm font-semibold border transition ${D===3?"bg-sky-600 text-white border-sky-600":"bg-white text-gray-700 border-gray-300 hover:bg-gray-50"}`,children:"Later Intake"}),t.jsx("button",{type:"button",onClick:()=>R(0),className:`h-9 rounded-md text-sm font-semibold border transition ${D===0?"bg-emerald-600 text-white border-emerald-600":"bg-white text-gray-700 border-gray-300 hover:bg-gray-50"}`,children:"Admission"}),t.jsx("button",{type:"button",onClick:()=>R(1),className:`h-9 rounded-md text-sm font-semibold border transition ${D===1?"bg-amber-600 text-white border-amber-600":"bg-white text-gray-700 border-gray-300 hover:bg-gray-50"}`,children:"Visa"}),t.jsx("button",{type:"button",onClick:()=>R(2),className:`h-9 rounded-md text-sm font-semibold border transition ${D===2?"bg-rose-600 text-white border-rose-600":"bg-white text-gray-700 border-gray-300 hover:bg-gray-50"}`,children:"Dependant"})]}),t.jsx("input",{autoFocus:!0,value:A,onChange:r=>O(r.target.value),placeholder:"Enter list title...",className:"w-full border rounded-md px-3 py-2 text-sm"}),t.jsxs("div",{className:"flex gap-3 mt-3",children:[t.jsx("button",{onClick:Si,className:"bg-indigo-600 text-white px-4 py-1.5 rounded-md",children:"Add list"}),t.jsx("button",{onClick:()=>{_(!1),O(""),R(j?4:3)},className:"text-sm text-gray-600 hover:underline",children:"Cancel"})]})]})})]})}),t.jsx(el,{children:v?t.jsxs("div",{className:"w-[22rem] bg-white rounded-xl p-3 shadow-2xl border border-gray-200",children:[t.jsxs("p",{className:"text-sm font-bold text-indigo-700",children:[v.invoice||`ID-${v.id}`," ",v.first_name||""," ",v.last_name||""]}),t.jsx("p",{className:"text-xs text-gray-500 mt-1",children:Vt(v.created_at)})]}):lr?Bi(lr):null})]}),ee&&t.jsx("div",{className:"fixed inset-0 z-[73] pointer-events-none",children:t.jsxs("div",{ref:Wt,className:"pointer-events-auto fixed w-[20rem] rounded-xl border border-gray-200 bg-white shadow-2xl overflow-hidden",style:{left:Fi,top:zi},children:[t.jsx("div",{className:"px-3 py-2 border-b bg-gray-50",children:t.jsx("p",{className:"text-xs font-semibold text-gray-800 truncate",children:Ai(ee.card)})}),t.jsx("div",{className:"px-3 py-2 bg-gray-50",children:t.jsxs("p",{className:"text-xs font-semibold text-gray-700",children:["Move to ",Ie]})}),t.jsx("div",{className:"max-h-56 overflow-y-auto p-1.5",children:H?t.jsx("p",{className:"px-3 py-2 text-xs text-gray-500",children:"Loading lists..."}):Oe?t.jsx("p",{className:"px-3 py-2 text-xs text-red-600",children:Oe}):xe.length===0?t.jsx("p",{className:"px-3 py-2 text-xs text-gray-500",children:"No Commission Board list found."}):xe.map(r=>t.jsx("button",{type:"button",onClick:()=>void Ri(r.id),disabled:ae===ee.card.id,className:`w-full rounded-md px-3 py-2 text-sm text-left transition ${ae===ee.card.id?"text-gray-400 cursor-not-allowed":"text-indigo-700 hover:bg-indigo-50"}`,children:r.title},`commission-target-${r.id}`))})]})}),g&&t.jsx(xl,{card:g,listTitle:mi(g),profile:u,onClose:()=>p(null),setSelectedCard:p,fetchBoard:ce}),Qe&&t.jsx("div",{className:"fixed inset-0 z-[70] bg-black/50 flex items-center justify-center p-4",children:t.jsxs("div",{className:"w-full max-w-3xl bg-white rounded-2xl shadow-2xl border border-gray-200 overflow-hidden",children:[t.jsxs("div",{className:"flex items-center justify-between px-5 py-4 border-b bg-gray-50",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"Archived Cards"}),t.jsx("button",{onClick:()=>Ft(!1),className:"h-8 w-8 rounded-lg border border-gray-200 bg-white text-gray-600 hover:bg-gray-100 flex items-center justify-center",children:t.jsx(Tt,{size:16})})]}),t.jsx("div",{className:"max-h-[60vh] overflow-y-auto p-4",children:tt?t.jsx("div",{className:"py-10 text-center text-sm text-gray-500",children:"Loading archived cards..."}):zt.length===0?t.jsx("div",{className:"py-10 text-center text-sm text-gray-500",children:"No archived cards found."}):t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"rounded-xl border border-gray-200 bg-gray-50 p-3 space-y-3",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("p",{className:"text-sm font-semibold text-gray-800",children:"Card Filters"}),t.jsx("button",{type:"button",onClick:()=>{Bt(""),Ne([]),Ue([]),je([]),Xe(""),Ke("all"),pe(null)},className:"text-xs text-indigo-600 hover:text-indigo-800 font-medium",children:"Reset"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Search"}),t.jsx("input",{value:St,onChange:r=>Bt(r.target.value),placeholder:"Type to filter cards, use * for all cards",className:"h-9 w-full rounded-md border border-gray-300 px-2.5 text-sm text-gray-800 focus:outline-none focus:ring-2 focus:ring-indigo-300"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Member"}),t.jsxs("select",{value:de,onChange:r=>Xe(r.target.value?Number(r.target.value):""),className:"h-9 w-full rounded-md border border-gray-300 px-2.5 text-sm text-gray-800 focus:outline-none focus:ring-2 focus:ring-indigo-300",children:[t.jsx("option",{value:"",children:"Select"}),mn.map(r=>t.jsxs("option",{value:r.id,children:[r.name," (",r.roleName,")"]},`archived-member-filter-option-${r.id}`))]})]}),t.jsxs("div",{className:"grid gap-3 lg:grid-cols-4",children:[t.jsxs("div",{children:[t.jsxs("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:["Country (",te.length,")"]}),t.jsxs("div",{className:"relative",children:[t.jsxs("button",{type:"button",onClick:()=>pe(r=>r==="country"?null:"country"),className:"h-9 w-full rounded-md border border-gray-300 px-2.5 text-sm focus:outline-none focus:ring-2 focus:ring-indigo-300 bg-white text-gray-800 flex items-center justify-between",children:[t.jsx("span",{className:"truncate text-left",children:ye(te,$t,"Select")}),t.jsx(on,{size:15,className:`text-gray-500 transition-transform ${Ce==="country"?"rotate-180":""}`})]}),Ce==="country"&&t.jsx("div",{className:"absolute left-0 right-0 top-full mt-1 max-h-40 overflow-y-auto rounded-md border border-gray-300 bg-white shadow-lg z-50",children:$t.length===0?t.jsx("div",{className:"px-2.5 py-2 text-xs text-gray-500",children:"No options"}):$t.map(r=>t.jsxs("label",{className:"flex items-center gap-2 px-2.5 py-1.5 text-sm text-gray-800 hover:bg-gray-50 cursor-pointer",children:[t.jsx("input",{type:"checkbox",checked:te.includes(r.id),onChange:()=>J(r.id,Ne),className:"h-3.5 w-3.5 rounded text-indigo-600"}),t.jsx("span",{children:r.name})]},`archived-country-filter-${r.id}`))})]})]}),t.jsxs("div",{children:[t.jsxs("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:["Intake (",le.length,")"]}),t.jsxs("div",{className:"relative",children:[t.jsxs("button",{type:"button",onClick:()=>pe(r=>r==="intake"?null:"intake"),className:"h-9 w-full rounded-md border border-gray-300 px-2.5 text-sm focus:outline-none focus:ring-2 focus:ring-indigo-300 bg-white text-gray-800 flex items-center justify-between",children:[t.jsx("span",{className:"truncate text-left",children:ye(le,Pt,"Select")}),t.jsx(on,{size:15,className:`text-gray-500 transition-transform ${Ce==="intake"?"rotate-180":""}`})]}),Ce==="intake"&&t.jsx("div",{className:"absolute left-0 right-0 top-full mt-1 max-h-40 overflow-y-auto rounded-md border border-gray-300 bg-white shadow-lg z-50",children:Pt.length===0?t.jsx("div",{className:"px-2.5 py-2 text-xs text-gray-500",children:"No options"}):Pt.map(r=>t.jsxs("label",{className:"flex items-center gap-2 px-2.5 py-1.5 text-sm text-gray-800 hover:bg-gray-50 cursor-pointer",children:[t.jsx("input",{type:"checkbox",checked:le.includes(r.id),onChange:()=>J(r.id,Ue),className:"h-3.5 w-3.5 rounded text-indigo-600"}),t.jsx("span",{children:r.name})]},`archived-intake-filter-${r.id}`))})]})]}),t.jsxs("div",{children:[t.jsxs("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:["Service (",he.length,")"]}),t.jsxs("div",{className:"relative",children:[t.jsxs("button",{type:"button",onClick:()=>pe(r=>r==="service"?null:"service"),className:"h-9 w-full rounded-md border border-gray-300 px-2.5 text-sm focus:outline-none focus:ring-2 focus:ring-indigo-300 bg-white text-gray-800 flex items-center justify-between",children:[t.jsx("span",{className:"truncate text-left",children:ye(he,Jt,"Select")}),t.jsx(on,{size:15,className:`text-gray-500 transition-transform ${Ce==="service"?"rotate-180":""}`})]}),Ce==="service"&&t.jsx("div",{className:"absolute left-0 right-0 top-full mt-1 max-h-40 overflow-y-auto rounded-md border border-gray-300 bg-white shadow-lg z-50",children:Jt.length===0?t.jsx("div",{className:"px-2.5 py-2 text-xs text-gray-500",children:"No options"}):Jt.map(r=>t.jsxs("label",{className:"flex items-center gap-2 px-2.5 py-1.5 text-sm text-gray-800 hover:bg-gray-50 cursor-pointer",children:[t.jsx("input",{type:"checkbox",checked:he.includes(r.id),onChange:()=>J(r.id,je),className:"h-3.5 w-3.5 rounded text-indigo-600"}),t.jsx("span",{children:r.name})]},`archived-service-filter-${r.id}`))})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Due Date"}),t.jsxs("select",{value:re,onChange:r=>Ke(r.target.value),className:"h-9 w-full rounded-md border border-gray-300 px-2.5 text-sm text-gray-800 focus:outline-none focus:ring-2 focus:ring-indigo-300",children:[t.jsx("option",{value:"all",children:"Select"}),t.jsx("option",{value:"this_week",children:"This Week"}),t.jsx("option",{value:"today",children:"Today"}),t.jsx("option",{value:"overdue",children:"Overdue"})]})]})]}),N&&t.jsxs("p",{className:"text-xs font-medium text-gray-600",children:[qn.length," ",qn.length===1?"card":"cards"," match current filters"]})]}),qn.length===0?t.jsx("div",{className:"py-8 text-center text-sm text-gray-500",children:"No archived cards match the current filter."}):qn.map(r=>{var x,m;const c=((x=r.boardList)==null?void 0:x.title)||((m=r.board_list)==null?void 0:m.title)||"Unknown List",h=`${r.invoice||`ID-${r.id}`} ${r.first_name||""} ${r.last_name||""}`.trim();return t.jsxs("div",{className:"flex items-center justify-between gap-4 rounded-xl border border-gray-200 bg-white p-4",children:[t.jsxs("div",{className:"min-w-0",children:[t.jsx("p",{className:"text-sm font-semibold text-gray-900 truncate",children:h}),t.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[c,"  Archived on ",Vt(r.updated_at)]})]}),t.jsxs("button",{type:"button",onClick:()=>void fi(r.id),disabled:ue===r.id,className:`inline-flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-sm font-medium border transition ${ue===r.id?"bg-gray-100 text-gray-400 border-gray-200 cursor-not-allowed":"bg-emerald-50 text-emerald-700 border-emerald-200 hover:bg-emerald-100"}`,children:[t.jsx(xa,{size:14}),ue===r.id?"Restoring...":"Restore"]})]},r.id)})]})}),t.jsx("div",{className:"px-5 py-4 border-t bg-gray-50 flex justify-end",children:t.jsx("button",{onClick:()=>Ft(!1),className:"px-4 py-2 rounded-lg bg-indigo-600 text-white text-sm font-medium hover:bg-indigo-700",children:"Close"})})]})}),Ze&&t.jsx("div",{className:"fixed inset-0 z-[72] bg-black/50 flex items-center justify-center p-4",children:t.jsxs("div",{className:"w-full max-w-5xl bg-white rounded-2xl shadow-2xl border border-gray-200 overflow-hidden",children:[t.jsxs("div",{className:"flex items-center justify-between px-5 py-4 border-b bg-gray-50",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(dr,{size:18,className:"text-indigo-600"}),t.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Board Activity"})]}),t.jsx("button",{type:"button",onClick:()=>At(!1),className:"h-8 w-8 rounded-lg border border-gray-200 bg-white text-gray-600 hover:bg-gray-100 flex items-center justify-center",children:t.jsx(Tt,{size:16})})]}),t.jsx("div",{className:"px-5 pt-4 pb-3 border-b bg-white",children:t.jsxs("div",{className:"inline-flex rounded-lg border border-gray-200 bg-gray-50 p-1",children:[t.jsx("button",{type:"button",onClick:()=>We("all"),className:`px-3 py-1.5 rounded-md text-sm font-medium transition ${Le==="all"?"bg-white text-gray-900 shadow-sm border border-gray-200":"text-gray-600 hover:text-gray-800"}`,children:"All"}),t.jsx("button",{type:"button",onClick:()=>We("comment"),className:`px-3 py-1.5 rounded-md text-sm font-medium transition ${Le==="comment"?"bg-white text-gray-900 shadow-sm border border-gray-200":"text-gray-600 hover:text-gray-800"}`,children:"Comment"})]})}),t.jsx("div",{className:"max-h-[65vh] overflow-y-auto px-5 py-4",children:Ht?t.jsx("div",{className:"py-12 text-center text-sm text-gray-500",children:"Loading activity..."}):Yt.length===0?t.jsxs("div",{className:"py-12 text-center text-sm text-gray-500",children:["No ",Le==="comment"?"comments":"activities"," found."]}):t.jsx("div",{className:"space-y-3",children:Yt.map(r=>{const c=vi(r.action,r.details),h=!!nr(r.details);return t.jsx("div",{className:"rounded-xl border border-gray-200 bg-white p-4",children:t.jsxs("div",{className:"flex gap-3",children:[t.jsx("div",{className:"h-8 w-8 rounded-full bg-indigo-100 text-indigo-700 text-xs font-semibold flex items-center justify-center shrink-0",children:(r.user_name||"U").charAt(0).toUpperCase()}),t.jsxs("div",{className:"min-w-0 flex-1",children:[t.jsxs("div",{className:"text-sm text-gray-800",children:[t.jsx("strong",{className:"text-gray-900",children:r.user_name||"User"})," ",r.action]}),r.details?t.jsx("div",{className:`mt-1 text-sm leading-relaxed ${r.action==="commented"?"rounded-lg border border-gray-200 bg-gray-50 p-3 text-gray-700":c?"rounded-lg border border-indigo-100 bg-indigo-50/40 p-3 text-gray-700":h?"rounded-lg border border-emerald-100 bg-emerald-50/30 p-3 text-gray-700":"text-gray-700"}`,children:r.action==="commented"?t.jsxs("div",{className:"flex items-start gap-2",children:[t.jsx($r,{size:14,className:"mt-0.5 text-gray-500 shrink-0"}),t.jsx("div",{className:"min-w-0",children:Gn(r.details)})]}):c?wi(r.details):h?ji(r.details):Gn(r.details)}):null,t.jsxs("div",{className:"mt-2 flex flex-wrap items-center gap-2 text-xs text-gray-500",children:[t.jsx("span",{children:Us(r.created_at)}),r.card_id?t.jsx("span",{className:"px-2 py-0.5 rounded-full bg-indigo-50 text-indigo-700 border border-indigo-100",children:gi(r)}):null,t.jsx("span",{className:"px-2 py-0.5 rounded-full bg-gray-100 text-gray-700 border border-gray-200",children:xi(r)})]}),(r.attachment_path||r.attachment_url)&&t.jsxs("button",{type:"button",onClick:()=>void Ci(r),disabled:Et===r.id,className:`mt-2 inline-flex items-center gap-1 rounded-md border px-2 py-1 text-xs transition ${Et===r.id?"bg-gray-100 text-gray-400 border-gray-200 cursor-not-allowed":"bg-white text-indigo-700 border-indigo-200 hover:bg-indigo-50"}`,children:[Et===r.id?"Opening...":r.attachment_name||"Attachment",r.attachment_size?t.jsxs("span",{className:"text-gray-500",children:["(",Xs(r.attachment_size),")"]}):null]})]})]})},r.id)})})})]})}),mt&&t.jsx("div",{className:"fixed inset-0 z-[70] bg-black/50 flex items-center justify-center p-4",children:t.jsxs("div",{className:"w-full max-w-md bg-white rounded-2xl shadow-2xl border border-gray-200 overflow-hidden",children:[t.jsxs("div",{className:"flex items-center justify-between px-5 py-4 border-b bg-rose-50",children:[t.jsx("h3",{className:"text-lg font-semibold text-rose-800",children:"Move Blocked"}),t.jsx("button",{onClick:()=>at(null),className:"h-8 w-8 rounded-lg border border-rose-200 bg-white text-rose-600 hover:bg-rose-100 flex items-center justify-center",children:t.jsx(Tt,{size:16})})]}),t.jsx("div",{className:"px-5 py-4 text-sm text-gray-700",children:mt}),t.jsx("div",{className:"px-5 py-4 border-t bg-gray-50 flex justify-end",children:t.jsx("button",{onClick:()=>at(null),className:"px-4 py-2 rounded-lg bg-indigo-600 text-white text-sm font-medium hover:bg-indigo-700",children:"OK"})})]})})]})]})}export{El as default};
