import{r as o,u as te,k as se,y as i,i as de,j as e,l as le,L as oe,d as f}from"./index-BkDEBjE8.js";import{P as ne}from"./plus-BGK2cbvf.js";import{S as H}from"./square-pen-C4tonUcb.js";import{T as A}from"./trash-2-CdA9fu54.js";import"./createLucideIcon-3adLFeee.js";function be(){const[D,b]=o.useState([]),[t,$]=o.useState(null),[J,F]=o.useState(!0),[L,K]=o.useState(""),[y,Q]=o.useState(25),[x,h]=o.useState(1),[R,E]=o.useState([]),[k,W]=o.useState(!1),[O,T]=o.useState(null),[X,j]=o.useState(!1),[v,Z]=o.useState("all"),[z,U]=o.useState("asc"),w=te(),p=se(),ee=(t==null?void 0:t.role_id)===1||(t==null?void 0:t.role_id)===2&&Number(t==null?void 0:t.can_create_users)===1;o.useEffect(()=>{var r;if((r=p.state)!=null&&r.message){const a=p.state.type||"success";i[a](p.state.message),w(p.pathname,{replace:!0,state:{}})}},[p,w]),o.useEffect(()=>{de().then(r=>$(r)).catch(()=>$(null))},[]);const N=async()=>{var r,a;try{F(!0);const d=await f.get("/users");b(d.data)}catch(d){i.error(((a=(r=d==null?void 0:d.response)==null?void 0:r.data)==null?void 0:a.message)||"Failed to fetch users")}finally{F(!1)}};o.useEffect(()=>{N()},[]);const _=(r,a)=>{b(d=>d.map(c=>c.id===r?{...c,...a}:c))},I=async r=>{var c,m,g,u;if((t==null?void 0:t.id)===r.id){i.error("You cannot change your own permissions!");return}const a=r.can_create_users,d=a===1?0:1;b(l=>l.map(s=>s.id===r.id?{...s,can_create_users:d}:s));try{const s=(await f.patch(`/users/${r.id}/toggle-permission`)).data??{};s.user||s.id?_(r.id,s.user??s):s.hasOwnProperty("can_create_users")?_(r.id,{can_create_users:s.can_create_users}):N();const n=s.can_create_users??((c=s.user)==null?void 0:c.can_create_users);i.success(`Permission: ${n===1?"Active":"Inactive"}`)}catch(l){b(s=>s.map(n=>n.id===r.id?{...n,can_create_users:a}:n)),i.error(((g=(m=l==null?void 0:l.response)==null?void 0:m.data)==null?void 0:g.message)||"Failed to update permission"),((u=l==null?void 0:l.response)==null?void 0:u.status)===403&&i.warn("You don't have permission to do this.")}},M=async r=>{var c,m,g,u;if((t==null?void 0:t.id)===r.id){i.error("You cannot change your own panel permission!");return}if((t==null?void 0:t.role_id)!==1){i.warn("Only super administrators can modify panel permission.");return}const a=r.panel_permission??0,d=a===1?0:1;b(l=>l.map(s=>s.id===r.id?{...s,panel_permission:d}:s));try{const s=(await f.patch(`/users/${r.id}/toggle-permission`,{field:"panel_permission"})).data??{};let n;s.panel_permission!==void 0?n=s.panel_permission:((c=s.user)==null?void 0:c.panel_permission)!==void 0?(n=s.user.panel_permission,_(r.id,s.user)):n=d,i.success(`Panel Permission: ${n===1?"Allowed":"Blocked"}`)}catch(l){b(s=>s.map(n=>n.id===r.id?{...n,panel_permission:a}:n)),i.error(((g=(m=l==null?void 0:l.response)==null?void 0:m.data)==null?void 0:g.message)||"Failed to update panel permission"),((u=l==null?void 0:l.response)==null?void 0:u.status)===403&&i.warn("You don't have permission to change this setting.")}},B=r=>{if((t==null?void 0:t.id)===r){i.error("You cannot delete yourself!");return}T(r),j(!0)},re=async()=>{var r,a;if(O)try{await f.delete(`/users/${O}`),i.success("User deleted successfully"),N()}catch(d){i.error(((a=(r=d==null?void 0:d.response)==null?void 0:r.data)==null?void 0:a.message)||"Error deleting user")}finally{j(!1),T(null)}},Y=r=>{w(`/dashboard/admin-users/${r.id}/edit`)},ae=()=>{W(!k),E(k?[]:D.map(r=>r.id))},V=r=>{E(a=>a.includes(r)?a.filter(d=>d!==r):[...a,r])},q=r=>r?new Date(r).toISOString().split("T")[0]:"-",G=D.filter(r=>{var g;const a=L.trim().toLowerCase();if(!a)return!0;const d=`${r.first_name} ${r.last_name}`.toLowerCase(),c=r.email.toLowerCase(),m=((g=r.role)==null?void 0:g.name.toLowerCase())||"";return d.includes(a)||c.includes(a)||m.includes(a)}).filter(r=>v==="all"?!0:Number(r.role_id)===Number(v)).sort((r,a)=>!r.created_at||!a.created_at?0:z==="asc"?new Date(r.created_at).getTime()-new Date(a.created_at).getTime():new Date(a.created_at).getTime()-new Date(r.created_at).getTime()),C=G.length,S=Math.ceil(C/y),P=G.slice((x-1)*y,x*y);return e.jsxs("div",{className:"p-5 border border-gray-200 rounded-2xl dark:border-gray-700 lg:p-6 dark:bg-gray-900 bg-white relative w-full max-w-[900px] mx-auto",children:[e.jsx(le,{position:"top-right",autoClose:3e3,hideProgressBar:!0,theme:"colored"}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-center mb-5 gap-3",children:[e.jsx("h1",{className:"text-lg sm:text-2xl font-bold text-gray-900 dark:text-gray-100 text-center sm:text-left",children:"Admin User List"}),ee?e.jsxs(oe,{to:"/dashboard/admin-users/add",className:"flex items-center gap-2 px-5 py-3 rounded-lg bg-blue-600 text-white text-base font-medium shadow-sm hover:bg-blue-700 transition-all",children:[e.jsx(ne,{size:20})," Add User"]}):null]}),e.jsxs("div",{className:"flex flex-col md:flex-row justify-between mb-4 gap-3 items-center",children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-700 dark:text-gray-300 text-base",children:[e.jsx("span",{children:"Show"}),e.jsxs("select",{value:y,onChange:r=>{Q(Number(r.target.value)),h(1)},className:"border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 px-7 py-2 rounded-lg text-base focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:5,children:"5"}),e.jsx("option",{value:10,children:"10"}),e.jsx("option",{value:25,children:"25"}),e.jsx("option",{value:50,children:"50"})]}),e.jsx("span",{children:"entries"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 w-full md:w-auto",children:[e.jsx("input",{type:"text",placeholder:"Search by name, email, role...",value:L,onChange:r=>{K(r.target.value),h(1)},className:"border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 px-7 py-2 rounded-lg text-base placeholder-gray-500 dark:placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 w-full"}),e.jsxs("select",{value:v,onChange:r=>Z(r.target.value),className:"border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 px-8 py-2 rounded-lg text-base focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"all",children:"All Roles"}),e.jsx("option",{value:"2",children:"Role 2"}),e.jsx("option",{value:"3",children:"Role 3"}),e.jsx("option",{value:"4",children:"Role 4"})]}),e.jsxs("select",{value:z,onChange:r=>U(r.target.value),className:"border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 px-6 py-2 rounded-lg text-base focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"asc",children:"Oldest First"}),e.jsx("option",{value:"desc",children:"Newest First"})]})]})]}),e.jsx("div",{className:"hidden md:block overflow-x-auto rounded-xl border border-gray-200 dark:border-gray-700",children:e.jsxs("table",{className:"min-w-full table-auto text-base bg-white dark:bg-gray-900",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-center",children:e.jsx("input",{type:"checkbox",checked:k,onChange:ae,className:"w-5 h-5 rounded border-gray-300 dark:border-gray-600 text-blue-600 focus:ring-blue-500"})}),e.jsx("th",{className:"px-5 py-3 text-left font-medium text-gray-700 dark:text-gray-300 border-r border-gray-200 dark:border-gray-700",children:"User"}),e.jsx("th",{className:"px-5 py-3 text-left font-medium text-gray-700 dark:text-gray-300 border-r border-gray-200 dark:border-gray-700",children:"Role"}),(t==null?void 0:t.role_id)===1&&e.jsxs(e.Fragment,{children:[e.jsx("th",{className:"px-5 py-3 text-left font-medium text-gray-700 dark:text-gray-300 border-r border-gray-200 dark:border-gray-700",children:"AddUser"}),e.jsx("th",{className:"px-5 py-3 text-left font-medium text-gray-700 dark:text-gray-300 border-r border-gray-200 dark:border-gray-700",children:"Panel Permission"})]}),e.jsx("th",{className:"px-5 py-3 text-left font-medium text-gray-700 dark:text-gray-300 border-r border-gray-200 dark:border-gray-700",children:"Created"}),e.jsx("th",{className:"px-5 py-3 text-left font-medium text-gray-700 dark:text-gray-300 border-r border-gray-200 dark:border-gray-700",children:"Updated"}),e.jsx("th",{className:"px-5 py-3 text-left font-medium text-gray-700 dark:text-gray-300",children:"Action"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:J?e.jsx("tr",{children:e.jsx("td",{colSpan:10,className:"text-center py-12 text-gray-500 dark:text-gray-400",children:"Loading..."})}):P.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:10,className:"text-center py-12 text-gray-500 dark:text-gray-400",children:"No users found"})}):P.map(r=>{var a;return e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-800 transition",children:[e.jsx("td",{className:"text-center py-3",children:e.jsx("input",{type:"checkbox",checked:R.includes(r.id),onChange:()=>V(r.id),className:"w-5 h-5 rounded border-gray-300 dark:border-gray-600 text-blue-600 focus:ring-blue-500"})}),e.jsxs("td",{className:"px-4 py-3 border-r border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"font-semibold text-gray-900 dark:text-gray-100",children:[r.first_name," ",r.last_name]}),e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400 truncate max-w-xs",children:r.email})]}),e.jsx("td",{className:"px-4 py-3 border-r border-gray-200 dark:border-gray-700 text-gray-800 dark:text-gray-200",children:((a=r.role)==null?void 0:a.name)||"-"}),(t==null?void 0:t.role_id)===1&&e.jsxs(e.Fragment,{children:[e.jsx("td",{className:"px-4 py-3 border-r border-gray-200 dark:border-gray-700",children:e.jsx("button",{onClick:()=>I(r),className:`px-3 py-1.5 rounded text-white text-sm font-medium transition ${r.can_create_users===1?"bg-green-600 hover:bg-green-700":"bg-red-600 hover:bg-red-700"}`,children:r.can_create_users===1?"Active":"Inactive"})}),e.jsx("td",{className:"px-4 py-3 border-r border-gray-200 dark:border-gray-700",children:e.jsx("button",{onClick:()=>M(r),className:`px-3 py-1.5 rounded text-white text-sm font-medium transition ${r.panel_permission===1?"bg-emerald-600 hover:bg-emerald-700":"bg-rose-600 hover:bg-rose-700"}`,children:r.panel_permission===1?"Allowed":"Blocked"})})]}),e.jsx("td",{className:"px-4 py-3 border-r border-gray-200 dark:border-gray-700 text-gray-700 dark:text-gray-300",children:q(r.created_at)}),e.jsx("td",{className:"px-4 py-3 border-r border-gray-200 dark:border-gray-700 text-gray-700 dark:text-gray-300",children:q(r.updated_at)}),e.jsxs("td",{className:"px-4 py-3 flex gap-2",children:[e.jsx("button",{onClick:()=>Y(r),className:"p-2 bg-yellow-100 dark:bg-yellow-900/30 text-yellow-700 dark:text-yellow-400 rounded hover:bg-yellow-200 dark:hover:bg-yellow-900/50 transition","aria-label":"Edit user",children:e.jsx(H,{size:16})}),e.jsx("button",{onClick:()=>B(r.id),className:"p-2 bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-400 rounded hover:bg-red-200 dark:hover:bg-red-900/50 transition","aria-label":"Delete user",children:e.jsx(A,{size:16})})]})]},r.id)})})]})}),e.jsx("div",{className:"md:hidden space-y-4",children:P.map(r=>{var a;return e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg p-4 bg-white dark:bg-gray-800 shadow-sm",children:[e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("input",{type:"checkbox",checked:R.includes(r.id),onChange:()=>V(r.id),className:"mt-1 w-5 h-5 rounded border-gray-300 dark:border-gray-600 text-blue-600 focus:ring-blue-500"}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-bold text-gray-900 dark:text-gray-100",children:[r.first_name," ",r.last_name]}),e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:r.email}),e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:["Role: ",((a=r.role)==null?void 0:a.name)||"-"]})]})]})}),e.jsx("div",{className:"mt-3 grid grid-cols-2 gap-3 text-sm",children:(t==null?void 0:t.role_id)===1&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Permission:"}),e.jsx("button",{onClick:()=>I(r),className:`ml-2 px-2 py-1 rounded text-white text-xs font-medium ${r.can_create_users===1?"bg-green-600":"bg-red-600"}`,children:r.can_create_users===1?"Active":"Inactive"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Panel Perm:"}),e.jsx("button",{onClick:()=>M(r),className:`ml-2 px-2 py-1 rounded text-white text-xs font-medium ${r.panel_permission===1?"bg-emerald-600":"bg-rose-600"}`,children:r.panel_permission===1?"Allowed":"Blocked"})]})]})}),e.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[e.jsx("button",{onClick:()=>Y(r),className:"p-2 bg-yellow-100 dark:bg-yellow-900/30 text-yellow-700 dark:text-yellow-400 rounded hover:bg-yellow-200 dark:hover:bg-yellow-900/50 transition",children:e.jsx(H,{size:16})}),e.jsx("button",{onClick:()=>B(r.id),className:"p-2 bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-400 rounded hover:bg-red-200 dark:hover:bg-red-900/50 transition",children:e.jsx(A,{size:16})})]})]},r.id)})}),e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center mt-6 text-sm text-gray-700 dark:text-gray-300",children:[e.jsxs("div",{children:["Showing ",(x-1)*y+1," to"," ",Math.min(x*y,C)," of ",C," entries"]}),e.jsxs("div",{className:"flex gap-1 mt-3 md:mt-0",children:[e.jsx("button",{onClick:()=>h(r=>Math.max(1,r-1)),disabled:x===1,className:"px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700 transition",children:"Previous"}),[...Array(S)].map((r,a)=>e.jsx("button",{onClick:()=>h(a+1),className:`px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg transition ${x===a+1?"bg-blue-600 text-white border-blue-600":"bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700"}`,children:a+1},a+1)),e.jsx("button",{onClick:()=>h(r=>Math.min(S,r+1)),disabled:x===S,className:"px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700 transition",children:"Next"})]})]}),X&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl p-6 max-w-sm w-full shadow-2xl border border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mx-auto w-12 h-12 bg-red-100 dark:bg-red-900/30 rounded-full flex items-center justify-center mb-4",children:e.jsx(A,{className:"text-red-600 dark:text-red-400",size:28})}),e.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-gray-100 mb-2",children:"Delete User?"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"This action cannot be undone."})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{onClick:()=>j(!1),className:"flex-1 py-2 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition",children:"Cancel"}),e.jsx("button",{onClick:re,className:"flex-1 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition",children:"Delete"})]})]})})]})}export{be as default};
