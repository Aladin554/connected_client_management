import{r as n,u as te,k as se,y as c,i as de,j as e,l as le,L as oe,d as j}from"./index-dlF-v8Wy.js";import{P as ne}from"./plus-CdWAnueV.js";import{S as H}from"./square-pen-DnY1KpRk.js";import{T as D}from"./trash-2-BN5D3y6L.js";import"./createLucideIcon-Ck__ep5g.js";const k=o=>({...o,role_id:Number((o==null?void 0:o.role_id)??0),can_create_users:Number((o==null?void 0:o.can_create_users)??0),panel_permission:Number((o==null?void 0:o.panel_permission)??(o==null?void 0:o.permission)??0)});function be(){const[o,h]=n.useState([]),[t,F]=n.useState(null),[J,L]=n.useState(!0),[R,K]=n.useState(""),[y,Q]=n.useState(25),[b,p]=n.useState(1),[z,E]=n.useState([]),[N,W]=n.useState(!1),[M,O]=n.useState(null),[X,v]=n.useState(!1),[w,Z]=n.useState("all"),[T,U]=n.useState("asc"),_=te(),u=se(),ee=(t==null?void 0:t.role_id)===1||(t==null?void 0:t.role_id)===2&&Number(t==null?void 0:t.can_create_users)===1;n.useEffect(()=>{var r;if((r=u.state)!=null&&r.message){const a=u.state.type||"success";c[a](u.state.message),_(u.pathname,{replace:!0,state:{}})}},[u,_]),n.useEffect(()=>{de({force:!0}).then(r=>F(r)).catch(()=>F(null))},[]);const C=async()=>{var r,a;try{L(!0);const d=await j.get("/users"),g=Array.isArray(d.data)?d.data:[];h(g.map(x=>k(x)))}catch(d){c.error(((a=(r=d==null?void 0:d.response)==null?void 0:r.data)==null?void 0:a.message)||"Failed to fetch users")}finally{L(!1)}};n.useEffect(()=>{C()},[]);const S=(r,a)=>{h(d=>d.map(g=>g.id===r?k({...g,...a}):g))},I=async r=>{var g,x,m,f;if((t==null?void 0:t.id)===r.id){c.error("You cannot change your own permissions!");return}const a=Number(r.can_create_users??0),d=a===1?0:1;h(l=>l.map(s=>s.id===r.id?{...s,can_create_users:d}:s));try{const s=(await j.patch(`/users/${r.id}/toggle-permission`)).data??{};s.user||s.id?S(r.id,k(s.user??s)):s.hasOwnProperty("can_create_users")?S(r.id,{can_create_users:Number(s.can_create_users)}):C();const i=Number(s.can_create_users??((g=s.user)==null?void 0:g.can_create_users)??d);c.success(`Permission: ${i===1?"Active":"Inactive"}`)}catch(l){h(s=>s.map(i=>i.id===r.id?{...i,can_create_users:a}:i)),c.error(((m=(x=l==null?void 0:l.response)==null?void 0:x.data)==null?void 0:m.message)||"Failed to update permission"),((f=l==null?void 0:l.response)==null?void 0:f.status)===403&&c.warn("You don't have permission to do this.")}},B=async r=>{var g,x,m,f;if((t==null?void 0:t.id)===r.id){c.error("You cannot change your own panel permission!");return}if((t==null?void 0:t.role_id)!==1){c.warn("Only super administrators can modify panel permission.");return}const a=Number(r.panel_permission??0),d=a===1?0:1;h(l=>l.map(s=>s.id===r.id?{...s,panel_permission:d}:s));try{const s=(await j.patch(`/users/${r.id}/toggle-permission`,{field:"panel_permission"})).data??{};let i;s.panel_permission!==void 0?i=Number(s.panel_permission):((g=s.user)==null?void 0:g.panel_permission)!==void 0?(i=Number(s.user.panel_permission),S(r.id,k(s.user))):i=d,c.success(`Panel Permission: ${i===1?"Allowed":"Blocked"}`)}catch(l){h(s=>s.map(i=>i.id===r.id?{...i,panel_permission:a}:i)),c.error(((m=(x=l==null?void 0:l.response)==null?void 0:x.data)==null?void 0:m.message)||"Failed to update panel permission"),((f=l==null?void 0:l.response)==null?void 0:f.status)===403&&c.warn("You don't have permission to change this setting.")}},Y=r=>{if((t==null?void 0:t.id)===r){c.error("You cannot delete yourself!");return}O(r),v(!0)},re=async()=>{var r,a;if(M)try{await j.delete(`/users/${M}`),c.success("User deleted successfully"),C()}catch(d){c.error(((a=(r=d==null?void 0:d.response)==null?void 0:r.data)==null?void 0:a.message)||"Error deleting user")}finally{v(!1),O(null)}},V=r=>{_(`/dashboard/admin-users/${r.id}/edit`)},ae=()=>{W(!N),E(N?[]:o.map(r=>r.id))},q=r=>{E(a=>a.includes(r)?a.filter(d=>d!==r):[...a,r])},G=o.filter(r=>{var m;const a=R.trim().toLowerCase();if(!a)return!0;const d=`${r.first_name} ${r.last_name}`.toLowerCase(),g=r.email.toLowerCase(),x=((m=r.role)==null?void 0:m.name.toLowerCase())||"";return d.includes(a)||g.includes(a)||x.includes(a)}).filter(r=>w==="all"?!0:Number(r.role_id)===Number(w)).sort((r,a)=>!r.created_at||!a.created_at?0:T==="asc"?new Date(r.created_at).getTime()-new Date(a.created_at).getTime():new Date(a.created_at).getTime()-new Date(r.created_at).getTime()),P=G.length,A=Math.ceil(P/y),$=G.slice((b-1)*y,b*y);return e.jsxs("div",{className:"p-5 border border-gray-200 rounded-2xl dark:border-gray-700 lg:p-6 dark:bg-gray-900 bg-white relative w-full max-w-[900px] mx-auto",children:[e.jsx(le,{position:"top-right",autoClose:3e3,hideProgressBar:!0,theme:"colored"}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-center mb-5 gap-3",children:[e.jsx("h1",{className:"text-lg sm:text-2xl font-bold text-gray-900 dark:text-gray-100 text-center sm:text-left",children:"Admin User List"}),ee?e.jsxs(oe,{to:"/dashboard/admin-users/add",className:"flex items-center gap-2 px-5 py-3 rounded-lg bg-blue-600 text-white text-base font-medium shadow-sm hover:bg-blue-700 transition-all",children:[e.jsx(ne,{size:20})," Add User"]}):null]}),e.jsxs("div",{className:"flex flex-col md:flex-row justify-between mb-4 gap-3 items-center",children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-700 dark:text-gray-300 text-base",children:[e.jsx("span",{children:"Show"}),e.jsxs("select",{value:y,onChange:r=>{Q(Number(r.target.value)),p(1)},className:"border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 px-7 py-2 rounded-lg text-base focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:5,children:"5"}),e.jsx("option",{value:10,children:"10"}),e.jsx("option",{value:25,children:"25"}),e.jsx("option",{value:50,children:"50"})]}),e.jsx("span",{children:"entries"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 w-full md:w-auto",children:[e.jsx("input",{type:"text",placeholder:"Search by name, email, role...",value:R,onChange:r=>{K(r.target.value),p(1)},className:"border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 px-7 py-2 rounded-lg text-base placeholder-gray-500 dark:placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 w-full"}),e.jsxs("select",{value:w,onChange:r=>Z(r.target.value),className:"border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 px-8 py-2 rounded-lg text-base focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"all",children:"All Roles"}),e.jsx("option",{value:"2",children:"Role 2"}),e.jsx("option",{value:"3",children:"Role 3"}),e.jsx("option",{value:"4",children:"Role 4"})]}),e.jsxs("select",{value:T,onChange:r=>U(r.target.value),className:"border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 px-6 py-2 rounded-lg text-base focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"asc",children:"Oldest First"}),e.jsx("option",{value:"desc",children:"Newest First"})]})]})]}),e.jsx("div",{className:"hidden md:block overflow-x-auto rounded-xl border border-gray-200 dark:border-gray-700",children:e.jsxs("table",{className:"min-w-full table-auto text-base bg-white dark:bg-gray-900",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-center",children:e.jsx("input",{type:"checkbox",checked:N,onChange:ae,className:"w-5 h-5 rounded border-gray-300 dark:border-gray-600 text-blue-600 focus:ring-blue-500"})}),e.jsx("th",{className:"px-5 py-3 text-left font-medium text-gray-700 dark:text-gray-300 border-r border-gray-200 dark:border-gray-700",children:"User"}),e.jsx("th",{className:"px-5 py-3 text-left font-medium text-gray-700 dark:text-gray-300 border-r border-gray-200 dark:border-gray-700",children:"Role"}),(t==null?void 0:t.role_id)===1&&e.jsxs(e.Fragment,{children:[e.jsx("th",{className:"px-5 py-3 text-left font-medium text-gray-700 dark:text-gray-300 border-r border-gray-200 dark:border-gray-700",children:"AddUser"}),e.jsx("th",{className:"px-5 py-3 text-left font-medium text-gray-700 dark:text-gray-300 border-r border-gray-200 dark:border-gray-700",children:"Panel Permission"})]}),e.jsx("th",{className:"px-5 py-3 text-left font-medium text-gray-700 dark:text-gray-300",children:"Action"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:J?e.jsx("tr",{children:e.jsx("td",{colSpan:(t==null?void 0:t.role_id)===1?6:4,className:"text-center py-12 text-gray-500 dark:text-gray-400",children:"Loading..."})}):$.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:(t==null?void 0:t.role_id)===1?6:4,className:"text-center py-12 text-gray-500 dark:text-gray-400",children:"No users found"})}):$.map(r=>{var a;return e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-800 transition",children:[e.jsx("td",{className:"text-center py-3",children:e.jsx("input",{type:"checkbox",checked:z.includes(r.id),onChange:()=>q(r.id),className:"w-5 h-5 rounded border-gray-300 dark:border-gray-600 text-blue-600 focus:ring-blue-500"})}),e.jsxs("td",{className:"px-4 py-3 border-r border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"font-semibold text-gray-900 dark:text-gray-100",children:[r.first_name," ",r.last_name]}),e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400 truncate max-w-xs",children:r.email})]}),e.jsx("td",{className:"px-4 py-3 border-r border-gray-200 dark:border-gray-700 text-gray-800 dark:text-gray-200",children:((a=r.role)==null?void 0:a.name)||"-"}),(t==null?void 0:t.role_id)===1&&e.jsxs(e.Fragment,{children:[e.jsx("td",{className:"px-4 py-3 border-r border-gray-200 dark:border-gray-700",children:e.jsx("button",{onClick:()=>I(r),className:`px-3 py-1.5 rounded text-white text-sm font-medium transition ${Number(r.can_create_users)===1?"bg-green-600 hover:bg-green-700":"bg-red-600 hover:bg-red-700"}`,children:Number(r.can_create_users)===1?"Active":"Inactive"})}),e.jsx("td",{className:"px-4 py-3 border-r border-gray-200 dark:border-gray-700",children:e.jsx("button",{onClick:()=>B(r),className:`px-3 py-1.5 rounded text-white text-sm font-medium transition ${Number(r.panel_permission)===1?"bg-emerald-600 hover:bg-emerald-700":"bg-rose-600 hover:bg-rose-700"}`,children:Number(r.panel_permission)===1?"Allowed":"Blocked"})})]}),e.jsxs("td",{className:"px-4 py-3 flex gap-2",children:[e.jsx("button",{onClick:()=>V(r),className:"p-2 bg-yellow-100 dark:bg-yellow-900/30 text-yellow-700 dark:text-yellow-400 rounded hover:bg-yellow-200 dark:hover:bg-yellow-900/50 transition","aria-label":"Edit user",children:e.jsx(H,{size:16})}),e.jsx("button",{onClick:()=>Y(r.id),className:"p-2 bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-400 rounded hover:bg-red-200 dark:hover:bg-red-900/50 transition","aria-label":"Delete user",children:e.jsx(D,{size:16})})]})]},r.id)})})]})}),e.jsx("div",{className:"md:hidden space-y-4",children:$.map(r=>{var a;return e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg p-4 bg-white dark:bg-gray-800 shadow-sm",children:[e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("input",{type:"checkbox",checked:z.includes(r.id),onChange:()=>q(r.id),className:"mt-1 w-5 h-5 rounded border-gray-300 dark:border-gray-600 text-blue-600 focus:ring-blue-500"}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-bold text-gray-900 dark:text-gray-100",children:[r.first_name," ",r.last_name]}),e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:r.email}),e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:["Role: ",((a=r.role)==null?void 0:a.name)||"-"]})]})]})}),e.jsx("div",{className:"mt-3 grid grid-cols-2 gap-3 text-sm",children:(t==null?void 0:t.role_id)===1&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Permission:"}),e.jsx("button",{onClick:()=>I(r),className:`ml-2 px-2 py-1 rounded text-white text-xs font-medium ${Number(r.can_create_users)===1?"bg-green-600":"bg-red-600"}`,children:Number(r.can_create_users)===1?"Active":"Inactive"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Panel Perm:"}),e.jsx("button",{onClick:()=>B(r),className:`ml-2 px-2 py-1 rounded text-white text-xs font-medium ${Number(r.panel_permission)===1?"bg-emerald-600":"bg-rose-600"}`,children:Number(r.panel_permission)===1?"Allowed":"Blocked"})]})]})}),e.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[e.jsx("button",{onClick:()=>V(r),className:"p-2 bg-yellow-100 dark:bg-yellow-900/30 text-yellow-700 dark:text-yellow-400 rounded hover:bg-yellow-200 dark:hover:bg-yellow-900/50 transition",children:e.jsx(H,{size:16})}),e.jsx("button",{onClick:()=>Y(r.id),className:"p-2 bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-400 rounded hover:bg-red-200 dark:hover:bg-red-900/50 transition",children:e.jsx(D,{size:16})})]})]},r.id)})}),e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center mt-6 text-sm text-gray-700 dark:text-gray-300",children:[e.jsxs("div",{children:["Showing ",(b-1)*y+1," to"," ",Math.min(b*y,P)," of ",P," entries"]}),e.jsxs("div",{className:"flex gap-1 mt-3 md:mt-0",children:[e.jsx("button",{onClick:()=>p(r=>Math.max(1,r-1)),disabled:b===1,className:"px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700 transition",children:"Previous"}),[...Array(A)].map((r,a)=>e.jsx("button",{onClick:()=>p(a+1),className:`px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg transition ${b===a+1?"bg-blue-600 text-white border-blue-600":"bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700"}`,children:a+1},a+1)),e.jsx("button",{onClick:()=>p(r=>Math.min(A,r+1)),disabled:b===A,className:"px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700 transition",children:"Next"})]})]}),X&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl p-6 max-w-sm w-full shadow-2xl border border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mx-auto w-12 h-12 bg-red-100 dark:bg-red-900/30 rounded-full flex items-center justify-center mb-4",children:e.jsx(D,{className:"text-red-600 dark:text-red-400",size:28})}),e.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-gray-100 mb-2",children:"Delete User?"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"This action cannot be undone."})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{onClick:()=>v(!1),className:"flex-1 py-2 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition",children:"Cancel"}),e.jsx("button",{onClick:re,className:"flex-1 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition",children:"Delete"})]})]})})]})}export{be as default};
