import{r as d,j as r,l as ge,d as g,y as c}from"./index-dlF-v8Wy.js";import{P as X}from"./plus-CdWAnueV.js";import{S as ue}from"./square-pen-DnY1KpRk.js";import{T as pe}from"./trash-2-BN5D3y6L.js";import{X as he}from"./x-B3DdBO1j.js";import"./createLucideIcon-Ck__ep5g.js";const ye=[{id:3,label:"Later Intake",chipClass:"bg-sky-100 text-sky-800 border-sky-300 dark:bg-sky-950/40 dark:text-sky-300 dark:border-sky-700"},{id:0,label:"Admission",chipClass:"bg-emerald-100 text-emerald-800 border-emerald-300 dark:bg-emerald-950/40 dark:text-emerald-300 dark:border-emerald-700"},{id:1,label:"Visa",chipClass:"bg-blue-100 text-blue-800 border-blue-300 dark:bg-blue-950/40 dark:text-blue-300 dark:border-blue-700"},{id:2,label:"Dependant Visa",chipClass:"bg-amber-100 text-amber-800 border-amber-300 dark:bg-amber-950/40 dark:text-amber-300 dark:border-amber-700"}],fe=i=>[0,1,2,3].includes(Number(i.category))?Number(i.category):0,_=i=>{const k=(i||"").toLowerCase();return k.includes("commission")||k.includes("comission")};function Se(){const[i,k]=d.useState([]),[h,Y]=d.useState([]),[H,J]=d.useState([]),[K,M]=d.useState(!0),[y,Q]=d.useState(""),[W,R]=d.useState([]),[x,D]=d.useState(""),[u,j]=d.useState([]),[N,v]=d.useState([]),[w,p]=d.useState([]),[Z,C]=d.useState(!1),[S,F]=d.useState(null),[B,A]=d.useState(""),[E,f]=d.useState([""]),[ee,$]=d.useState(!1),[O,I]=d.useState(null);d.useEffect(()=>{(async()=>{M(!0),await Promise.all([z(),T(),re()]),M(!1)})()},[]);const z=async()=>{try{const e=await g.get("/cities");k(e.data||[])}catch{c.error("Failed to load cities")}},T=async()=>{try{const s=(await g.get("/users")).data.map(t=>({...t,board_lists:t.board_lists||[]}));Y(s)}catch{c.error("Failed to load users")}},re=async()=>{try{const e=await g.get("/roles");J(e.data||[])}catch{c.error("Failed to load roles")}};d.useEffect(()=>{if(!y){R([]),D(""),L();return}const e=h.filter(s=>{var t;return((t=s.role)==null?void 0:t.id)===y});R(e),D(""),L()},[y,h]),d.useEffect(()=>{var s,t,a;if(!x){L();return}const e=h.find(n=>n.id===x);e&&(j(((s=e.cities)==null?void 0:s.map(n=>n.id))||[]),v(((t=e.boards)==null?void 0:t.map(n=>n.id))||[]),p(((a=e.board_lists)==null?void 0:a.map(n=>n.id))||[]))},[x,h]);const L=()=>{j([]),v([]),p([])};h.find(e=>e.id===x);const q=i.filter(e=>u.includes(e.id)),P=i.flatMap(e=>e.boards).filter(e=>!_(e.name)&&N.includes(e.id)),se=e=>{j(s=>{if(s.includes(e)){const t=i.find(o=>o.id===e);if(!t)return s;const a=t.boards.map(o=>o.id),n=t.boards.flatMap(o=>{var m;return((m=o.lists)==null?void 0:m.map(l=>l.id))||[]});return v(o=>o.filter(m=>!a.includes(m))),p(o=>o.filter(m=>!n.includes(m))),s.filter(o=>o!==e)}return[...s,e]})},te=e=>{v(s=>{var o,m;if(s.includes(e)){const l=i.flatMap(b=>b.boards).find(b=>b.id===e),U=((o=l==null?void 0:l.lists)==null?void 0:o.map(b=>b.id))||[];return p(b=>b.filter(be=>!U.includes(be))),s.filter(b=>b!==e)}const t=i.flatMap(l=>l.boards).find(l=>l.id===e),a=((m=t==null?void 0:t.lists)==null?void 0:m.map(l=>l.id))||[];a.length>0&&p(l=>[...new Set([...l,...a])]);const n=i.find(l=>l.boards.some(U=>U.id===e));return n&&!u.includes(n.id)&&j(l=>[...l,n.id]),[...s,e]})},ae=e=>{p(s=>s.includes(e)?s.filter(t=>t!==e):[...s,e])},de=async()=>{if(x)try{await Promise.all([g.patch(`/users/${x}/cities`,{cities:u}),g.patch(`/users/${x}/boards`,{boards:N}),g.patch(`/users/${x}/lists`,{lists:w})]),c.success("Permissions updated"),T()}catch{c.error("Failed to save permissions")}},le=()=>{F(null),A(""),f([""]),C(!0)},V=e=>{F(e),A(e.name),f(e.boards.map(s=>s.name)),C(!0)},ie=async()=>{var s,t;if(!B.trim()){c.error("City name is required");return}const e=E.filter(a=>a.trim()!=="");try{S?(await g.put(`/cities/${S.id}`,{name:B.trim(),boards:e}),c.success("City updated")):(await g.post("/cities",{name:B.trim(),boards:e}),c.success("City created")),C(!1),z()}catch(a){c.error(((t=(s=a.response)==null?void 0:s.data)==null?void 0:t.message)||"Failed to save city")}},ne=e=>{I(e),$(!0)},oe=async()=>{if(O)try{await g.delete(`/cities/${O}`),c.success("City deleted"),z()}catch{c.error("Failed to delete city")}finally{$(!1),I(null)}},ce=()=>{f(e=>[...e,""])},xe=e=>{f(s=>s.filter((t,a)=>a!==e))},me=(e,s)=>{f(t=>t.map((a,n)=>n===e?s:a))},G=e=>e?new Date(e).toLocaleDateString():"-";return K?r.jsx("div",{className:"p-10 text-center text-gray-500",children:"Loading cities & users..."}):r.jsxs("div",{className:"p-5 lg:p-6 bg-white dark:bg-gray-900 rounded-2xl border border-gray-200 dark:border-gray-700 max-w-[1260px] mx-auto",children:[r.jsx(ge,{position:"top-right",autoClose:3e3,theme:"colored"}),r.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-6",children:[r.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:"Cities & Access Control"}),r.jsxs("button",{onClick:le,className:"flex items-center gap-2 px-5 py-2.5 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition",children:[r.jsx(X,{size:18})," New City"]})]}),r.jsxs("div",{className:"mb-10 p-6 border rounded-2xl bg-gradient-to-b from-gray-50 to-white dark:from-gray-800/70 dark:to-gray-900 dark:border-gray-700 shadow-sm",children:[r.jsx("h2",{className:"text-lg font-semibold mb-5 text-gray-800 dark:text-gray-200",children:"Assign Permissions"}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-5 mb-6",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block mb-1.5 font-medium text-gray-700 dark:text-gray-300",children:"Role"}),r.jsxs("select",{value:y,onChange:e=>Q(Number(e.target.value)||""),className:"w-full px-4 py-2.5 border rounded-lg dark:bg-gray-800 dark:border-gray-700 dark:text-gray-200 focus:ring-2 focus:ring-blue-500",children:[r.jsx("option",{value:"",children:"- Select Role -"}),H.map(e=>r.jsx("option",{value:e.id,children:e.name},e.id))]})]}),y&&r.jsxs("div",{children:[r.jsx("label",{className:"block mb-1.5 font-medium text-gray-700 dark:text-gray-300",children:"User"}),r.jsxs("select",{value:x,onChange:e=>D(Number(e.target.value)||""),className:"w-full px-4 py-2.5 border rounded-lg dark:bg-gray-800 dark:border-gray-700 dark:text-gray-200 focus:ring-2 focus:ring-blue-500",children:[r.jsx("option",{value:"",children:"- Select User -"}),W.map(e=>r.jsxs("option",{value:e.id,children:[e.first_name," ",e.last_name," - ",e.email]},e.id))]})]})]}),x&&r.jsxs("div",{className:"space-y-6",children:[r.jsxs("section",{className:"rounded-xl border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-900 p-5",children:[r.jsxs("div",{className:"flex items-center justify-between mb-4",children:[r.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:"Cities"}),r.jsxs("span",{className:"text-xs px-2 py-1 rounded bg-blue-100 text-blue-800 dark:bg-blue-950/40 dark:text-blue-300",children:[u.length," selected"]})]}),r.jsx("div",{className:"flex flex-wrap gap-2 max-h-60 overflow-y-auto",children:i.map(e=>r.jsxs("label",{className:`inline-flex items-center gap-2 rounded-full border px-4 py-2 text-sm cursor-pointer transition ${u.includes(e.id)?"border-blue-400 bg-blue-50 text-blue-800 dark:border-blue-600 dark:bg-blue-950/40 dark:text-blue-200":"border-gray-200 bg-white text-gray-700 hover:bg-gray-50 dark:border-gray-700 dark:bg-gray-900 dark:text-gray-200"}`,children:[e.name,r.jsx("input",{type:"checkbox",checked:u.includes(e.id),onChange:()=>se(e.id),className:"h-4 w-4 rounded text-blue-600"})]},e.id))})]}),q.length>0&&r.jsxs("section",{className:"rounded-xl border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-900 p-5",children:[r.jsxs("div",{className:"flex items-center justify-between mb-4",children:[r.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:"Boards"}),r.jsxs("span",{className:"text-xs px-2 py-1 rounded bg-indigo-100 text-indigo-800 dark:bg-indigo-950/40 dark:text-indigo-300",children:[P.length," selected"]})]}),r.jsx("div",{className:"space-y-5",children:q.map(e=>r.jsxs("div",{children:[r.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-gray-500 dark:text-gray-400 mb-2",children:e.name}),r.jsx("div",{className:"flex flex-wrap gap-2",children:e.boards.filter(s=>!_(s.name)).map(s=>r.jsxs("label",{className:`inline-flex items-center gap-2 rounded-full border px-4 py-2 text-sm cursor-pointer transition ${N.includes(s.id)?"border-indigo-400 bg-indigo-50 text-indigo-800 dark:border-indigo-600 dark:bg-indigo-950/40 dark:text-indigo-200":"border-gray-200 bg-white text-gray-700 hover:bg-gray-50 dark:border-gray-700 dark:bg-gray-900 dark:text-gray-200"}`,children:[s.name,r.jsx("input",{type:"checkbox",checked:N.includes(s.id),onChange:()=>te(s.id),className:"h-4 w-4 rounded text-indigo-600"})]},s.id))})]},e.id))})]}),P.length>0&&r.jsx("div",{className:"space-y-5",children:P.map(e=>r.jsxs("section",{className:"rounded-xl border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-900 p-5",children:[r.jsxs("div",{className:"flex items-center justify-between mb-4",children:[r.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:e.name}),r.jsxs("span",{className:"text-xs px-2 py-1 rounded bg-purple-100 text-purple-800 dark:bg-purple-950/40 dark:text-purple-300",children:[(e.lists||[]).filter(s=>w.includes(s.id)).length," ","selected"]})]}),r.jsx("div",{className:"space-y-4",children:ye.map(s=>{const t=(e.lists||[]).filter(a=>fe(a)===s.id);return t.length?r.jsxs("div",{children:[r.jsx("span",{className:`inline-flex items-center px-2.5 py-1 rounded-md border text-[11px] font-semibold mb-2 ${s.chipClass}`,children:s.label}),r.jsx("div",{className:"flex flex-wrap gap-2",children:t.map(a=>r.jsxs("label",{className:`inline-flex items-center gap-2 rounded-full border px-4 py-2 text-sm cursor-pointer transition ${w.includes(a.id)?"border-purple-400 bg-purple-50 text-purple-800 dark:border-purple-600 dark:bg-purple-950/40 dark:text-purple-200":"border-gray-200 bg-white text-gray-700 hover:bg-gray-50 dark:border-gray-700 dark:bg-gray-900 dark:text-gray-200"}`,children:[a.title,r.jsx("input",{type:"checkbox",checked:w.includes(a.id),onChange:()=>ae(a.id),className:"h-4 w-4 rounded text-purple-600"})]},a.id))})]},s.id):null})})]},e.id))}),r.jsx("div",{className:"flex justify-end pt-2",children:r.jsx("button",{onClick:de,className:"px-7 py-2.5 bg-green-600 hover:bg-green-700 text-white rounded-lg font-medium shadow-sm transition",children:"Save Permissions"})})]})]}),r.jsx("div",{className:"overflow-x-auto rounded-xl border border-gray-200 dark:border-gray-700",children:r.jsxs("table",{className:"min-w-full bg-white dark:bg-gray-900",children:[r.jsx("thead",{className:"bg-gray-50 dark:bg-gray-800 border-b",children:r.jsxs("tr",{children:[r.jsx("th",{className:"px-6 py-4 text-left border-r",children:"City Name"}),r.jsx("th",{className:"px-6 py-4 text-left border-r",children:"Boards"}),r.jsx("th",{className:"px-6 py-4 text-left border-r",children:"Created"}),r.jsx("th",{className:"px-6 py-4 text-left border-r",children:"Updated"}),r.jsx("th",{className:"px-6 py-4 text-left",children:"Action"})]})}),r.jsx("tbody",{children:i.length===0?r.jsx("tr",{children:r.jsx("td",{colSpan:5,className:"px-6 py-10 text-center text-gray-500 dark:text-gray-400",children:"No cities found"})}):i.map(e=>r.jsxs("tr",{className:"border-t",children:[r.jsx("td",{className:"px-6 py-4 border-r",children:e.name}),r.jsx("td",{className:"px-6 py-4 border-r",children:e.boards.filter(s=>!_(s.name)).map(s=>s.name).join(", ")||"â€”"}),r.jsx("td",{className:"px-6 py-4 border-r",children:G(e.created_at)}),r.jsx("td",{className:"px-6 py-4 border-r",children:G(e.updated_at)}),r.jsxs("td",{className:"px-6 py-4 flex gap-2",children:[r.jsx("button",{onClick:()=>V(e),className:"p-2 bg-yellow-100 hover:bg-yellow-200 rounded dark:bg-yellow-900/40 dark:hover:bg-yellow-800/60",title:"Edit",children:r.jsx(ue,{size:16,className:"text-yellow-700 dark:text-yellow-400"})}),r.jsx("button",{onClick:()=>ne(e.id),className:"p-2 bg-red-100 hover:bg-red-200 rounded dark:bg-red-900/40 dark:hover:bg-red-800/60",title:"Delete",children:r.jsx(pe,{size:16,className:"text-red-700 dark:text-red-400"})})]})]},e.id))})]})}),Z&&r.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:r.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-6 w-[420px]",children:[r.jsx("h3",{className:"text-xl font-bold mb-4",children:S?"Edit City":"Add City"}),!S&&r.jsxs("select",{value:"new",onChange:e=>{if(e.target.value!=="new"){const s=i.find(t=>t.id===Number(e.target.value));s&&V(s)}},className:"w-full mb-4 px-4 py-2 border rounded dark:bg-gray-800 dark:border-gray-700 dark:text-gray-200",children:[r.jsx("option",{value:"new",children:"Create New City"}),i.map(e=>r.jsx("option",{value:e.id,children:e.name},e.id))]}),r.jsx("input",{value:B,onChange:e=>A(e.target.value),className:"w-full mb-4 px-4 py-2 border rounded dark:bg-gray-800 dark:border-gray-700 dark:text-gray-200",placeholder:"City name"}),r.jsxs("div",{className:"mb-4",children:[r.jsx("p",{className:"font-medium mb-2",children:"Boards"}),E.map((e,s)=>r.jsxs("div",{className:"flex gap-2 mb-2",children:[r.jsx("input",{value:e,onChange:t=>me(s,t.target.value),className:"flex-1 px-3 py-2 border rounded dark:bg-gray-800 dark:border-gray-700 dark:text-gray-200",placeholder:`Board ${s+1}`}),E.length>1&&r.jsx("button",{onClick:()=>xe(s),className:"p-2 bg-red-100 hover:bg-red-200 rounded dark:bg-red-900/40 dark:hover:bg-red-800/50",children:r.jsx(he,{size:14})})]},s)),r.jsxs("button",{onClick:ce,className:"text-sm text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300 mt-2 flex items-center gap-1",children:[r.jsx(X,{size:14})," Add Board"]})]}),r.jsxs("div",{className:"flex gap-3",children:[r.jsx("button",{onClick:()=>C(!1),className:"flex-1 border py-2 rounded hover:bg-gray-100 dark:hover:bg-gray-700 dark:border-gray-600",children:"Cancel"}),r.jsx("button",{onClick:ie,className:"flex-1 bg-blue-600 hover:bg-blue-700 text-white py-2 rounded font-medium",children:"Save"})]})]})}),ee&&r.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-50 p-4",children:r.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-6 w-full max-w-sm",children:[r.jsx("h3",{className:"text-lg font-bold mb-4",children:"Confirm Delete"}),r.jsxs("p",{className:"mb-6 text-gray-700 dark:text-gray-300",children:["Delete this city?",r.jsx("br",{}),r.jsx("span",{className:"text-red-600 font-medium",children:"All boards and lists will be permanently removed."})]}),r.jsxs("div",{className:"flex gap-3",children:[r.jsx("button",{onClick:()=>$(!1),className:"flex-1 py-2.5 border rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700",children:"Cancel"}),r.jsx("button",{onClick:oe,className:"flex-1 bg-red-600 hover:bg-red-700 text-white py-2.5 rounded-lg font-medium",children:"Delete"})]})]})})]})}export{Se as default};
