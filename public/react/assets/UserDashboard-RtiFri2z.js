import{u as C,r as a,j as e,L as S,d as k,i as L}from"./index-BVvtZPCr.js";import{L as E}from"./Loader-CnwL02bI.js";import{S as M}from"./search-DwhjARKh.js";import{C as I}from"./chevron-down-CekSx0RJ.js";import"./createLucideIcon-BB7Ogyrb.js";function A(s){return Array.isArray(s)?s:typeof s=="object"&&s!==null&&Array.isArray(s.data)?s.data:[]}function D(){const s=C(),[l,x]=a.useState([]),[n,p]=a.useState(null),[v,u]=a.useState(!0),[h,g]=a.useState(null),[f,j]=a.useState(""),[d,c]=a.useState(!1),m=a.useRef(null);a.useEffect(()=>{(async()=>{try{u(!0),g(null);const[r,o]=await Promise.all([k.get("/cities"),L()]);x(A(r.data)),p(o)}catch(r){console.error("Failed to load user dashboard",r),g("Could not load dashboard data. Please refresh the page.")}finally{u(!1)}})()},[]),a.useEffect(()=>{if(!d)return;const t=o=>{m.current&&(m.current.contains(o.target)||c(!1))},r=o=>{o.key==="Escape"&&c(!1)};return document.addEventListener("mousedown",t),window.addEventListener("keydown",r),()=>{document.removeEventListener("mousedown",t),window.removeEventListener("keydown",r)}},[d]);const i=f.trim().toLowerCase(),b=a.useMemo(()=>i?l.map(t=>{const o=t.name.toLowerCase().includes(i)?t.boards:t.boards.filter(N=>N.name.toLowerCase().includes(i));return{...t,boards:o}}).filter(t=>t.boards.length>0):l,[l,i]),y=()=>{c(!1),s("/profile")},w=()=>{c(!1),sessionStorage.removeItem("token"),sessionStorage.removeItem("role_id"),sessionStorage.removeItem("panel_permission"),sessionStorage.removeItem("user"),sessionStorage.removeItem("auth"),localStorage.removeItem("token"),localStorage.removeItem("user"),s("/signin")};return v?e.jsx(E,{message:"Loading dashboard..."}):e.jsxs("div",{className:"h-screen bg-gray-50/70 flex flex-col text-gray-800",children:[e.jsxs("header",{className:"h-14 bg-white/80 backdrop-blur-sm border-b flex items-center px-4 gap-4 z-10",children:[e.jsx("div",{className:"flex items-center gap-3",children:e.jsx("button",{type:"button",onClick:()=>s("/"),className:"h-7 flex items-center cursor-pointer",title:"Go to home",children:e.jsx("img",{src:"/images/logo/connected_logo.png",alt:"Connected Logo",className:"h-7 w-auto object-contain"})})}),e.jsx("div",{className:"flex-1 flex justify-center px-6",children:e.jsxs("div",{className:"relative w-full max-w-2xl",children:[e.jsx(M,{className:"absolute left-3.5 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{placeholder:"Search boards...",value:f,onChange:t=>j(t.target.value),className:"w-full pl-10 pr-4 py-2 bg-gray-100/70 border rounded-lg focus:bg-white focus:ring-2 focus:ring-blue-200 transition"})]})}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("div",{className:"relative",ref:m,children:[e.jsxs("button",{type:"button",onClick:()=>c(t=>!t),className:"h-8 px-3 rounded-full bg-gradient-to-r from-blue-600 to-indigo-600 text-white text-sm font-semibold flex items-center justify-center gap-1.5 shadow-sm hover:opacity-95",title:"Open user menu","aria-expanded":d,"aria-haspopup":"menu",children:[(n==null?void 0:n.first_name)||"User",e.jsx(I,{size:14,className:`transition-transform ${d?"rotate-180":""}`})]}),d&&e.jsxs("div",{className:"absolute right-0 mt-2 w-44 rounded-lg border border-gray-200 bg-white py-1.5 shadow-lg z-40",children:[e.jsx("button",{type:"button",onClick:y,className:"w-full px-3 py-2 text-left text-sm text-gray-700 hover:bg-gray-50",children:"Profile Settings"}),e.jsx("button",{type:"button",onClick:w,className:"w-full px-3 py-2 text-left text-sm text-red-600 hover:bg-red-50",children:"Logout"})]})]})})]}),e.jsx("div",{className:"flex flex-1 overflow-hidden",children:e.jsx("main",{className:"flex-1 px-6 md:px-12 py-10 overflow-y-auto",children:e.jsxs("div",{className:"flex flex-col gap-12 max-w-7xl mx-auto",children:[e.jsxs("section",{className:"rounded-2xl border border-gray-200 bg-white px-6 py-5 shadow-sm",children:[e.jsxs("h1",{className:"text-2xl font-extrabold text-gray-900",children:["Hi ",(n==null?void 0:n.first_name)||"User"]}),e.jsx("p",{className:"mt-1 text-sm text-gray-600",children:"Get started below with your designated workspace."})]}),h&&e.jsx("div",{className:"rounded-xl border border-rose-200 bg-rose-50 px-4 py-3 text-sm text-rose-700",children:h}),b.length===0?e.jsxs("div",{className:"text-center py-20 text-gray-600 bg-white rounded-2xl shadow-sm border",children:[e.jsx("p",{className:"text-xl font-semibold mb-3",children:i?"No matching boards found":"No cities available yet"}),e.jsx("p",{className:"text-gray-500",children:i?"Try another board or city name":"Contact your administrator or create your first city"})]}):b.map(t=>e.jsxs("section",{className:"space-y-5",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-green-500 to-teal-600 text-white rounded-lg flex items-center justify-center font-bold text-xl shadow-sm",children:t.name.charAt(0).toUpperCase()}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-800",children:t.name}),e.jsxs("p",{className:"text-sm text-gray-500",children:[t.boards.length," board",t.boards.length!==1?"s":""]})]})]})}),t.boards.length>0?e.jsx("div",{className:"grid gap-6",style:{gridTemplateColumns:"repeat(4, minmax(0, 1fr))"},children:t.boards.map(r=>e.jsx(S,{to:`/boards/${r.id}`,children:e.jsx(U,{title:r.name,backgroundGradient:r.background_gradient||null})},r.id))}):e.jsxs("div",{className:"text-center py-16 text-gray-500 bg-gray-50/70 rounded-2xl border border-dashed",children:["No boards created in this city yet",e.jsx("div",{className:"mt-3 text-sm",children:"Ask your admin to add boards"})]})]},t.id))]})})})]})}function U({title:s,backgroundGradient:l}){return e.jsxs("div",{className:"h-40 rounded-2xl overflow-hidden shadow border hover:shadow-lg transition-all duration-200 group bg-white",children:[e.jsx("div",{className:"h-24",style:{background:l||"linear-gradient(135deg, #667eea, #764ba2)"}}),e.jsx("div",{className:"p-4 font-medium text-gray-800 group-hover:text-blue-700 transition-colors",children:s})]})}export{D as default};
