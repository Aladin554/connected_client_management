import{m as C,u as E,r as d,j as e,l as F,d as u,y as l}from"./index-Cq981t_5.js";import{A as L}from"./arrow-left-BI1HadNm.js";import"./createLucideIcon-DDMrqLFZ.js";function P(){const{id:c}=C(),m=E(),g=!!c,[i,x]=d.useState({name:"",city_id:""}),[o,v]=d.useState({name:"",city_id:""}),[N,k]=d.useState([]),[b,f]=d.useState(!0),[y,h]=d.useState(!1),[_,w]=d.useState([]),[p,j]=d.useState(null);d.useEffect(()=>{const a=async()=>{try{f(!0);const n=((await u.get("/cities")).data||[]).map(r=>({id:r.id,name:r.name}));k(n)}catch{l.error("Failed to load cities")}finally{f(!1)}},t=async()=>{try{const n=((await u.get("/users")).data||[]).map(r=>({id:r.id,first_name:r.first_name,last_name:r.last_name,role:r.role}));w(n)}catch{l.error("Failed to load users")}};a(),t()},[]),d.useEffect(()=>{if(!g||!c)return;(async()=>{try{const s=(await u.get(`/boards/${c}`)).data;x({name:s.name||"",city_id:s.city_id?String(s.city_id):""}),s.user_id&&j(s.user_id)}catch{l.error("Failed to load board"),m("/dashboard/admin-boards")}})()},[c,g,m]);const S=()=>{let a=!0;const t={name:"",city_id:""};return i.name.trim()||(t.name="Board name is required",a=!1),i.city_id||(t.city_id="Please select a city",a=!1),v(t),a},B=async a=>{var s,n;if(a.preventDefault(),!S())return;h(!0);const t={name:i.name.trim(),city_id:Number(i.city_id),user_id:p||void 0};try{g?(await u.put(`/boards/${c}`,t),l.success("Board updated successfully!")):(await u.post("/boards",t),l.success("Board created successfully!")),m("/dashboard/admin-boards")}catch(r){l.error(((n=(s=r.response)==null?void 0:s.data)==null?void 0:n.message)||"Failed to save board")}finally{h(!1)}};return e.jsxs("div",{className:"p-16 border border-gray-200 rounded-2xl dark:border-gray-700 dark:bg-gray-900 shadow-sm max-w-4xl mx-auto w-full relative",children:[e.jsx(F,{position:"top-right",autoClose:3e3,hideProgressBar:!0,theme:"colored"}),e.jsxs("button",{type:"button",onClick:()=>m(-1),className:"inline-flex items-center gap-2 px-3 py-2 mb-6 rounded-xl border border-gray-300 dark:border-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800 transition",children:[e.jsx(L,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium",children:"Back"})]}),e.jsx("h1",{className:"text-2xl font-semibold mb-6 dark:text-gray-200",children:g?"Edit Board":"Add New Board"}),e.jsxs("form",{onSubmit:B,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 text-sm font-medium dark:text-gray-300",children:"Assign User"}),e.jsxs("select",{value:p||"",onChange:a=>j(Number(a.target.value)),className:"w-full border px-4 py-3 rounded-lg text-lg dark:bg-gray-700 dark:text-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"-- Select User (optional) --"}),_.map(a=>{var t;return e.jsxs("option",{value:a.id,children:[a.first_name," ",a.last_name," (",((t=a.role)==null?void 0:t.name)||"-",") "]},a.id)})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block mb-1 text-sm font-medium dark:text-gray-300",children:["City ",e.jsx("span",{className:"text-red-500",children:"*"})]}),b?e.jsx("div",{className:"text-gray-500",children:"Loading cities..."}):e.jsxs(e.Fragment,{children:[e.jsxs("select",{value:i.city_id,onChange:a=>x({...i,city_id:a.target.value}),className:`w-full border px-4 py-3 rounded-lg text-lg dark:bg-gray-700 dark:text-gray-200 focus:outline-none focus:ring-2 ${o.city_id?"border-red-500 focus:ring-red-500":"focus:ring-blue-500"}`,disabled:b,children:[e.jsx("option",{value:"",children:"Select a city"}),N.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]}),o.city_id&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:o.city_id})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block mb-1 text-sm font-medium dark:text-gray-300",children:["Board Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:i.name,onChange:a=>x({...i,name:a.target.value}),className:`w-full border px-4 py-3 rounded-lg text-lg dark:bg-gray-700 dark:text-gray-200 focus:outline-none focus:ring-2 ${o.name?"border-red-500 focus:ring-red-500":"focus:ring-blue-500"}`,placeholder:"Enter board name"}),o.name&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:o.name})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-8",children:[e.jsx("button",{type:"button",onClick:()=>m("/dashboard/admin-boards"),className:"px-5 py-2 rounded-lg border dark:border-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800",disabled:y,children:"Cancel"}),e.jsx("button",{type:"submit",disabled:y||b,className:"px-6 py-3 rounded-lg bg-blue-600 text-white hover:bg-blue-700 text-lg disabled:opacity-50",children:y?"Saving...":"Save Board"})]})]})]})}export{P as default};
