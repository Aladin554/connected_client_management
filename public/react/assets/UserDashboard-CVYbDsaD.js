import{u as I,r as n,j as e,L as _,d as M,i as A}from"./index-dlF-v8Wy.js";import{L as T}from"./Loader-COzHcs_H.js";import{S as P}from"./search-CZwwpIrA.js";import{C as R}from"./chevron-down-C9vurgye.js";import"./createLucideIcon-Ck__ep5g.js";const D=-9999,N={dhaka:0,chittagong:1,sylhet:2},G=t=>{const a=t.trim().toLowerCase();return a.includes("commission")||a.includes("comission")},z=t=>[...t].sort((a,c)=>{const i=N[a.name.trim().toLowerCase()]??Number.MAX_SAFE_INTEGER,x=N[c.name.trim().toLowerCase()]??Number.MAX_SAFE_INTEGER;return i!==x?i-x:a.name.localeCompare(c.name)});function O(t){return Array.isArray(t)?t:typeof t=="object"&&t!==null&&Array.isArray(t.data)?t.data:[]}function H(){const t=I(),[a,c]=n.useState([]),[i,x]=n.useState(null),[C,f]=n.useState(!0),[b,p]=n.useState(null),[y,S]=n.useState(""),[m,u]=n.useState(!1),g=n.useRef(null);n.useEffect(()=>{(async()=>{try{f(!0),p(null);const[r,l]=await Promise.all([M.get("/cities"),A()]);c(O(r.data)),x(l)}catch(r){console.error("Failed to load user dashboard",r),p("Could not load dashboard data. Please refresh the page.")}finally{f(!1)}})()},[]),n.useEffect(()=>{if(!m)return;const s=l=>{g.current&&(g.current.contains(l.target)||u(!1))},r=l=>{l.key==="Escape"&&u(!1)};return document.addEventListener("mousedown",s),window.addEventListener("keydown",r),()=>{document.removeEventListener("mousedown",s),window.removeEventListener("keydown",r)}},[m]);const d=y.trim().toLowerCase(),v=n.useMemo(()=>{const s=d?a.map(o=>{const h=o.name.toLowerCase().includes(d)?o.boards:o.boards.filter(E=>E.name.toLowerCase().includes(d));return{...o,boards:h}}).filter(o=>o.boards.length>0):a,r=z(s),l=[],j=r.map(o=>{const w=o.boards.filter(h=>G(h.name)?(l.push(h),!1):!0);return{...o,boards:w}}).filter(o=>o.boards.length>0);return l.length>0?[...j,{id:D,name:"Commissions",boards:l}]:j},[a,d]),L=()=>{u(!1),t("/profile")},k=()=>{u(!1),sessionStorage.removeItem("token"),sessionStorage.removeItem("role_id"),sessionStorage.removeItem("panel_permission"),sessionStorage.removeItem("user"),sessionStorage.removeItem("auth"),localStorage.removeItem("token"),localStorage.removeItem("user"),t("/signin")};return C?e.jsx(T,{message:"Loading dashboard..."}):e.jsxs("div",{className:"h-screen bg-gray-50/70 flex flex-col text-gray-800",children:[e.jsxs("header",{className:"h-14 bg-white/80 backdrop-blur-sm border-b flex items-center px-4 gap-4 z-10",children:[e.jsx("div",{className:"flex items-center gap-3",children:e.jsx("button",{type:"button",onClick:()=>t("/"),className:"h-7 flex items-center cursor-pointer",title:"Go to home",children:e.jsx("img",{src:"/images/logo/connected_logo.png",alt:"Connected Logo",className:"h-7 w-auto object-contain"})})}),e.jsx("div",{className:"flex-1 flex justify-center px-6",children:e.jsxs("div",{className:"relative w-full max-w-2xl",children:[e.jsx(P,{className:"absolute left-3.5 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{placeholder:"Search boards...",value:y,onChange:s=>S(s.target.value),className:"w-full pl-10 pr-4 py-2 bg-gray-100/70 border rounded-lg focus:bg-white focus:ring-2 focus:ring-blue-200 transition"})]})}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("div",{className:"relative",ref:g,children:[e.jsxs("button",{type:"button",onClick:()=>u(s=>!s),className:"h-8 px-3 rounded-full bg-gradient-to-r from-blue-600 to-indigo-600 text-white text-sm font-semibold flex items-center justify-center gap-1.5 shadow-sm hover:opacity-95",title:"Open user menu","aria-expanded":m,"aria-haspopup":"menu",children:[(i==null?void 0:i.first_name)||"User",e.jsx(R,{size:14,className:`transition-transform ${m?"rotate-180":""}`})]}),m&&e.jsxs("div",{className:"absolute right-0 mt-2 w-44 rounded-lg border border-gray-200 bg-white py-1.5 shadow-lg z-40",children:[e.jsx("button",{type:"button",onClick:L,className:"w-full px-3 py-2 text-left text-sm text-gray-700 hover:bg-gray-50",children:"Profile Settings"}),e.jsx("button",{type:"button",onClick:k,className:"w-full px-3 py-2 text-left text-sm text-red-600 hover:bg-red-50",children:"Logout"})]})]})})]}),e.jsx("div",{className:"flex flex-1 overflow-hidden",children:e.jsx("main",{className:"flex-1 px-6 md:px-12 py-10 overflow-y-auto",children:e.jsxs("div",{className:"flex flex-col gap-12 max-w-7xl mx-auto",children:[e.jsxs("section",{className:"rounded-2xl border border-gray-200 bg-white px-6 py-5 shadow-sm",children:[e.jsxs("h1",{className:"text-2xl font-extrabold text-gray-900",children:["Hi ",(i==null?void 0:i.first_name)||"User"]}),e.jsx("p",{className:"mt-1 text-sm text-gray-600",children:"Get started below with your designated workspace."})]}),b&&e.jsx("div",{className:"rounded-xl border border-rose-200 bg-rose-50 px-4 py-3 text-sm text-rose-700",children:b}),v.length===0?e.jsxs("div",{className:"text-center py-20 text-gray-600 bg-white rounded-2xl shadow-sm border",children:[e.jsx("p",{className:"text-xl font-semibold mb-3",children:d?"No matching boards found":"No cities available yet"}),e.jsx("p",{className:"text-gray-500",children:d?"Try another board or city name":"Contact your administrator or create your first city"})]}):v.map(s=>e.jsxs("section",{className:"space-y-5",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-green-500 to-teal-600 text-white rounded-lg flex items-center justify-center font-bold text-xl shadow-sm",children:s.name.charAt(0).toUpperCase()}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-800",children:s.name}),e.jsxs("p",{className:"text-sm text-gray-500",children:[s.boards.length," board",s.boards.length!==1?"s":""]})]})]})}),s.boards.length>0?e.jsx("div",{className:"grid gap-6",style:{gridTemplateColumns:"repeat(4, minmax(0, 1fr))"},children:s.boards.map(r=>e.jsx(_,{to:`/boards/${r.id}`,children:e.jsx(U,{title:r.name,backgroundGradient:r.background_gradient||null})},r.id))}):e.jsxs("div",{className:"text-center py-16 text-gray-500 bg-gray-50/70 rounded-2xl border border-dashed",children:["No boards created in this city yet",e.jsx("div",{className:"mt-3 text-sm",children:"Ask your admin to add boards"})]})]},s.id))]})})})]})}function U({title:t,backgroundGradient:a}){return e.jsxs("div",{className:"h-40 rounded-2xl overflow-hidden shadow border hover:shadow-lg transition-all duration-200 group bg-white",children:[e.jsx("div",{className:"h-24",style:{background:a||"linear-gradient(135deg, #667eea, #764ba2)"}}),e.jsx("div",{className:"p-4 font-medium text-gray-800 group-hover:text-blue-700 transition-colors",children:t})]})}export{H as default};
